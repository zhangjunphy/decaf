<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- Copyright (C) 2018-2024 Jun Zhang &lt;zhangjunphy[at]gmail[dot]com&gt;</span><span>
</span><span id="line-2"></span><span class="hs-comment">--</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- This file is a part of decafc.</span><span>
</span><span id="line-4"></span><span class="hs-comment">--</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- decafc is free software: you can redistribute it and/or modify it under the</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- terms of the MIT (X11) License as described in the LICENSE file.</span><span>
</span><span id="line-7"></span><span class="hs-comment">--</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- decafc is distributed in the hope that it will be useful, but WITHOUT ANY</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- FOR A PARTICULAR PURPOSE.  See the X11 license for more details.</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">CFG.Build</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="AST.html"><span class="hs-identifier">AST</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="CFG.Types.html"><span class="hs-identifier">CFG.Types</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">liftA2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;|&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">throw</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">use</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">uses</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">view</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">views</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(%=)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(%~)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&amp;)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(+=)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.=)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.~)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;~)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(^.)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_3</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_Just</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Writer</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Functor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;&amp;&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Generics.Labels</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromJust</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isJust</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isNothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Formatting</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="SSA.html"><span class="hs-identifier">SSA</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Semantic.html"><span class="hs-identifier">Semantic</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SE</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Types.html"><span class="hs-identifier">Types</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Util.Constants.html"><span class="hs-identifier">Util.Constants</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Util.Constants.html#globalScopeID"><span class="hs-identifier">globalScopeID</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Util.Graph.html"><span class="hs-identifier">Util.Graph</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">G</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Util.SourceLoc.html"><span class="hs-identifier">Util.SourceLoc</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SL</span></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-comment">{------------------------------------------------
Data types
------------------------------------------------}</span><span>
</span><span id="line-45"></span><span class="hs-keyword">data</span><span> </span><span id="SymVarMap"><span class="annot"><a href="CFG.Build.html#SymVarMap"><span class="hs-identifier hs-var">SymVarMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SymVarMap"><span class="annot"><a href="CFG.Build.html#SymVarMap"><span class="hs-identifier hs-var">SymVarMap</span></a></span></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Am%3ASymVarMap"><span class="annot"><span class="annottext">SymVarMap -&gt; Map Name ScopeID
</span><a href="CFG.Build.html#%24sel%3Am%3ASymVarMap"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="Types.html#VID"><span class="hs-identifier hs-type">VID</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span id="%24sel%3Aparent%3ASymVarMap"><span class="annot"><span class="annottext">SymVarMap -&gt; Maybe ScopeID
</span><a href="CFG.Build.html#%24sel%3Aparent%3ASymVarMap"><span class="hs-identifier hs-var hs-var">parent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679218386"><span id="local-6989586621679218393"><span id="local-6989586621679218397"><span class="annot"><span class="annottext">ScopeID -&gt; SymVarMap -&gt; ShowS
[SymVarMap] -&gt; ShowS
SymVarMap -&gt; [Char]
(ScopeID -&gt; SymVarMap -&gt; ShowS)
-&gt; (SymVarMap -&gt; [Char])
-&gt; ([SymVarMap] -&gt; ShowS)
-&gt; Show SymVarMap
forall a.
(ScopeID -&gt; a -&gt; ShowS)
-&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: ScopeID -&gt; SymVarMap -&gt; ShowS
showsPrec :: ScopeID -&gt; SymVarMap -&gt; ShowS
$cshow :: SymVarMap -&gt; [Char]
show :: SymVarMap -&gt; [Char]
$cshowList :: [SymVarMap] -&gt; ShowS
showList :: [SymVarMap] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679218402"><span id="local-6989586621679218404"><span class="annot"><span class="annottext">(forall x. SymVarMap -&gt; Rep SymVarMap x)
-&gt; (forall x. Rep SymVarMap x -&gt; SymVarMap) -&gt; Generic SymVarMap
forall x. Rep SymVarMap x -&gt; SymVarMap
forall x. SymVarMap -&gt; Rep SymVarMap x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. SymVarMap -&gt; Rep SymVarMap x
from :: forall x. SymVarMap -&gt; Rep SymVarMap x
$cto :: forall x. Rep SymVarMap x -&gt; SymVarMap
to :: forall x. Rep SymVarMap x -&gt; SymVarMap
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-keyword">data</span><span> </span><span id="CFGState"><span class="annot"><a href="CFG.Build.html#CFGState"><span class="hs-identifier hs-var">CFGState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CFGState"><span class="annot"><a href="CFG.Build.html#CFGState"><span class="hs-identifier hs-var">CFGState</span></a></span></span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Acfg%3ACFGState"><span class="annot"><span class="annottext">CFGState -&gt; Maybe CFG
</span><a href="CFG.Build.html#%24sel%3Acfg%3ACFGState"><span class="hs-identifier hs-var hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="CFG.Types.html#CFG"><span class="hs-identifier hs-type">CFG</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span id="%24sel%3AastScope%3ACFGState"><span class="annot"><span class="annottext">CFGState -&gt; ScopeID
</span><a href="CFG.Build.html#%24sel%3AastScope%3ACFGState"><span class="hs-identifier hs-var hs-var">astScope</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span id="%24sel%3AcurrentBBID%3ACFGState"><span class="annot"><span class="annottext">CFGState -&gt; ScopeID
</span><a href="CFG.Build.html#%24sel%3AcurrentBBID%3ACFGState"><span class="hs-identifier hs-var hs-var">currentBBID</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span id="%24sel%3Avars%3ACFGState"><span class="annot"><span class="annottext">CFGState -&gt; [Var]
</span><a href="CFG.Build.html#%24sel%3Avars%3ACFGState"><span class="hs-identifier hs-var hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="SSA.html#VarList"><span class="hs-identifier hs-type">VarList</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span id="%24sel%3Asym2var%3ACFGState"><span class="annot"><span class="annottext">CFGState -&gt; Map ScopeID SymVarMap
</span><a href="CFG.Build.html#%24sel%3Asym2var%3ACFGState"><span class="hs-identifier hs-var hs-var">sym2var</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span> </span><span class="annot"><a href="CFG.Build.html#SymVarMap"><span class="hs-identifier hs-type">SymVarMap</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span id="%24sel%3Avar2sym%3ACFGState"><span class="annot"><span class="annottext">CFGState -&gt; Map ScopeID (ScopeID, Name)
</span><a href="CFG.Build.html#%24sel%3Avar2sym%3ACFGState"><span class="hs-identifier hs-var hs-var">var2sym</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Types.html#VID"><span class="hs-identifier hs-type">VID</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>    </span><span id="%24sel%3Astatements%3ACFGState"><span class="annot"><span class="annottext">CFGState -&gt; [SSA]
</span><a href="CFG.Build.html#%24sel%3Astatements%3ACFGState"><span class="hs-identifier hs-var hs-var">statements</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="SSA.html#SSA"><span class="hs-identifier hs-type">SSA</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>    </span><span id="%24sel%3AcurrentControlBlock%3ACFGState"><span class="annot"><span class="annottext">CFGState -&gt; Maybe (ScopeID, ScopeID)
</span><a href="CFG.Build.html#%24sel%3AcurrentControlBlock%3ACFGState"><span class="hs-identifier hs-var hs-var">currentControlBlock</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- entry and exit</span><span>
</span><span id="line-60"></span><span>    </span><span id="%24sel%3AcurrentFunctionExit%3ACFGState"><span class="annot"><span class="annottext">CFGState -&gt; Maybe ScopeID
</span><a href="CFG.Build.html#%24sel%3AcurrentFunctionExit%3ACFGState"><span class="hs-identifier hs-var hs-var">currentFunctionExit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>    </span><span id="%24sel%3AglobalBB%3ACFGState"><span class="annot"><span class="annottext">CFGState -&gt; Maybe BasicBlock
</span><a href="CFG.Build.html#%24sel%3AglobalBB%3ACFGState"><span class="hs-identifier hs-var hs-var">globalBB</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="CFG.Types.html#BasicBlock"><span class="hs-identifier hs-type">BasicBlock</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679218420"><span id="local-6989586621679218422"><span class="annot"><span class="annottext">(forall x. CFGState -&gt; Rep CFGState x)
-&gt; (forall x. Rep CFGState x -&gt; CFGState) -&gt; Generic CFGState
forall x. Rep CFGState x -&gt; CFGState
forall x. CFGState -&gt; Rep CFGState x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. CFGState -&gt; Rep CFGState x
from :: forall x. CFGState -&gt; Rep CFGState x
$cto :: forall x. Rep CFGState x -&gt; CFGState
to :: forall x. Rep CFGState x -&gt; CFGState
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">data</span><span> </span><span id="BBTransition"><span class="annot"><a href="CFG.Build.html#BBTransition"><span class="hs-identifier hs-var">BBTransition</span></a></span></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="StayIn"><span class="annot"><a href="CFG.Build.html#StayIn"><span class="hs-identifier hs-var">StayIn</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TailAt"><span class="annot"><a href="CFG.Build.html#TailAt"><span class="hs-identifier hs-var">TailAt</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Deadend"><span class="annot"><a href="CFG.Build.html#Deadend"><span class="hs-identifier hs-var">Deadend</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="annot"><a href="CFG.Build.html#initialState"><span class="hs-identifier hs-type">initialState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGState"><span class="hs-identifier hs-type">CFGState</span></a></span><span>
</span><span id="line-71"></span><span id="initialState"><span class="annot"><span class="annottext">initialState :: CFGState
</span><a href="CFG.Build.html#initialState"><span class="hs-identifier hs-var hs-var">initialState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><a href="CFG.Build.html#CFGState"><span class="hs-identifier hs-type">CFGState</span></a></span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:cfg:CFGState :: Maybe CFG
</span><a href="CFG.Build.html#%24sel%3Acfg%3ACFGState"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CFG
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>      </span><span class="annot"><span class="annottext">$sel:astScope:CFGState :: ScopeID
</span><a href="CFG.Build.html#%24sel%3AastScope%3ACFGState"><span class="hs-identifier hs-var">astScope</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>      </span><span class="annot"><span class="annottext">$sel:currentBBID:CFGState :: ScopeID
</span><a href="CFG.Build.html#%24sel%3AcurrentBBID%3ACFGState"><span class="hs-identifier hs-var">currentBBID</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>      </span><span class="annot"><span class="annottext">$sel:vars:CFGState :: [Var]
</span><a href="CFG.Build.html#%24sel%3Avars%3ACFGState"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>      </span><span class="annot"><span class="annottext">$sel:sym2var:CFGState :: Map ScopeID SymVarMap
</span><a href="CFG.Build.html#%24sel%3Asym2var%3ACFGState"><span class="hs-identifier hs-var">sym2var</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ScopeID, SymVarMap)] -&gt; Map ScopeID SymVarMap
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeID
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map Name ScopeID -&gt; Maybe ScopeID -&gt; SymVarMap
</span><a href="CFG.Build.html#SymVarMap"><span class="hs-identifier hs-var">SymVarMap</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name ScopeID
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">Maybe ScopeID
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>      </span><span class="annot"><span class="annottext">$sel:var2sym:CFGState :: Map ScopeID (ScopeID, Name)
</span><a href="CFG.Build.html#%24sel%3Avar2sym%3ACFGState"><span class="hs-identifier hs-var">var2sym</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map ScopeID (ScopeID, Name)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>      </span><span class="annot"><span class="annottext">$sel:statements:CFGState :: [SSA]
</span><a href="CFG.Build.html#%24sel%3Astatements%3ACFGState"><span class="hs-identifier hs-var">statements</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>      </span><span class="annot"><span class="annottext">$sel:currentControlBlock:CFGState :: Maybe (ScopeID, ScopeID)
</span><a href="CFG.Build.html#%24sel%3AcurrentControlBlock%3ACFGState"><span class="hs-identifier hs-var">currentControlBlock</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (ScopeID, ScopeID)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>      </span><span class="annot"><span class="annottext">$sel:currentFunctionExit:CFGState :: Maybe ScopeID
</span><a href="CFG.Build.html#%24sel%3AcurrentFunctionExit%3ACFGState"><span class="hs-identifier hs-var">currentFunctionExit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ScopeID
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>      </span><span class="annot"><span class="annottext">$sel:globalBB:CFGState :: Maybe BasicBlock
</span><a href="CFG.Build.html#%24sel%3AglobalBB%3ACFGState"><span class="hs-identifier hs-var">globalBB</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe BasicBlock
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-comment">{------------------------------------------------
Helps for CFGBuild monad
------------------------------------------------}</span><span>
</span><span id="line-88"></span><span class="annot"><a href="CFG.Build.html#getCFG"><span class="hs-identifier hs-type">getCFG</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="CFG.Types.html#CFG"><span class="hs-identifier hs-type">CFG</span></a></span><span>
</span><span id="line-89"></span><span id="getCFG"><span class="annot"><span class="annottext">getCFG :: CFGBuild CFG
</span><a href="CFG.Build.html#getCFG"><span class="hs-identifier hs-var hs-var">getCFG</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-90"></span><span>  </span><span class="annot"><span class="annottext">Getting (Maybe CFG) CFGState (Maybe CFG) -&gt; CFGBuild (Maybe CFG)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting (Maybe CFG) CFGState (Maybe CFG)
</span><span class="">#cfg</span></span><span> </span><span class="annot"><span class="annottext">CFGBuild (Maybe CFG) -&gt; (Maybe CFG -&gt; CFGBuild CFG) -&gt; CFGBuild CFG
forall a b. CFGBuild a -&gt; (a -&gt; CFGBuild b) -&gt; CFGBuild b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><span class="annottext">Maybe CFG
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild CFG
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild CFG) -&gt; CompileError -&gt; CFGBuild CFG
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Range
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;CFG not initialized&quot;</span></span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679218432"><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621679218432"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CFG -&gt; CFGBuild CFG
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621679218432"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="annot"><a href="CFG.Build.html#setCFG"><span class="hs-identifier hs-type">setCFG</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="CFG.Types.html#CFG"><span class="hs-identifier hs-type">CFG</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span id="setCFG"><span class="annot"><span class="annottext">setCFG :: CFG -&gt; CFGBuild ()
</span><a href="CFG.Build.html#setCFG"><span class="hs-identifier hs-var hs-var">setCFG</span></a></span></span><span> </span><span id="local-6989586621679218434"><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621679218434"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe CFG -&gt; Identity (Maybe CFG))
-&gt; CFGState -&gt; Identity CFGState
</span><span class="">#cfg</span></span><span> </span><span class="annot"><span class="annottext">((Maybe CFG -&gt; Identity (Maybe CFG))
 -&gt; CFGState -&gt; Identity CFGState)
-&gt; Maybe CFG -&gt; CFGBuild ()
forall s (m :: * -&gt; *) a b.
MonadState s m =&gt;
ASetter s s a b -&gt; b -&gt; m ()
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">CFG -&gt; Maybe CFG
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621679218434"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="annot"><a href="CFG.Build.html#getGraph"><span class="hs-identifier hs-type">getGraph</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Util.Graph.html#Graph"><span class="hs-identifier hs-type">G.Graph</span></a></span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span> </span><span class="annot"><a href="CFG.Types.html#BasicBlock"><span class="hs-identifier hs-type">BasicBlock</span></a></span><span> </span><span class="annot"><a href="CFG.Types.html#CFGEdge"><span class="hs-identifier hs-type">CFGEdge</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span id="getGraph"><span class="annot"><span class="annottext">getGraph :: CFGBuild (Graph ScopeID BasicBlock CFGEdge)
</span><a href="CFG.Build.html#getGraph"><span class="hs-identifier hs-var hs-var">getGraph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CFGBuild CFG
</span><a href="CFG.Build.html#getCFG"><span class="hs-identifier hs-var">getCFG</span></a></span><span> </span><span class="annot"><span class="annottext">CFGBuild CFG
-&gt; (CFG -&gt; Graph ScopeID BasicBlock CFGEdge)
-&gt; CFGBuild (Graph ScopeID BasicBlock CFGEdge)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (Graph ScopeID BasicBlock CFGEdge)
  CFG
  (Graph ScopeID BasicBlock CFGEdge)
-&gt; CFG -&gt; Graph ScopeID BasicBlock CFGEdge
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (Graph ScopeID BasicBlock CFGEdge)
  CFG
  (Graph ScopeID BasicBlock CFGEdge)
</span><span class="">#graph</span></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="annot"><a href="CFG.Build.html#setGraph"><span class="hs-identifier hs-type">setGraph</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Util.Graph.html#Graph"><span class="hs-identifier hs-type">G.Graph</span></a></span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span> </span><span class="annot"><a href="CFG.Types.html#BasicBlock"><span class="hs-identifier hs-type">BasicBlock</span></a></span><span> </span><span class="annot"><a href="CFG.Types.html#CFGEdge"><span class="hs-identifier hs-type">CFGEdge</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span id="setGraph"><span class="annot"><span class="annottext">setGraph :: Graph ScopeID BasicBlock CFGEdge -&gt; CFGBuild ()
</span><a href="CFG.Build.html#setGraph"><span class="hs-identifier hs-var hs-var">setGraph</span></a></span></span><span> </span><span id="local-6989586621679218437"><span class="annot"><span class="annottext">Graph ScopeID BasicBlock CFGEdge
</span><a href="#local-6989586621679218437"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe CFG -&gt; Identity (Maybe CFG))
-&gt; CFGState -&gt; Identity CFGState
</span><span class="">#cfg</span></span><span> </span><span class="annot"><span class="annottext">((Maybe CFG -&gt; Identity (Maybe CFG))
 -&gt; CFGState -&gt; Identity CFGState)
-&gt; ((Graph ScopeID BasicBlock CFGEdge
     -&gt; Identity (Graph ScopeID BasicBlock CFGEdge))
    -&gt; Maybe CFG -&gt; Identity (Maybe CFG))
-&gt; (Graph ScopeID BasicBlock CFGEdge
    -&gt; Identity (Graph ScopeID BasicBlock CFGEdge))
-&gt; CFGState
-&gt; Identity CFGState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(CFG -&gt; Identity CFG) -&gt; Maybe CFG -&gt; Identity (Maybe CFG)
forall a b (p :: * -&gt; * -&gt; *) (f :: * -&gt; *).
(Choice p, Applicative f) =&gt;
p a (f b) -&gt; p (Maybe a) (f (Maybe b))
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">((CFG -&gt; Identity CFG) -&gt; Maybe CFG -&gt; Identity (Maybe CFG))
-&gt; ((Graph ScopeID BasicBlock CFGEdge
     -&gt; Identity (Graph ScopeID BasicBlock CFGEdge))
    -&gt; CFG -&gt; Identity CFG)
-&gt; (Graph ScopeID BasicBlock CFGEdge
    -&gt; Identity (Graph ScopeID BasicBlock CFGEdge))
-&gt; Maybe CFG
-&gt; Identity (Maybe CFG)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Graph ScopeID BasicBlock CFGEdge
 -&gt; Identity (Graph ScopeID BasicBlock CFGEdge))
-&gt; CFG -&gt; Identity CFG
</span><span class="">#graph</span></span><span> </span><span class="annot"><span class="annottext">((Graph ScopeID BasicBlock CFGEdge
  -&gt; Identity (Graph ScopeID BasicBlock CFGEdge))
 -&gt; CFGState -&gt; Identity CFGState)
-&gt; Graph ScopeID BasicBlock CFGEdge -&gt; CFGBuild ()
forall s (m :: * -&gt; *) a b.
MonadState s m =&gt;
ASetter s s a b -&gt; b -&gt; m ()
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Graph ScopeID BasicBlock CFGEdge
</span><a href="#local-6989586621679218437"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span id="local-6989586621679215921"><span class="annot"><a href="CFG.Build.html#updateCFG"><span class="hs-identifier hs-type">updateCFG</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Util.Graph.html#GraphBuilder"><span class="hs-identifier hs-type">G.GraphBuilder</span></a></span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span> </span><span class="annot"><a href="CFG.Types.html#BasicBlock"><span class="hs-identifier hs-type">BasicBlock</span></a></span><span> </span><span class="annot"><a href="CFG.Types.html#CFGEdge"><span class="hs-identifier hs-type">CFGEdge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679215921"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-104"></span><span id="updateCFG"><span class="annot"><span class="annottext">updateCFG :: forall a. GraphBuilder ScopeID BasicBlock CFGEdge a -&gt; CFGBuild ()
</span><a href="CFG.Build.html#updateCFG"><span class="hs-identifier hs-var hs-var">updateCFG</span></a></span></span><span> </span><span id="local-6989586621679218444"><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge a
</span><a href="#local-6989586621679218444"><span class="hs-identifier hs-var">update</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-105"></span><span>  </span><span id="local-6989586621679218445"><span class="annot"><span class="annottext">Graph ScopeID BasicBlock CFGEdge
</span><a href="#local-6989586621679218445"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild (Graph ScopeID BasicBlock CFGEdge)
</span><a href="CFG.Build.html#getGraph"><span class="hs-identifier hs-var">getGraph</span></a></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679218446"><span class="annot"><span class="annottext">g' :: Either Name (Graph ScopeID BasicBlock CFGEdge)
</span><a href="#local-6989586621679218446"><span class="hs-identifier hs-var hs-var">g'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge a
-&gt; Graph ScopeID BasicBlock CFGEdge
-&gt; Either Name (Graph ScopeID BasicBlock CFGEdge)
forall ni nd ed a.
(Eq ni, Ord ni) =&gt;
GraphBuilder ni nd ed a
-&gt; Graph ni nd ed -&gt; Either Name (Graph ni nd ed)
</span><a href="Util.Graph.html#update"><span class="hs-identifier hs-var">G.update</span></a></span><span> </span><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge a
</span><a href="#local-6989586621679218444"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="annot"><span class="annottext">Graph ScopeID BasicBlock CFGEdge
</span><a href="#local-6989586621679218445"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either Name (Graph ScopeID BasicBlock CFGEdge)
</span><a href="#local-6989586621679218446"><span class="hs-identifier hs-var">g'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679218448"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218448"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild ()
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild ()) -&gt; CompileError -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Range
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218448"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679218449"><span class="annot"><span class="annottext">Graph ScopeID BasicBlock CFGEdge
</span><a href="#local-6989586621679218449"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Graph ScopeID BasicBlock CFGEdge -&gt; CFGBuild ()
</span><a href="CFG.Build.html#setGraph"><span class="hs-identifier hs-var">setGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Graph ScopeID BasicBlock CFGEdge
</span><a href="#local-6989586621679218449"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-keyword">data</span><span> </span><span id="CFGContext"><span class="annot"><a href="CFG.Build.html#CFGContext"><span class="hs-identifier hs-var">CFGContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CFGContext"><span class="annot"><a href="CFG.Build.html#CFGContext"><span class="hs-identifier hs-var">CFGContext</span></a></span></span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-special">{</span><span id="%24sel%3Asemantic%3ACFGContext"><span class="annot"><span class="annottext">CFGContext -&gt; SemanticInfo
</span><a href="CFG.Build.html#%24sel%3Asemantic%3ACFGContext"><span class="hs-identifier hs-var hs-var">semantic</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Semantic.html#SemanticInfo"><span class="hs-identifier hs-type">SE.SemanticInfo</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679218453"><span id="local-6989586621679218455"><span class="annot"><span class="annottext">(forall x. CFGContext -&gt; Rep CFGContext x)
-&gt; (forall x. Rep CFGContext x -&gt; CFGContext) -&gt; Generic CFGContext
forall x. Rep CFGContext x -&gt; CFGContext
forall x. CFGContext -&gt; Rep CFGContext x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. CFGContext -&gt; Rep CFGContext x
from :: forall x. CFGContext -&gt; Rep CFGContext x
$cto :: forall x. Rep CFGContext x -&gt; CFGContext
to :: forall x. Rep CFGContext x -&gt; CFGContext
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-keyword">newtype</span><span> </span><span id="CFGBuild"><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-var">CFGBuild</span></a></span></span><span> </span><span id="local-6989586621679215927"><span class="annot"><a href="#local-6989586621679215927"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CFGBuild"><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-var">CFGBuild</span></a></span></span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3ArunCFGBuild%3ACFGBuild"><span class="annot"><span class="annottext">forall a.
CFGBuild a
-&gt; ExceptT CompileError (ReaderT CFGContext (State CFGState)) a
</span><a href="CFG.Build.html#%24sel%3ArunCFGBuild%3ACFGBuild"><span class="hs-identifier hs-var hs-var">runCFGBuild</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-117"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span>
</span><span id="line-118"></span><span>        </span><span class="annot"><a href="Types.html#CompileError"><span class="hs-identifier hs-type">CompileError</span></a></span><span>
</span><span id="line-119"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="CFG.Build.html#CFGContext"><span class="hs-identifier hs-type">CFGContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="CFG.Build.html#CFGState"><span class="hs-identifier hs-type">CFGState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>        </span><span class="annot"><a href="#local-6989586621679215927"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-keyword">deriving</span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-special">(</span><span> </span><span id="local-6989586621679218459"><span id="local-6989586621679218465"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; CFGBuild a -&gt; CFGBuild b)
-&gt; (forall a b. a -&gt; CFGBuild b -&gt; CFGBuild a) -&gt; Functor CFGBuild
forall a b. a -&gt; CFGBuild b -&gt; CFGBuild a
forall a b. (a -&gt; b) -&gt; CFGBuild a -&gt; CFGBuild b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; CFGBuild a -&gt; CFGBuild b
fmap :: forall a b. (a -&gt; b) -&gt; CFGBuild a -&gt; CFGBuild b
$c&lt;$ :: forall a b. a -&gt; CFGBuild b -&gt; CFGBuild a
&lt;$ :: forall a b. a -&gt; CFGBuild b -&gt; CFGBuild a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-124"></span><span>      </span><span id="local-6989586621679218477"><span id="local-6989586621679218484"><span id="local-6989586621679218490"><span id="local-6989586621679218496"><span id="local-6989586621679218502"><span class="annot"><span class="annottext">Functor CFGBuild
Functor CFGBuild
-&gt; (forall a. a -&gt; CFGBuild a)
-&gt; (forall a b. CFGBuild (a -&gt; b) -&gt; CFGBuild a -&gt; CFGBuild b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c) -&gt; CFGBuild a -&gt; CFGBuild b -&gt; CFGBuild c)
-&gt; (forall a b. CFGBuild a -&gt; CFGBuild b -&gt; CFGBuild b)
-&gt; (forall a b. CFGBuild a -&gt; CFGBuild b -&gt; CFGBuild a)
-&gt; Applicative CFGBuild
forall a. a -&gt; CFGBuild a
forall a b. CFGBuild a -&gt; CFGBuild b -&gt; CFGBuild a
forall a b. CFGBuild a -&gt; CFGBuild b -&gt; CFGBuild b
forall a b. CFGBuild (a -&gt; b) -&gt; CFGBuild a -&gt; CFGBuild b
forall a b c.
(a -&gt; b -&gt; c) -&gt; CFGBuild a -&gt; CFGBuild b -&gt; CFGBuild c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
$cpure :: forall a. a -&gt; CFGBuild a
pure :: forall a. a -&gt; CFGBuild a
$c&lt;*&gt; :: forall a b. CFGBuild (a -&gt; b) -&gt; CFGBuild a -&gt; CFGBuild b
&lt;*&gt; :: forall a b. CFGBuild (a -&gt; b) -&gt; CFGBuild a -&gt; CFGBuild b
$cliftA2 :: forall a b c.
(a -&gt; b -&gt; c) -&gt; CFGBuild a -&gt; CFGBuild b -&gt; CFGBuild c
liftA2 :: forall a b c.
(a -&gt; b -&gt; c) -&gt; CFGBuild a -&gt; CFGBuild b -&gt; CFGBuild c
$c*&gt; :: forall a b. CFGBuild a -&gt; CFGBuild b -&gt; CFGBuild b
*&gt; :: forall a b. CFGBuild a -&gt; CFGBuild b -&gt; CFGBuild b
$c&lt;* :: forall a b. CFGBuild a -&gt; CFGBuild b -&gt; CFGBuild a
&lt;* :: forall a b. CFGBuild a -&gt; CFGBuild b -&gt; CFGBuild a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-125"></span><span>      </span><span id="local-6989586621679218529"><span id="local-6989586621679218535"><span id="local-6989586621679218540"><span class="annot"><span class="annottext">Applicative CFGBuild
Applicative CFGBuild
-&gt; (forall a b. CFGBuild a -&gt; (a -&gt; CFGBuild b) -&gt; CFGBuild b)
-&gt; (forall a b. CFGBuild a -&gt; CFGBuild b -&gt; CFGBuild b)
-&gt; (forall a. a -&gt; CFGBuild a)
-&gt; Monad CFGBuild
forall a. a -&gt; CFGBuild a
forall a b. CFGBuild a -&gt; CFGBuild b -&gt; CFGBuild b
forall a b. CFGBuild a -&gt; (a -&gt; CFGBuild b) -&gt; CFGBuild b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
$c&gt;&gt;= :: forall a b. CFGBuild a -&gt; (a -&gt; CFGBuild b) -&gt; CFGBuild b
&gt;&gt;= :: forall a b. CFGBuild a -&gt; (a -&gt; CFGBuild b) -&gt; CFGBuild b
$c&gt;&gt; :: forall a b. CFGBuild a -&gt; CFGBuild b -&gt; CFGBuild b
&gt;&gt; :: forall a b. CFGBuild a -&gt; CFGBuild b -&gt; CFGBuild b
$creturn :: forall a. a -&gt; CFGBuild a
return :: forall a. a -&gt; CFGBuild a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-126"></span><span>      </span><span id="local-6989586621679218554"><span id="local-6989586621679218560"><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Types.html#CompileError"><span class="hs-identifier hs-type">CompileError</span></a></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-127"></span><span>      </span><span id="local-6989586621679218572"><span id="local-6989586621679218578"><span id="local-6989586621679218583"><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="CFG.Build.html#CFGContext"><span class="hs-identifier hs-type">CFGContext</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-128"></span><span>      </span><span id="local-6989586621679218598"><span id="local-6989586621679218604"><span id="local-6989586621679218609"><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="CFG.Build.html#CFGState"><span class="hs-identifier hs-type">CFGState</span></a></span></span></span></span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="annot"><a href="CFG.Build.html#setASTScope"><span class="hs-identifier hs-type">setASTScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span id="setASTScope"><span class="annot"><span class="annottext">setASTScope :: ScopeID -&gt; CFGBuild ()
</span><a href="CFG.Build.html#setASTScope"><span class="hs-identifier hs-var hs-var">setASTScope</span></a></span></span><span> </span><span id="local-6989586621679218623"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218623"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
  #astScope .= sid
</span><span>
</span><span id="line-135"></span><span class="hs-comment">{-----------------------------------------------------------
  Record current innermost control block (while/for/etc.)
  for continue/break to find correct successor block.
------------------------------------------------------------}</span><span>
</span><span id="line-139"></span><span class="annot"><a href="CFG.Build.html#setControlBlock"><span class="hs-identifier hs-type">setControlBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span id="setControlBlock"><span class="annot"><span class="annottext">setControlBlock :: Maybe (ScopeID, ScopeID) -&gt; CFGBuild ()
</span><a href="CFG.Build.html#setControlBlock"><span class="hs-identifier hs-var hs-var">setControlBlock</span></a></span></span><span> </span><span id="local-6989586621679218625"><span class="annot"><span class="annottext">Maybe (ScopeID, ScopeID)
</span><a href="#local-6989586621679218625"><span class="hs-identifier hs-var">entryAndExit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
  #currentControlBlock .= entryAndExit
</span><span>
</span><span id="line-143"></span><span class="annot"><a href="CFG.Build.html#getControlBlock"><span class="hs-identifier hs-type">getControlBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span id="getControlBlock"><span class="annot"><span class="annottext">getControlBlock :: CFGBuild (Maybe (ScopeID, ScopeID))
</span><a href="CFG.Build.html#getControlBlock"><span class="hs-identifier hs-var hs-var">getControlBlock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Getting
  (Maybe (ScopeID, ScopeID)) CFGState (Maybe (ScopeID, ScopeID))
-&gt; CFGBuild (Maybe (ScopeID, ScopeID))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (Maybe (ScopeID, ScopeID)) CFGState (Maybe (ScopeID, ScopeID))
</span><span class="">#currentControlBlock</span></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="annot"><a href="CFG.Build.html#getControlEntry"><span class="hs-identifier hs-type">getControlEntry</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span id="getControlEntry"><span class="annot"><span class="annottext">getControlEntry :: CFGBuild (Maybe ScopeID)
</span><a href="CFG.Build.html#getControlEntry"><span class="hs-identifier hs-var hs-var">getControlEntry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Getting
  (Maybe (ScopeID, ScopeID)) CFGState (Maybe (ScopeID, ScopeID))
-&gt; CFGBuild (Maybe (ScopeID, ScopeID))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (Maybe (ScopeID, ScopeID)) CFGState (Maybe (ScopeID, ScopeID))
</span><span class="">#currentControlBlock</span></span><span> </span><span class="annot"><span class="annottext">CFGBuild (Maybe (ScopeID, ScopeID))
-&gt; (Maybe (ScopeID, ScopeID) -&gt; Maybe ScopeID)
-&gt; CFGBuild (Maybe ScopeID)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ScopeID, ScopeID)
-&gt; ((ScopeID, ScopeID) -&gt; ScopeID) -&gt; Maybe ScopeID
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ScopeID, ScopeID)
-&gt; Getting ScopeID (ScopeID, ScopeID) ScopeID -&gt; ScopeID
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID (ScopeID, ScopeID) ScopeID
forall s t a b. Field1 s t a b =&gt; Lens s t a b
Lens (ScopeID, ScopeID) (ScopeID, ScopeID) ScopeID ScopeID
</span><span class="hs-identifier hs-var">_1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="annot"><a href="CFG.Build.html#getControlExit"><span class="hs-identifier hs-type">getControlExit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span id="getControlExit"><span class="annot"><span class="annottext">getControlExit :: CFGBuild (Maybe ScopeID)
</span><a href="CFG.Build.html#getControlExit"><span class="hs-identifier hs-var hs-var">getControlExit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Getting
  (Maybe (ScopeID, ScopeID)) CFGState (Maybe (ScopeID, ScopeID))
-&gt; CFGBuild (Maybe (ScopeID, ScopeID))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (Maybe (ScopeID, ScopeID)) CFGState (Maybe (ScopeID, ScopeID))
</span><span class="">#currentControlBlock</span></span><span> </span><span class="annot"><span class="annottext">CFGBuild (Maybe (ScopeID, ScopeID))
-&gt; (Maybe (ScopeID, ScopeID) -&gt; Maybe ScopeID)
-&gt; CFGBuild (Maybe ScopeID)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ScopeID, ScopeID)
-&gt; ((ScopeID, ScopeID) -&gt; ScopeID) -&gt; Maybe ScopeID
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ScopeID, ScopeID)
-&gt; Getting ScopeID (ScopeID, ScopeID) ScopeID -&gt; ScopeID
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID (ScopeID, ScopeID) ScopeID
forall s t a b. Field2 s t a b =&gt; Lens s t a b
Lens (ScopeID, ScopeID) (ScopeID, ScopeID) ScopeID ScopeID
</span><span class="hs-identifier hs-var">_2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span id="local-6989586621679216023"><span class="annot"><a href="CFG.Build.html#withControlBlock"><span class="hs-identifier hs-type">withControlBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679216023"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679216023"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-153"></span><span id="withControlBlock"><span class="annot"><span class="annottext">withControlBlock :: forall a. ScopeID -&gt; ScopeID -&gt; CFGBuild a -&gt; CFGBuild a
</span><a href="CFG.Build.html#withControlBlock"><span class="hs-identifier hs-var hs-var">withControlBlock</span></a></span></span><span> </span><span id="local-6989586621679218635"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218635"><span class="hs-identifier hs-var">entry</span></a></span></span><span> </span><span id="local-6989586621679218636"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218636"><span class="hs-identifier hs-var">exit</span></a></span></span><span> </span><span id="local-6989586621679218637"><span class="annot"><span class="annottext">CFGBuild a
</span><a href="#local-6989586621679218637"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-154"></span><span>  </span><span id="local-6989586621679218638"><span class="annot"><span class="annottext">Maybe (ScopeID, ScopeID)
</span><a href="#local-6989586621679218638"><span class="hs-identifier hs-var">prevCB</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild (Maybe (ScopeID, ScopeID))
</span><a href="CFG.Build.html#getControlBlock"><span class="hs-identifier hs-var">getControlBlock</span></a></span><span>
</span><span id="line-155"></span><span>  </span><span class="annot"><span class="annottext">Maybe (ScopeID, ScopeID) -&gt; CFGBuild ()
</span><a href="CFG.Build.html#setControlBlock"><span class="hs-identifier hs-var">setControlBlock</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (ScopeID, ScopeID) -&gt; CFGBuild ())
-&gt; Maybe (ScopeID, ScopeID) -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ScopeID, ScopeID) -&gt; Maybe (ScopeID, ScopeID)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218635"><span class="hs-identifier hs-var">entry</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218636"><span class="hs-identifier hs-var">exit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>  </span><span id="local-6989586621679218639"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679218639"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild a
</span><a href="#local-6989586621679218637"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><span class="annottext">Maybe (ScopeID, ScopeID) -&gt; CFGBuild ()
</span><a href="CFG.Build.html#setControlBlock"><span class="hs-identifier hs-var">setControlBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ScopeID, ScopeID)
</span><a href="#local-6989586621679218638"><span class="hs-identifier hs-var">prevCB</span></a></span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; CFGBuild a
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679218639"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-comment">{-----------------------------------------------------------
  Record function tail for return to find correct
  successor block.
------------------------------------------------------------}</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="annot"><a href="CFG.Build.html#setFunctionEntry"><span class="hs-identifier hs-type">setFunctionEntry</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span id="setFunctionEntry"><span class="annot"><span class="annottext">setFunctionEntry :: ScopeID -&gt; CFGBuild ()
</span><a href="CFG.Build.html#setFunctionEntry"><span class="hs-identifier hs-var hs-var">setFunctionEntry</span></a></span></span><span> </span><span id="local-6989586621679218641"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218641"><span class="hs-identifier hs-var">entry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
  #cfg . _Just . #entry .= entry
</span><span>
</span><span id="line-169"></span><span class="annot"><a href="CFG.Build.html#setFunctionExit"><span class="hs-identifier hs-type">setFunctionExit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span id="setFunctionExit"><span class="annot"><span class="annottext">setFunctionExit :: ScopeID -&gt; CFGBuild ()
</span><a href="CFG.Build.html#setFunctionExit"><span class="hs-identifier hs-var hs-var">setFunctionExit</span></a></span></span><span> </span><span id="local-6989586621679218643"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218643"><span class="hs-identifier hs-var">exit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
  #cfg . _Just . #exit .= exit
</span><span>
</span><span id="line-173"></span><span class="annot"><a href="CFG.Build.html#getFunctionExit"><span class="hs-identifier hs-type">getFunctionExit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span>
</span><span id="line-174"></span><span id="getFunctionExit"><span class="annot"><span class="annottext">getFunctionExit :: CFGBuild ScopeID
</span><a href="CFG.Build.html#getFunctionExit"><span class="hs-identifier hs-var hs-var">getFunctionExit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CFGBuild CFG
</span><a href="CFG.Build.html#getCFG"><span class="hs-identifier hs-var">getCFG</span></a></span><span> </span><span class="annot"><span class="annottext">CFGBuild CFG -&gt; (CFG -&gt; ScopeID) -&gt; CFGBuild ScopeID
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFG ScopeID -&gt; CFG -&gt; ScopeID
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFG ScopeID
</span><span class="">#exit</span></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="annot"><a href="CFG.Build.html#getBasicBlock%27"><span class="hs-identifier hs-type">getBasicBlock'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="CFG.Types.html#BasicBlock"><span class="hs-identifier hs-type">BasicBlock</span></a></span><span>
</span><span id="line-177"></span><span id="getBasicBlock%27"><span class="annot"><span class="annottext">getBasicBlock' :: ScopeID -&gt; CFGBuild BasicBlock
</span><a href="CFG.Build.html#getBasicBlock%27"><span class="hs-identifier hs-var hs-var">getBasicBlock'</span></a></span></span><span> </span><span id="local-6989586621679218646"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218646"><span class="hs-identifier hs-var">bbid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-178"></span><span>  </span><span id="local-6989586621679218647"><span class="annot"><span class="annottext">Graph ScopeID BasicBlock CFGEdge
</span><a href="#local-6989586621679218647"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild (Graph ScopeID BasicBlock CFGEdge)
</span><a href="CFG.Build.html#getGraph"><span class="hs-identifier hs-var">getGraph</span></a></span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; Graph ScopeID BasicBlock CFGEdge -&gt; Maybe BasicBlock
forall ni nd ed.
(Eq ni, Ord ni) =&gt;
ni -&gt; Graph ni nd ed -&gt; Maybe nd
</span><a href="Util.Graph.html#lookupNode"><span class="hs-identifier hs-var">G.lookupNode</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218646"><span class="hs-identifier hs-var">bbid</span></a></span><span> </span><span class="annot"><span class="annottext">Graph ScopeID BasicBlock CFGEdge
</span><a href="#local-6989586621679218647"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><span class="annottext">Maybe BasicBlock
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild BasicBlock
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild BasicBlock)
-&gt; CompileError -&gt; CFGBuild BasicBlock
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Range
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; CompileError) -&gt; Name -&gt; CompileError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format Name (ScopeID -&gt; Name) -&gt; ScopeID -&gt; Name
forall a. Format Name a -&gt; a
</span><span class="hs-identifier hs-var">sformat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format (ScopeID -&gt; Name) (ScopeID -&gt; Name)
</span><span class="hs-string">&quot;Unable to find basic block&quot;</span></span><span> </span><span class="annot"><span class="annottext">Format (ScopeID -&gt; Name) (ScopeID -&gt; Name)
-&gt; Format Name (ScopeID -&gt; Name) -&gt; Format Name (ScopeID -&gt; Name)
forall r a r'. Format r a -&gt; Format r' r -&gt; Format r' a
</span><span class="hs-operator hs-var">%+</span></span><span> </span><span class="annot"><span class="annottext">Format Name (ScopeID -&gt; Name)
forall a r. Integral a =&gt; Format r (a -&gt; r)
</span><span class="hs-identifier hs-var">int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218646"><span class="hs-identifier hs-var">bbid</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679218652"><span class="annot"><span class="annottext">BasicBlock
</span><a href="#local-6989586621679218652"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BasicBlock -&gt; CFGBuild BasicBlock
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">BasicBlock
</span><a href="#local-6989586621679218652"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-comment">{-----------------------------------------------------------
Add/lookup symbols or variables
------------------------------------------------------------}</span><span>
</span><span id="line-186"></span><span class="annot"><a href="CFG.Build.html#addVarSym"><span class="hs-identifier hs-type">addVarSym</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#VID"><span class="hs-identifier hs-type">VID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span id="addVarSym"><span class="annot"><span class="annottext">addVarSym :: Name -&gt; ScopeID -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addVarSym"><span class="hs-identifier hs-var hs-var">addVarSym</span></a></span></span><span> </span><span id="local-6989586621679218654"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218654"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679218655"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218655"><span class="hs-identifier hs-var">vid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-188"></span><span>  </span><span id="local-6989586621679218656"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218656"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><span class="annottext">Name -&gt; CFGBuild (Maybe ScopeID)
</span><a href="CFG.Build.html#getSymScope"><span class="hs-identifier hs-var">getSymScope</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218654"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">CFGBuild (Maybe ScopeID)
-&gt; (Maybe ScopeID -&gt; CFGBuild ScopeID) -&gt; CFGBuild ScopeID
forall a b. CFGBuild a -&gt; (a -&gt; CFGBuild b) -&gt; CFGBuild b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-190"></span><span>      </span><span class="annot"><span class="annottext">Maybe ScopeID
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild ScopeID
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild ScopeID)
-&gt; CompileError -&gt; CFGBuild ScopeID
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Range
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; CompileError) -&gt; Name -&gt; CompileError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format Name (Name -&gt; Name) -&gt; Name -&gt; Name
forall a. Format Name a -&gt; a
</span><span class="hs-identifier hs-var">sformat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format (Name -&gt; Name) (Name -&gt; Name)
</span><span class="hs-string">&quot;Unable to find symbol&quot;</span></span><span> </span><span class="annot"><span class="annottext">Format (Name -&gt; Name) (Name -&gt; Name)
-&gt; Format Name (Name -&gt; Name) -&gt; Format Name (Name -&gt; Name)
forall r a r'. Format r a -&gt; Format r' r -&gt; Format r' a
</span><span class="hs-operator hs-var">%+</span></span><span> </span><span class="annot"><span class="annottext">Format Name (Name -&gt; Name)
forall r. Format r (Name -&gt; r)
</span><span class="hs-identifier hs-var">stext</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218654"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-191"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679218659"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218659"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; CFGBuild ScopeID
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218659"><span class="hs-identifier hs-var">sid</span></a></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-comment">-- update var-&gt;sym</span><span class="hs-cpp">
  #var2sym %= Map.insert vid (sid, name)
</span><span>  </span><span class="hs-comment">-- update sym-&gt;var</span><span>
</span><span id="line-195"></span><span>  </span><span id="local-6989586621679218661"><span class="annot"><span class="annottext">Map ScopeID SymVarMap
</span><a href="#local-6989586621679218661"><span class="hs-identifier hs-var">sym2var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting (Map ScopeID SymVarMap) CFGState (Map ScopeID SymVarMap)
-&gt; CFGBuild (Map ScopeID SymVarMap)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting (Map ScopeID SymVarMap) CFGState (Map ScopeID SymVarMap)
</span><span class="">#sym2var</span></span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679218662"><span class="annot"><span class="annottext">sym2varInScope :: Maybe SymVarMap
</span><a href="#local-6989586621679218662"><span class="hs-identifier hs-var hs-var">sym2varInScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; Map ScopeID SymVarMap -&gt; Maybe SymVarMap
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218656"><span class="hs-identifier hs-var">sid</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScopeID SymVarMap
</span><a href="#local-6989586621679218661"><span class="hs-identifier hs-var">sym2var</span></a></span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe SymVarMap
</span><a href="#local-6989586621679218662"><span class="hs-identifier hs-var">sym2varInScope</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="annottext">Maybe SymVarMap
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild ()
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild ()) -&gt; CompileError -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Range
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; CompileError) -&gt; Name -&gt; CompileError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format Name (ScopeID -&gt; Name) -&gt; ScopeID -&gt; Name
forall a. Format Name a -&gt; a
</span><span class="hs-identifier hs-var">sformat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format (ScopeID -&gt; Name) (ScopeID -&gt; Name)
</span><span class="hs-string">&quot;Unable to find scope&quot;</span></span><span> </span><span class="annot"><span class="annottext">Format (ScopeID -&gt; Name) (ScopeID -&gt; Name)
-&gt; Format Name (ScopeID -&gt; Name) -&gt; Format Name (ScopeID -&gt; Name)
forall r a r'. Format r a -&gt; Format r' r -&gt; Format r' a
</span><span class="hs-operator hs-var">%+</span></span><span> </span><span class="annot"><span class="annottext">Format Name (ScopeID -&gt; Name)
forall a r. Integral a =&gt; Format r (a -&gt; r)
</span><span class="hs-identifier hs-var">int</span></span><span> </span><span class="annot"><span class="annottext">Format Name (ScopeID -&gt; Name)
-&gt; Format Name Name -&gt; Format Name (ScopeID -&gt; Name)
forall r a r'. Format r a -&gt; Format r' r -&gt; Format r' a
</span><span class="hs-operator hs-var">%+</span></span><span> </span><span class="annot"><span class="annottext">Format Name Name
</span><span class="hs-string">&quot;in sym-&gt;var map&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218656"><span class="hs-identifier hs-var">sid</span></a></span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679218664"><span class="annot"><span class="annottext">SymVarMap
</span><a href="#local-6989586621679218664"><span class="hs-identifier hs-var">s2v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ASetter
  CFGState CFGState (Map ScopeID SymVarMap) (Map ScopeID SymVarMap)
</span><span class="">#sym2var</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  CFGState CFGState (Map ScopeID SymVarMap) (Map ScopeID SymVarMap)
-&gt; (Map ScopeID SymVarMap -&gt; Map ScopeID SymVarMap) -&gt; CFGBuild ()
forall s (m :: * -&gt; *) a b.
MonadState s m =&gt;
ASetter s s a b -&gt; (a -&gt; b) -&gt; m ()
</span><span class="hs-operator hs-var">%=</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
-&gt; SymVarMap -&gt; Map ScopeID SymVarMap -&gt; Map ScopeID SymVarMap
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218656"><span class="hs-identifier hs-var">sid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SymVarMap
</span><a href="#local-6989586621679218664"><span class="hs-identifier hs-var">s2v</span></a></span><span> </span><span class="annot"><span class="annottext">SymVarMap -&gt; (SymVarMap -&gt; SymVarMap) -&gt; SymVarMap
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">ASetter SymVarMap SymVarMap (Map Name ScopeID) (Map Name ScopeID)
</span><span class="">#m</span></span><span> </span><span class="annot"><span class="annottext">ASetter SymVarMap SymVarMap (Map Name ScopeID) (Map Name ScopeID)
-&gt; (Map Name ScopeID -&gt; Map Name ScopeID) -&gt; SymVarMap -&gt; SymVarMap
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; ScopeID -&gt; Map Name ScopeID -&gt; Map Name ScopeID
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218654"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218655"><span class="hs-identifier hs-var">vid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="annot"><a href="CFG.Build.html#lookupVar"><span class="hs-identifier hs-type">lookupVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#VID"><span class="hs-identifier hs-type">VID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span id="lookupVar"><span class="annot"><span class="annottext">lookupVar :: ScopeID -&gt; CFGBuild (Maybe (ScopeID, Name))
</span><a href="CFG.Build.html#lookupVar"><span class="hs-identifier hs-var hs-var">lookupVar</span></a></span></span><span> </span><span id="local-6989586621679218666"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218666"><span class="hs-identifier hs-var">vid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LensLike'
  (Const (Maybe (ScopeID, Name)))
  CFGState
  (Map ScopeID (ScopeID, Name))
-&gt; (Map ScopeID (ScopeID, Name) -&gt; Maybe (ScopeID, Name))
-&gt; CFGBuild (Maybe (ScopeID, Name))
forall s (m :: * -&gt; *) r a.
MonadState s m =&gt;
LensLike' (Const r) s a -&gt; (a -&gt; r) -&gt; m r
</span><span class="hs-identifier hs-var">uses</span></span><span> </span><span class="annot"><span class="annottext">LensLike'
  (Const (Maybe (ScopeID, Name)))
  CFGState
  (Map ScopeID (ScopeID, Name))
</span><span class="">#var2sym</span></span><span> </span><span class="annot"><span class="annottext">((Map ScopeID (ScopeID, Name) -&gt; Maybe (ScopeID, Name))
 -&gt; CFGBuild (Maybe (ScopeID, Name)))
-&gt; (Map ScopeID (ScopeID, Name) -&gt; Maybe (ScopeID, Name))
-&gt; CFGBuild (Maybe (ScopeID, Name))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; Map ScopeID (ScopeID, Name) -&gt; Maybe (ScopeID, Name)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218666"><span class="hs-identifier hs-var">vid</span></a></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="annot"><a href="CFG.Build.html#lookupVar%27"><span class="hs-identifier hs-type">lookupVar'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#VID"><span class="hs-identifier hs-type">VID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span id="lookupVar%27"><span class="annot"><span class="annottext">lookupVar' :: ScopeID -&gt; CFGBuild (ScopeID, Name)
</span><a href="CFG.Build.html#lookupVar%27"><span class="hs-identifier hs-var hs-var">lookupVar'</span></a></span></span><span> </span><span id="local-6989586621679218668"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218668"><span class="hs-identifier hs-var">vid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-206"></span><span>  </span><span class="annot"><span class="annottext">ScopeID -&gt; CFGBuild (Maybe (ScopeID, Name))
</span><a href="CFG.Build.html#lookupVar"><span class="hs-identifier hs-var">lookupVar</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218668"><span class="hs-identifier hs-var">vid</span></a></span><span> </span><span class="annot"><span class="annottext">CFGBuild (Maybe (ScopeID, Name))
-&gt; (Maybe (ScopeID, Name) -&gt; CFGBuild (ScopeID, Name))
-&gt; CFGBuild (ScopeID, Name)
forall a b. CFGBuild a -&gt; (a -&gt; CFGBuild b) -&gt; CFGBuild b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><span class="annottext">Maybe (ScopeID, Name)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild (ScopeID, Name)
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild (ScopeID, Name))
-&gt; CompileError -&gt; CFGBuild (ScopeID, Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Range
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; CompileError) -&gt; Name -&gt; CompileError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format Name (ScopeID -&gt; Name) -&gt; ScopeID -&gt; Name
forall a. Format Name a -&gt; a
</span><span class="hs-identifier hs-var">sformat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format (ScopeID -&gt; Name) (ScopeID -&gt; Name)
</span><span class="hs-string">&quot;Unable to find variable&quot;</span></span><span> </span><span class="annot"><span class="annottext">Format (ScopeID -&gt; Name) (ScopeID -&gt; Name)
-&gt; Format Name (ScopeID -&gt; Name) -&gt; Format Name (ScopeID -&gt; Name)
forall r a r'. Format r a -&gt; Format r' r -&gt; Format r' a
</span><span class="hs-operator hs-var">%+</span></span><span> </span><span class="annot"><span class="annottext">Format Name (ScopeID -&gt; Name)
forall a r. Integral a =&gt; Format r (a -&gt; r)
</span><span class="hs-identifier hs-var">int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218668"><span class="hs-identifier hs-var">vid</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679218669"><span class="annot"><span class="annottext">(ScopeID, Name)
</span><a href="#local-6989586621679218669"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ScopeID, Name) -&gt; CFGBuild (ScopeID, Name)
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ScopeID, Name)
</span><a href="#local-6989586621679218669"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="hs-comment">-- Look for symbol resursively</span><span>
</span><span id="line-211"></span><span class="annot"><a href="CFG.Build.html#lookupSymInScope"><span class="hs-identifier hs-type">lookupSymInScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="SSA.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span id="lookupSymInScope"><span class="annot"><span class="annottext">lookupSymInScope :: Name -&gt; ScopeID -&gt; CFGBuild (Maybe Var)
</span><a href="CFG.Build.html#lookupSymInScope"><span class="hs-identifier hs-var hs-var">lookupSymInScope</span></a></span></span><span> </span><span id="local-6989586621679218671"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218671"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679218672"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218672"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-213"></span><span>  </span><span id="local-6989586621679218673"><span class="annot"><span class="annottext">Map ScopeID SymVarMap
</span><a href="#local-6989586621679218673"><span class="hs-identifier hs-var">sym2var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting (Map ScopeID SymVarMap) CFGState (Map ScopeID SymVarMap)
-&gt; CFGBuild (Map ScopeID SymVarMap)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting (Map ScopeID SymVarMap) CFGState (Map ScopeID SymVarMap)
</span><span class="">#sym2var</span></span><span>
</span><span id="line-214"></span><span>  </span><span id="local-6989586621679218674"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621679218674"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting [Var] CFGState [Var] -&gt; CFGBuild [Var]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting [Var] CFGState [Var]
</span><span class="">#vars</span></span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679218675"><span class="annot"><span class="annottext">vid :: Maybe ScopeID
</span><a href="#local-6989586621679218675"><span class="hs-identifier hs-var hs-var">vid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; Map ScopeID SymVarMap -&gt; Maybe SymVarMap
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218672"><span class="hs-identifier hs-var">sid</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScopeID SymVarMap
</span><a href="#local-6989586621679218673"><span class="hs-identifier hs-var">sym2var</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SymVarMap -&gt; (SymVarMap -&gt; Maybe ScopeID) -&gt; Maybe ScopeID
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679218676"><span class="annot"><span class="annottext">SymVarMap
</span><a href="#local-6989586621679218676"><span class="hs-identifier hs-var">m'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; SymVarMap -&gt; Map ScopeID SymVarMap -&gt; Maybe ScopeID
</span><a href="#local-6989586621679218677"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218671"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SymVarMap
</span><a href="#local-6989586621679218676"><span class="hs-identifier hs-var">m'</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScopeID SymVarMap
</span><a href="#local-6989586621679218673"><span class="hs-identifier hs-var">sym2var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>  </span><span class="annot"><span class="annottext">Maybe Var -&gt; CFGBuild (Maybe Var)
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Var -&gt; CFGBuild (Maybe Var))
-&gt; Maybe Var -&gt; CFGBuild (Maybe Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe ScopeID
</span><a href="#local-6989586621679218675"><span class="hs-identifier hs-var">vid</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ScopeID -&gt; (ScopeID -&gt; Var) -&gt; Maybe Var
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621679218674"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; ScopeID -&gt; Var
forall a. HasCallStack =&gt; [a] -&gt; ScopeID -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-218"></span><span>    </span><span class="annot"><a href="#local-6989586621679218677"><span class="hs-identifier hs-type">lookup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#SymVarMap"><span class="hs-identifier hs-type">SymVarMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span> </span><span class="annot"><a href="CFG.Build.html#SymVarMap"><span class="hs-identifier hs-type">SymVarMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Types.html#VID"><span class="hs-identifier hs-type">VID</span></a></span><span>
</span><span id="line-219"></span><span>    </span><span id="local-6989586621679218677"><span class="annot"><span class="annottext">lookup :: Name -&gt; SymVarMap -&gt; Map ScopeID SymVarMap -&gt; Maybe ScopeID
</span><a href="#local-6989586621679218677"><span class="hs-identifier hs-var hs-var">lookup</span></a></span></span><span> </span><span id="local-6989586621679218679"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218679"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679218680"><span class="annot"><span class="annottext">SymVarMap
</span><a href="#local-6989586621679218680"><span class="hs-identifier hs-var">symVarMap</span></a></span></span><span> </span><span id="local-6989586621679218681"><span class="annot"><span class="annottext">Map ScopeID SymVarMap
</span><a href="#local-6989586621679218681"><span class="hs-identifier hs-var">sym2var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Map Name ScopeID -&gt; Maybe ScopeID
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218679"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SymVarMap
</span><a href="#local-6989586621679218680"><span class="hs-identifier hs-var">symVarMap</span></a></span><span> </span><span class="annot"><span class="annottext">SymVarMap
-&gt; Getting (Map Name ScopeID) SymVarMap (Map Name ScopeID)
-&gt; Map Name ScopeID
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting (Map Name ScopeID) SymVarMap (Map Name ScopeID)
</span><span class="">#m</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-220"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679218682"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218682"><span class="hs-identifier hs-var">vid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; Maybe ScopeID
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218682"><span class="hs-identifier hs-var">vid</span></a></span><span>
</span><span id="line-221"></span><span>      </span><span class="annot"><span class="annottext">Maybe ScopeID
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-222"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SymVarMap
</span><a href="#local-6989586621679218680"><span class="hs-identifier hs-var">symVarMap</span></a></span><span> </span><span class="annot"><span class="annottext">SymVarMap
-&gt; Getting (Maybe ScopeID) SymVarMap (Maybe ScopeID)
-&gt; Maybe ScopeID
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting (Maybe ScopeID) SymVarMap (Maybe ScopeID)
</span><span class="">#parent</span></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>          </span><span class="annot"><span class="annottext">Maybe ScopeID -&gt; (ScopeID -&gt; Maybe SymVarMap) -&gt; Maybe SymVarMap
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeID -&gt; Map ScopeID SymVarMap -&gt; Maybe SymVarMap
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-operator hs-var">`Map.lookup`</span></span><span> </span><span class="annot"><span class="annottext">Map ScopeID SymVarMap
</span><a href="#local-6989586621679218681"><span class="hs-identifier hs-var">sym2var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>          </span><span class="annot"><span class="annottext">Maybe SymVarMap -&gt; (SymVarMap -&gt; Maybe ScopeID) -&gt; Maybe ScopeID
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679218683"><span class="annot"><span class="annottext">SymVarMap
</span><a href="#local-6989586621679218683"><span class="hs-identifier hs-var">map'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; SymVarMap -&gt; Map ScopeID SymVarMap -&gt; Maybe ScopeID
</span><a href="#local-6989586621679218677"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218679"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SymVarMap
</span><a href="#local-6989586621679218683"><span class="hs-identifier hs-var">map'</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScopeID SymVarMap
</span><a href="#local-6989586621679218681"><span class="hs-identifier hs-var">sym2var</span></a></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="annot"><a href="CFG.Build.html#lookupSymInScope%27"><span class="hs-identifier hs-type">lookupSymInScope'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="SSA.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-227"></span><span id="lookupSymInScope%27"><span class="annot"><span class="annottext">lookupSymInScope' :: Name -&gt; ScopeID -&gt; CFGBuild Var
</span><a href="CFG.Build.html#lookupSymInScope%27"><span class="hs-identifier hs-var hs-var">lookupSymInScope'</span></a></span></span><span> </span><span id="local-6989586621679218685"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218685"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679218686"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218686"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-228"></span><span>  </span><span id="local-6989586621679218687"><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621679218687"><span class="hs-identifier hs-var">var'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; ScopeID -&gt; CFGBuild (Maybe Var)
</span><a href="CFG.Build.html#lookupSymInScope"><span class="hs-identifier hs-var">lookupSymInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218685"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218686"><span class="hs-identifier hs-var">sid</span></a></span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621679218687"><span class="hs-identifier hs-var">var'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><span class="annottext">Maybe Var
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild Var
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild Var) -&gt; CompileError -&gt; CFGBuild Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Range
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; CompileError) -&gt; Name -&gt; CompileError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format Name (Name -&gt; ScopeID -&gt; Name) -&gt; Name -&gt; ScopeID -&gt; Name
forall a. Format Name a -&gt; a
</span><span class="hs-identifier hs-var">sformat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format (Name -&gt; ScopeID -&gt; Name) (Name -&gt; ScopeID -&gt; Name)
</span><span class="hs-string">&quot;Unable to find symbol&quot;</span></span><span> </span><span class="annot"><span class="annottext">Format (Name -&gt; ScopeID -&gt; Name) (Name -&gt; ScopeID -&gt; Name)
-&gt; Format Name (Name -&gt; ScopeID -&gt; Name)
-&gt; Format Name (Name -&gt; ScopeID -&gt; Name)
forall r a r'. Format r a -&gt; Format r' r -&gt; Format r' a
</span><span class="hs-operator hs-var">%+</span></span><span> </span><span class="annot"><span class="annottext">Format (ScopeID -&gt; Name) (Name -&gt; ScopeID -&gt; Name)
forall r. Format r (Name -&gt; r)
</span><span class="hs-identifier hs-var">stext</span></span><span> </span><span class="annot"><span class="annottext">Format (ScopeID -&gt; Name) (Name -&gt; ScopeID -&gt; Name)
-&gt; Format Name (ScopeID -&gt; Name)
-&gt; Format Name (Name -&gt; ScopeID -&gt; Name)
forall r a r'. Format r a -&gt; Format r' r -&gt; Format r' a
</span><span class="hs-operator hs-var">%+</span></span><span> </span><span class="annot"><span class="annottext">Format (ScopeID -&gt; Name) (ScopeID -&gt; Name)
</span><span class="hs-string">&quot;in scope&quot;</span></span><span> </span><span class="annot"><span class="annottext">Format (ScopeID -&gt; Name) (ScopeID -&gt; Name)
-&gt; Format Name (ScopeID -&gt; Name) -&gt; Format Name (ScopeID -&gt; Name)
forall r a r'. Format r a -&gt; Format r' r -&gt; Format r' a
</span><span class="hs-operator hs-var">%+</span></span><span> </span><span class="annot"><span class="annottext">Format Name (ScopeID -&gt; Name)
forall a r. Integral a =&gt; Format r (a -&gt; r)
</span><span class="hs-identifier hs-var">int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218685"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218686"><span class="hs-identifier hs-var">sid</span></a></span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679218688"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218688"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218688"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span class="annot"><a href="CFG.Build.html#lookupSym"><span class="hs-identifier hs-type">lookupSym</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="SSA.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span id="lookupSym"><span class="annot"><span class="annottext">lookupSym :: Name -&gt; CFGBuild (Maybe Var)
</span><a href="CFG.Build.html#lookupSym"><span class="hs-identifier hs-var hs-var">lookupSym</span></a></span></span><span> </span><span id="local-6989586621679218690"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218690"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-235"></span><span>  </span><span id="local-6989586621679218691"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218691"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#astScope</span></span><span>
</span><span id="line-236"></span><span>  </span><span class="annot"><span class="annottext">Name -&gt; ScopeID -&gt; CFGBuild (Maybe Var)
</span><a href="CFG.Build.html#lookupSymInScope"><span class="hs-identifier hs-var">lookupSymInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218690"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218691"><span class="hs-identifier hs-var">sid</span></a></span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span class="annot"><a href="CFG.Build.html#lookupSym%27"><span class="hs-identifier hs-type">lookupSym'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="SSA.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-239"></span><span id="lookupSym%27"><span class="annot"><span class="annottext">lookupSym' :: Name -&gt; CFGBuild Var
</span><a href="CFG.Build.html#lookupSym%27"><span class="hs-identifier hs-var hs-var">lookupSym'</span></a></span></span><span> </span><span id="local-6989586621679218693"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218693"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-240"></span><span>  </span><span id="local-6989586621679218694"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218694"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#astScope</span></span><span>
</span><span id="line-241"></span><span>  </span><span class="annot"><span class="annottext">Name -&gt; ScopeID -&gt; CFGBuild Var
</span><a href="CFG.Build.html#lookupSymInScope%27"><span class="hs-identifier hs-var">lookupSymInScope'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218693"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218694"><span class="hs-identifier hs-var">sid</span></a></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="annot"><a href="CFG.Build.html#getSymDecl"><span class="hs-identifier hs-type">getSymDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="AST.html#Argument"><span class="hs-identifier hs-type">AST.Argument</span></a></span><span> </span><span class="annot"><a href="AST.html#FieldDecl"><span class="hs-identifier hs-type">AST.FieldDecl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span id="getSymDecl"><span class="annot"><span class="annottext">getSymDecl :: Name -&gt; CFGBuild (Maybe (Either Argument FieldDecl))
</span><a href="CFG.Build.html#getSymDecl"><span class="hs-identifier hs-var hs-var">getSymDecl</span></a></span></span><span> </span><span id="local-6989586621679218696"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218696"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-245"></span><span>  </span><span id="local-6989586621679218697"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218697"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#astScope</span></span><span>
</span><span id="line-246"></span><span>  </span><span id="local-6989586621679218698"><span class="annot"><span class="annottext">Map ScopeID SymbolTable
</span><a href="#local-6989586621679218698"><span class="hs-identifier hs-var">sts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting
  (Map ScopeID SymbolTable) CFGContext (Map ScopeID SymbolTable)
-&gt; CFGBuild (Map ScopeID SymbolTable)
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">(Getting
   (Map ScopeID SymbolTable) CFGContext (Map ScopeID SymbolTable)
 -&gt; CFGBuild (Map ScopeID SymbolTable))
-&gt; Getting
     (Map ScopeID SymbolTable) CFGContext (Map ScopeID SymbolTable)
-&gt; CFGBuild (Map ScopeID SymbolTable)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(SemanticInfo -&gt; Const (Map ScopeID SymbolTable) SemanticInfo)
-&gt; CFGContext -&gt; Const (Map ScopeID SymbolTable) CFGContext
</span><span class="">#semantic</span></span><span> </span><span class="annot"><span class="annottext">((SemanticInfo -&gt; Const (Map ScopeID SymbolTable) SemanticInfo)
 -&gt; CFGContext -&gt; Const (Map ScopeID SymbolTable) CFGContext)
-&gt; ((Map ScopeID SymbolTable
     -&gt; Const (Map ScopeID SymbolTable) (Map ScopeID SymbolTable))
    -&gt; SemanticInfo -&gt; Const (Map ScopeID SymbolTable) SemanticInfo)
-&gt; Getting
     (Map ScopeID SymbolTable) CFGContext (Map ScopeID SymbolTable)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map ScopeID SymbolTable
 -&gt; Const (Map ScopeID SymbolTable) (Map ScopeID SymbolTable))
-&gt; SemanticInfo -&gt; Const (Map ScopeID SymbolTable) SemanticInfo
</span><span class="">#symbolTables</span></span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; Map ScopeID SymbolTable -&gt; Maybe SymbolTable
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218697"><span class="hs-identifier hs-var">sid</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScopeID SymbolTable
</span><a href="#local-6989586621679218698"><span class="hs-identifier hs-var">sts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><span class="annottext">Maybe SymbolTable
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild (Maybe (Either Argument FieldDecl))
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild (Maybe (Either Argument FieldDecl)))
-&gt; CompileError -&gt; CFGBuild (Maybe (Either Argument FieldDecl))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Range
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format Name (ScopeID -&gt; Name) -&gt; ScopeID -&gt; Name
forall a. Format Name a -&gt; a
</span><span class="hs-identifier hs-var">sformat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format (ScopeID -&gt; Name) (ScopeID -&gt; Name)
</span><span class="hs-string">&quot;Unable to find scope &quot;</span></span><span> </span><span class="annot"><span class="annottext">Format (ScopeID -&gt; Name) (ScopeID -&gt; Name)
-&gt; Format Name (ScopeID -&gt; Name) -&gt; Format Name (ScopeID -&gt; Name)
forall r a r'. Format r a -&gt; Format r' r -&gt; Format r' a
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Format Name (ScopeID -&gt; Name)
forall a r. Integral a =&gt; Format r (a -&gt; r)
</span><span class="hs-identifier hs-var">int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218697"><span class="hs-identifier hs-var">sid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679218700"><span class="annot"><span class="annottext">SymbolTable
</span><a href="#local-6989586621679218700"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Either Argument FieldDecl)
-&gt; CFGBuild (Maybe (Either Argument FieldDecl))
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Either Argument FieldDecl)
 -&gt; CFGBuild (Maybe (Either Argument FieldDecl)))
-&gt; Maybe (Either Argument FieldDecl)
-&gt; CFGBuild (Maybe (Either Argument FieldDecl))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SymbolTable -&gt; Maybe (Either Argument FieldDecl)
</span><a href="#local-6989586621679218701"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218696"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolTable
</span><a href="#local-6989586621679218700"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-251"></span><span>    </span><span id="local-6989586621679218701"><span class="annot"><span class="annottext">lookup :: Name -&gt; SymbolTable -&gt; Maybe (Either Argument FieldDecl)
</span><a href="#local-6989586621679218701"><span class="hs-identifier hs-var hs-var">lookup</span></a></span></span><span> </span><span id="local-6989586621679218705"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218705"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679218706"><span class="annot"><span class="annottext">SymbolTable
</span><a href="#local-6989586621679218706"><span class="hs-identifier hs-var">st'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-252"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SymbolTable -&gt; Maybe (Either Argument FieldDecl)
</span><a href="Semantic.html#lookupLocalVariableFromST"><span class="hs-identifier hs-var">SE.lookupLocalVariableFromST</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218705"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolTable
</span><a href="#local-6989586621679218706"><span class="hs-identifier hs-var">st'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Either Argument FieldDecl)
-&gt; Maybe (Either Argument FieldDecl)
-&gt; Maybe (Either Argument FieldDecl)
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SymbolTable -&gt; Maybe SymbolTable
</span><a href="Semantic.html#%24sel%3Aparent%3ASymbolTable"><span class="hs-identifier hs-var">SE.parent</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolTable
</span><a href="#local-6989586621679218706"><span class="hs-identifier hs-var">st'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SymbolTable
-&gt; (SymbolTable -&gt; Maybe (Either Argument FieldDecl))
-&gt; Maybe (Either Argument FieldDecl)
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SymbolTable -&gt; Maybe (Either Argument FieldDecl)
</span><a href="#local-6989586621679218701"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218705"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span class="annot"><a href="CFG.Build.html#getSymScope"><span class="hs-identifier hs-type">getSymScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span id="getSymScope"><span class="annot"><span class="annottext">getSymScope :: Name -&gt; CFGBuild (Maybe ScopeID)
</span><a href="CFG.Build.html#getSymScope"><span class="hs-identifier hs-var hs-var">getSymScope</span></a></span></span><span> </span><span id="local-6989586621679218709"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218709"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-257"></span><span>  </span><span id="local-6989586621679218710"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218710"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#astScope</span></span><span>
</span><span id="line-258"></span><span>  </span><span id="local-6989586621679218711"><span class="annot"><span class="annottext">Map ScopeID SymbolTable
</span><a href="#local-6989586621679218711"><span class="hs-identifier hs-var">sts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting
  (Map ScopeID SymbolTable) CFGContext (Map ScopeID SymbolTable)
-&gt; CFGBuild (Map ScopeID SymbolTable)
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">(Getting
   (Map ScopeID SymbolTable) CFGContext (Map ScopeID SymbolTable)
 -&gt; CFGBuild (Map ScopeID SymbolTable))
-&gt; Getting
     (Map ScopeID SymbolTable) CFGContext (Map ScopeID SymbolTable)
-&gt; CFGBuild (Map ScopeID SymbolTable)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(SemanticInfo -&gt; Const (Map ScopeID SymbolTable) SemanticInfo)
-&gt; CFGContext -&gt; Const (Map ScopeID SymbolTable) CFGContext
</span><span class="">#semantic</span></span><span> </span><span class="annot"><span class="annottext">((SemanticInfo -&gt; Const (Map ScopeID SymbolTable) SemanticInfo)
 -&gt; CFGContext -&gt; Const (Map ScopeID SymbolTable) CFGContext)
-&gt; ((Map ScopeID SymbolTable
     -&gt; Const (Map ScopeID SymbolTable) (Map ScopeID SymbolTable))
    -&gt; SemanticInfo -&gt; Const (Map ScopeID SymbolTable) SemanticInfo)
-&gt; Getting
     (Map ScopeID SymbolTable) CFGContext (Map ScopeID SymbolTable)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map ScopeID SymbolTable
 -&gt; Const (Map ScopeID SymbolTable) (Map ScopeID SymbolTable))
-&gt; SemanticInfo -&gt; Const (Map ScopeID SymbolTable) SemanticInfo
</span><span class="">#symbolTables</span></span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; Map ScopeID SymbolTable -&gt; Maybe SymbolTable
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218710"><span class="hs-identifier hs-var">sid</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScopeID SymbolTable
</span><a href="#local-6989586621679218711"><span class="hs-identifier hs-var">sts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-260"></span><span>    </span><span class="annot"><span class="annottext">Maybe SymbolTable
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild (Maybe ScopeID)
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild (Maybe ScopeID))
-&gt; CompileError -&gt; CFGBuild (Maybe ScopeID)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Range
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format Name (ScopeID -&gt; Name) -&gt; ScopeID -&gt; Name
forall a. Format Name a -&gt; a
</span><span class="hs-identifier hs-var">sformat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format (ScopeID -&gt; Name) (ScopeID -&gt; Name)
</span><span class="hs-string">&quot;Unable to find scope &quot;</span></span><span> </span><span class="annot"><span class="annottext">Format (ScopeID -&gt; Name) (ScopeID -&gt; Name)
-&gt; Format Name (ScopeID -&gt; Name) -&gt; Format Name (ScopeID -&gt; Name)
forall r a r'. Format r a -&gt; Format r' r -&gt; Format r' a
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Format Name (ScopeID -&gt; Name)
forall a r. Integral a =&gt; Format r (a -&gt; r)
</span><span class="hs-identifier hs-var">int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218710"><span class="hs-identifier hs-var">sid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679218712"><span class="annot"><span class="annottext">SymbolTable
</span><a href="#local-6989586621679218712"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ScopeID -&gt; CFGBuild (Maybe ScopeID)
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ScopeID -&gt; CFGBuild (Maybe ScopeID))
-&gt; Maybe ScopeID -&gt; CFGBuild (Maybe ScopeID)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SymbolTable -&gt; Maybe ScopeID
</span><a href="#local-6989586621679218713"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218709"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolTable
</span><a href="#local-6989586621679218712"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-263"></span><span>    </span><span id="local-6989586621679218713"><span class="annot"><span class="annottext">lookup :: Name -&gt; SymbolTable -&gt; Maybe ScopeID
</span><a href="#local-6989586621679218713"><span class="hs-identifier hs-var hs-var">lookup</span></a></span></span><span> </span><span id="local-6989586621679218745"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218745"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679218746"><span class="annot"><span class="annottext">SymbolTable
</span><a href="#local-6989586621679218746"><span class="hs-identifier hs-var">st'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-264"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SymbolTable -&gt; Maybe (Either Argument FieldDecl)
</span><a href="Semantic.html#lookupLocalVariableFromST"><span class="hs-identifier hs-var">SE.lookupLocalVariableFromST</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218745"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolTable
</span><a href="#local-6989586621679218746"><span class="hs-identifier hs-var">st'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Either Argument FieldDecl)
-&gt; (Either Argument FieldDecl -&gt; ScopeID) -&gt; Maybe ScopeID
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Either Argument FieldDecl
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID SymbolTable ScopeID -&gt; SymbolTable -&gt; ScopeID
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID SymbolTable ScopeID
</span><span class="">#scopeID</span></span><span> </span><span class="annot"><span class="annottext">SymbolTable
</span><a href="#local-6989586621679218746"><span class="hs-identifier hs-var">st'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>        </span><span class="annot"><span class="annottext">Maybe ScopeID -&gt; Maybe ScopeID -&gt; Maybe ScopeID
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SymbolTable -&gt; Maybe SymbolTable
</span><a href="Semantic.html#%24sel%3Aparent%3ASymbolTable"><span class="hs-identifier hs-var">SE.parent</span></a></span><span> </span><span class="annot"><span class="annottext">SymbolTable
</span><a href="#local-6989586621679218746"><span class="hs-identifier hs-var">st'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SymbolTable
-&gt; (SymbolTable -&gt; Maybe ScopeID) -&gt; Maybe ScopeID
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SymbolTable -&gt; Maybe ScopeID
</span><a href="#local-6989586621679218713"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218745"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="annot"><a href="CFG.Build.html#newVar"><span class="hs-identifier hs-type">newVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AST.html#Type"><span class="hs-identifier hs-type">AST.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Util.SourceLoc.html#Range"><span class="hs-identifier hs-type">SL.Range</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="SSA.html#Locality"><span class="hs-identifier hs-type">Locality</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="SSA.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-268"></span><span id="newVar"><span class="annot"><span class="annottext">newVar :: Maybe Name -&gt; Type -&gt; Range -&gt; Locality -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newVar"><span class="hs-identifier hs-var hs-var">newVar</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span id="local-6989586621679218748"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218748"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679218749"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218749"><span class="hs-identifier hs-var">sl</span></a></span></span><span> </span><span id="local-6989586621679218750"><span class="annot"><span class="annottext">Locality
</span><a href="#local-6989586621679218750"><span class="hs-identifier hs-var">locality</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-269"></span><span>  </span><span id="local-6989586621679218751"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621679218751"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting [Var] CFGState [Var] -&gt; CFGBuild [Var]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting [Var] CFGState [Var]
</span><span class="">#vars</span></span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679218752"><span class="annot"><span class="annottext">vid :: ScopeID
</span><a href="#local-6989586621679218752"><span class="hs-identifier hs-var hs-var">vid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; ScopeID
forall a. [a] -&gt; ScopeID
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; ScopeID
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621679218751"><span class="hs-identifier hs-var">vars</span></a></span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679218754"><span class="annot"><span class="annottext">var :: Var
</span><a href="#local-6989586621679218754"><span class="hs-identifier hs-var hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScopeID
-&gt; Type
-&gt; Maybe (Either Argument FieldDecl)
-&gt; Range
-&gt; Locality
-&gt; Var
</span><a href="SSA.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218752"><span class="hs-identifier hs-var">vid</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218748"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Either Argument FieldDecl)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218749"><span class="hs-identifier hs-var">sl</span></a></span><span> </span><span class="annot"><span class="annottext">Locality
</span><a href="#local-6989586621679218750"><span class="hs-identifier hs-var">locality</span></a></span><span class="hs-cpp">
  #vars .= vars ++ [var]
</span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218754"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-274"></span><span class="annot"><a href="CFG.Build.html#newVar"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679218756"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218756"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679218757"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218757"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679218758"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218758"><span class="hs-identifier hs-var">sl</span></a></span></span><span> </span><span id="local-6989586621679218759"><span class="annot"><span class="annottext">Locality
</span><a href="#local-6989586621679218759"><span class="hs-identifier hs-var">locality</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-275"></span><span>  </span><span id="local-6989586621679218760"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621679218760"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting [Var] CFGState [Var] -&gt; CFGBuild [Var]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting [Var] CFGState [Var]
</span><span class="">#vars</span></span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679218761"><span class="annot"><span class="annottext">vid :: ScopeID
</span><a href="#local-6989586621679218761"><span class="hs-identifier hs-var hs-var">vid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; ScopeID
forall a. [a] -&gt; ScopeID
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; ScopeID
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621679218760"><span class="hs-identifier hs-var">vars</span></a></span><span>
</span><span id="line-277"></span><span>  </span><span id="local-6989586621679218762"><span class="annot"><span class="annottext">Maybe (Either Argument FieldDecl)
</span><a href="#local-6989586621679218762"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; CFGBuild (Maybe (Either Argument FieldDecl))
</span><a href="CFG.Build.html#getSymDecl"><span class="hs-identifier hs-var">getSymDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218756"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-278"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; CFGBuild () -&gt; CFGBuild ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Either Argument FieldDecl) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Either Argument FieldDecl)
</span><a href="#local-6989586621679218762"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CFGBuild () -&gt; CFGBuild ()) -&gt; CFGBuild () -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild ()
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; Maybe Range
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218758"><span class="hs-identifier hs-var">sl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; CompileError) -&gt; Name -&gt; CompileError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format Name (Name -&gt; Name) -&gt; Name -&gt; Name
forall a. Format Name a -&gt; a
</span><span class="hs-identifier hs-var">sformat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format (Name -&gt; Name) (Name -&gt; Name)
</span><span class="hs-string">&quot;Unable to find decl of variable &quot;</span></span><span> </span><span class="annot"><span class="annottext">Format (Name -&gt; Name) (Name -&gt; Name)
-&gt; Format Name (Name -&gt; Name) -&gt; Format Name (Name -&gt; Name)
forall r a r'. Format r a -&gt; Format r' r -&gt; Format r' a
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Format Name (Name -&gt; Name)
forall r. Format r (Name -&gt; r)
</span><span class="hs-identifier hs-var">stext</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218756"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679218764"><span class="annot"><span class="annottext">var :: Var
</span><a href="#local-6989586621679218764"><span class="hs-identifier hs-var hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScopeID
-&gt; Type
-&gt; Maybe (Either Argument FieldDecl)
-&gt; Range
-&gt; Locality
-&gt; Var
</span><a href="SSA.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218761"><span class="hs-identifier hs-var">vid</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218757"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Either Argument FieldDecl)
</span><a href="#local-6989586621679218762"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218758"><span class="hs-identifier hs-var">sl</span></a></span><span> </span><span class="annot"><span class="annottext">Locality
</span><a href="#local-6989586621679218759"><span class="hs-identifier hs-var">locality</span></a></span><span class="hs-cpp">
  #vars .= vars ++ [var]
</span><span>  </span><span class="annot"><span class="annottext">Name -&gt; ScopeID -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addVarSym"><span class="hs-identifier hs-var">addVarSym</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218756"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218761"><span class="hs-identifier hs-var">vid</span></a></span><span>
</span><span id="line-282"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218764"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="annot"><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-type">newLocal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AST.html#Type"><span class="hs-identifier hs-type">AST.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Util.SourceLoc.html#Range"><span class="hs-identifier hs-type">SL.Range</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="SSA.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-285"></span><span id="newLocal"><span class="annot"><span class="annottext">newLocal :: Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var hs-var">newLocal</span></a></span></span><span> </span><span id="local-6989586621679218766"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679218766"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679218767"><span class="annot"><span class="annottext">tpe :: Type
</span><a href="#local-6989586621679218767"><span class="hs-identifier hs-var">tpe</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="AST.html#ArrayType"><span class="hs-identifier hs-type">AST.ArrayType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679218769"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218769"><span class="hs-identifier hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-286"></span><span>  </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild Var
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; Maybe Range
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218769"><span class="hs-identifier hs-var">sl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; CompileError) -&gt; Name -&gt; CompileError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format Name (Maybe Name -&gt; Name) -&gt; Maybe Name -&gt; Name
forall a. Format Name a -&gt; a
</span><span class="hs-identifier hs-var">sformat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format (Maybe Name -&gt; Name) (Maybe Name -&gt; Name)
</span><span class="hs-string">&quot;Trying to create reg for an array: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Format (Maybe Name -&gt; Name) (Maybe Name -&gt; Name)
-&gt; Format Name (Maybe Name -&gt; Name)
-&gt; Format Name (Maybe Name -&gt; Name)
forall r a r'. Format r a -&gt; Format r' r -&gt; Format r' a
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Format Name (Maybe Name -&gt; Name)
forall a r. Show a =&gt; Format r (a -&gt; r)
</span><span class="hs-identifier hs-var">shown</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679218766"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span class="annot"><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span id="local-6989586621679218771"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679218771"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679218772"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218772"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679218773"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218773"><span class="hs-identifier hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; Locality -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newVar"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679218771"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218772"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218773"><span class="hs-identifier hs-var">sl</span></a></span><span> </span><span class="annot"><span class="annottext">Locality
</span><a href="SSA.html#Local"><span class="hs-identifier hs-var">Local</span></a></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span class="annot"><a href="CFG.Build.html#allocaOnStack"><span class="hs-identifier hs-type">allocaOnStack</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AST.html#Type"><span class="hs-identifier hs-type">AST.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Util.SourceLoc.html#Range"><span class="hs-identifier hs-type">SL.Range</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="SSA.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-290"></span><span id="allocaOnStack"><span class="annot"><span class="annottext">allocaOnStack :: Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#allocaOnStack"><span class="hs-identifier hs-var hs-var">allocaOnStack</span></a></span></span><span> </span><span id="local-6989586621679218776"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679218776"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679218777"><span class="annot"><span class="annottext">tpe' :: Type
</span><a href="#local-6989586621679218777"><span class="hs-identifier hs-var">tpe'</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="AST.html#ArrayType"><span class="hs-identifier hs-type">AST.ArrayType</span></a></span><span> </span><span id="local-6989586621679218778"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218778"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679218779"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679218779"><span class="hs-identifier hs-var">sz</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679218780"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218780"><span class="hs-identifier hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-291"></span><span>  </span><span id="local-6989586621679218781"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218781"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; Locality -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newVar"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679218776"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218777"><span class="hs-identifier hs-var">tpe'</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218780"><span class="hs-identifier hs-var">sl</span></a></span><span> </span><span class="annot"><span class="annottext">Locality
</span><a href="SSA.html#Local"><span class="hs-identifier hs-var">Local</span></a></span><span>
</span><span id="line-292"></span><span>  </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Type -&gt; Maybe Int64 -&gt; SSA
</span><a href="SSA.html#Alloca"><span class="hs-identifier hs-var">Alloca</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218781"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218778"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; Maybe Int64
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679218779"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218781"><span class="hs-identifier hs-var">ptr</span></a></span><span>
</span><span id="line-294"></span><span class="annot"><a href="CFG.Build.html#allocaOnStack"><span class="hs-identifier hs-var">allocaOnStack</span></a></span><span> </span><span id="local-6989586621679218784"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679218784"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679218785"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218785"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679218786"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218786"><span class="hs-identifier hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-295"></span><span>  </span><span id="local-6989586621679218787"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218787"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; Locality -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newVar"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679218784"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="AST.html#Ptr"><span class="hs-identifier hs-var">AST.Ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218785"><span class="hs-identifier hs-var">tpe</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218786"><span class="hs-identifier hs-var">sl</span></a></span><span> </span><span class="annot"><span class="annottext">Locality
</span><a href="SSA.html#Local"><span class="hs-identifier hs-var">Local</span></a></span><span>
</span><span id="line-296"></span><span>  </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Type -&gt; Maybe Int64 -&gt; SSA
</span><a href="SSA.html#Alloca"><span class="hs-identifier hs-var">Alloca</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218787"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218785"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int64
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-297"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218787"><span class="hs-identifier hs-var">ptr</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="annot"><a href="CFG.Build.html#newGlobal"><span class="hs-identifier hs-type">newGlobal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AST.html#Type"><span class="hs-identifier hs-type">AST.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Util.SourceLoc.html#Range"><span class="hs-identifier hs-type">SL.Range</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="SSA.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-300"></span><span id="newGlobal"><span class="annot"><span class="annottext">newGlobal :: Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newGlobal"><span class="hs-identifier hs-var hs-var">newGlobal</span></a></span></span><span> </span><span id="local-6989586621679218790"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218790"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679218791"><span class="annot"><span class="annottext">tpe :: Type
</span><a href="#local-6989586621679218791"><span class="hs-identifier hs-var">tpe</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="AST.html#ArrayType"><span class="hs-identifier hs-type">AST.ArrayType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679218792"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218792"><span class="hs-identifier hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-301"></span><span>  </span><span id="local-6989586621679218793"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218793"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#astScope</span></span><span>
</span><span id="line-302"></span><span>  </span><span class="annot"><span class="annottext">ScopeID -&gt; CFGBuild ()
</span><a href="CFG.Build.html#setASTScope"><span class="hs-identifier hs-var">setASTScope</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><span class="hs-number">0</span></span><span>
</span><span id="line-303"></span><span>  </span><span id="local-6989586621679218794"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218794"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; Locality -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newVar"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218790"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218791"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218792"><span class="hs-identifier hs-var">sl</span></a></span><span> </span><span class="annot"><span class="annottext">Locality
</span><a href="SSA.html#Global"><span class="hs-identifier hs-var">Global</span></a></span><span>
</span><span id="line-304"></span><span>  </span><span class="annot"><span class="annottext">ScopeID -&gt; CFGBuild ()
</span><a href="CFG.Build.html#setASTScope"><span class="hs-identifier hs-var">setASTScope</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218793"><span class="hs-identifier hs-var">sid</span></a></span><span>
</span><span id="line-305"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218794"><span class="hs-identifier hs-var">ptr</span></a></span><span>
</span><span id="line-306"></span><span class="annot"><a href="CFG.Build.html#newGlobal"><span class="hs-identifier hs-var">newGlobal</span></a></span><span> </span><span id="local-6989586621679218796"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218796"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679218797"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218797"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679218798"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218798"><span class="hs-identifier hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-307"></span><span>  </span><span id="local-6989586621679218799"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218799"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#astScope</span></span><span>
</span><span id="line-308"></span><span>  </span><span class="annot"><span class="annottext">ScopeID -&gt; CFGBuild ()
</span><a href="CFG.Build.html#setASTScope"><span class="hs-identifier hs-var">setASTScope</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><span class="hs-number">0</span></span><span>
</span><span id="line-309"></span><span>  </span><span id="local-6989586621679218800"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218800"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; Locality -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newVar"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218796"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="AST.html#Ptr"><span class="hs-identifier hs-var">AST.Ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218797"><span class="hs-identifier hs-var">tpe</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218798"><span class="hs-identifier hs-var">sl</span></a></span><span> </span><span class="annot"><span class="annottext">Locality
</span><a href="SSA.html#Global"><span class="hs-identifier hs-var">Global</span></a></span><span>
</span><span id="line-310"></span><span>  </span><span class="annot"><span class="annottext">ScopeID -&gt; CFGBuild ()
</span><a href="CFG.Build.html#setASTScope"><span class="hs-identifier hs-var">setASTScope</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218799"><span class="hs-identifier hs-var">sid</span></a></span><span>
</span><span id="line-311"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218800"><span class="hs-identifier hs-var">ptr</span></a></span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span class="hs-comment">{-----------------------------------------------------------
Basic block manipulations
------------------------------------------------------------}</span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span class="annot"><a href="CFG.Build.html#createEmptyBB"><span class="hs-identifier hs-type">createEmptyBB</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span>
</span><span id="line-318"></span><span id="createEmptyBB"><span class="annot"><span class="annottext">createEmptyBB :: CFGBuild ScopeID
</span><a href="CFG.Build.html#createEmptyBB"><span class="hs-identifier hs-var hs-var">createEmptyBB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-319"></span><span>  </span><span class="annot"><span class="annottext">CFGBuild ()
</span><a href="CFG.Build.html#checkStmts"><span class="hs-identifier hs-var">checkStmts</span></a></span><span class="hs-cpp">
  #currentBBID += 1
</span><span>  </span><span id="local-6989586621679218803"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218803"><span class="hs-identifier hs-var">bbid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#currentBBID</span></span><span>
</span><span id="line-322"></span><span>  </span><span id="local-6989586621679218804"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218804"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#astScope</span></span><span>
</span><span id="line-323"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679218805"><span class="annot"><span class="annottext">bb :: BasicBlock
</span><a href="#local-6989586621679218805"><span class="hs-identifier hs-var hs-var">bb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; ScopeID -&gt; [SSA] -&gt; BasicBlock
</span><a href="CFG.Types.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218803"><span class="hs-identifier hs-var">bbid</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218804"><span class="hs-identifier hs-var">sid</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-324"></span><span>  </span><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a. GraphBuilder ScopeID BasicBlock CFGEdge a -&gt; CFGBuild ()
</span><a href="CFG.Build.html#updateCFG"><span class="hs-identifier hs-var">updateCFG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeID -&gt; BasicBlock -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni nd ed.
(Eq ni, Ord ni) =&gt;
ni -&gt; nd -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addNode"><span class="hs-identifier hs-var">G.addNode</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218803"><span class="hs-identifier hs-var">bbid</span></a></span><span> </span><span class="annot"><span class="annottext">BasicBlock
</span><a href="#local-6989586621679218805"><span class="hs-identifier hs-var">bb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>  </span><span class="annot"><span class="annottext">ScopeID -&gt; CFGBuild ScopeID
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218803"><span class="hs-identifier hs-var">bbid</span></a></span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="annot"><a href="CFG.Build.html#finishCurrentBB"><span class="hs-identifier hs-type">finishCurrentBB</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span>
</span><span id="line-328"></span><span id="finishCurrentBB"><span class="annot"><span class="annottext">finishCurrentBB :: CFGBuild ScopeID
</span><a href="CFG.Build.html#finishCurrentBB"><span class="hs-identifier hs-var hs-var">finishCurrentBB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-329"></span><span>  </span><span id="local-6989586621679218809"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218809"><span class="hs-identifier hs-var">bbid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#currentBBID</span></span><span>
</span><span id="line-330"></span><span>  </span><span id="local-6989586621679218810"><span class="annot"><span class="annottext">[SSA]
</span><a href="#local-6989586621679218810"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting [SSA] CFGState [SSA] -&gt; CFGBuild [SSA]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting [SSA] CFGState [SSA]
</span><span class="">#statements</span></span><span>
</span><span id="line-331"></span><span>  </span><span id="local-6989586621679218811"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218811"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#astScope</span></span><span class="hs-cpp">
  #statements .= []
</span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679218812"><span class="annot"><span class="annottext">bb :: BasicBlock
</span><a href="#local-6989586621679218812"><span class="hs-identifier hs-var hs-var">bb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; ScopeID -&gt; [SSA] -&gt; BasicBlock
</span><a href="CFG.Types.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218809"><span class="hs-identifier hs-var">bbid</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218811"><span class="hs-identifier hs-var">sid</span></a></span><span> </span><span class="annot"><span class="annottext">[SSA]
</span><a href="#local-6989586621679218810"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-334"></span><span>  </span><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a. GraphBuilder ScopeID BasicBlock CFGEdge a -&gt; CFGBuild ()
</span><a href="CFG.Build.html#updateCFG"><span class="hs-identifier hs-var">updateCFG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeID -&gt; BasicBlock -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni nd ed.
(Eq ni, Ord ni) =&gt;
ni -&gt; nd -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addNode"><span class="hs-identifier hs-var">G.addNode</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218809"><span class="hs-identifier hs-var">bbid</span></a></span><span> </span><span class="annot"><span class="annottext">BasicBlock
</span><a href="#local-6989586621679218812"><span class="hs-identifier hs-var">bb</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
  #currentBBID += 1
</span><span>  </span><span class="annot"><span class="annottext">ScopeID -&gt; CFGBuild ScopeID
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218809"><span class="hs-identifier hs-var">bbid</span></a></span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span class="annot"><a href="CFG.Build.html#checkStmts"><span class="hs-identifier hs-type">checkStmts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span id="checkStmts"><span class="annot"><span class="annottext">checkStmts :: CFGBuild ()
</span><a href="CFG.Build.html#checkStmts"><span class="hs-identifier hs-var hs-var">checkStmts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-340"></span><span>  </span><span id="local-6989586621679218813"><span class="annot"><span class="annottext">[SSA]
</span><a href="#local-6989586621679218813"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting [SSA] CFGState [SSA] -&gt; CFGBuild [SSA]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting [SSA] CFGState [SSA]
</span><span class="">#statements</span></span><span>
</span><span id="line-341"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; CFGBuild () -&gt; CFGBuild ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SSA] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[SSA]
</span><a href="#local-6989586621679218813"><span class="hs-identifier hs-var">stmts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CFGBuild () -&gt; CFGBuild ()) -&gt; CFGBuild () -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild ()
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild ()) -&gt; CompileError -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Range
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; CompileError) -&gt; Name -&gt; CompileError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Name
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Name) -&gt; [Char] -&gt; Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Dangling statements found: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[SSA] -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[SSA]
</span><a href="#local-6989586621679218813"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span class="annot"><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-type">addSSA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="SSA.html#SSA"><span class="hs-identifier hs-type">SSA</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span id="addSSA"><span class="annot"><span class="annottext">addSSA :: SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var hs-var">addSSA</span></a></span></span><span> </span><span id="local-6989586621679218818"><span class="annot"><span class="annottext">SSA
</span><a href="#local-6989586621679218818"><span class="hs-identifier hs-var">ssa</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-345"></span><span>  </span><span id="local-6989586621679218819"><span class="annot"><span class="annottext">[SSA]
</span><a href="#local-6989586621679218819"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting [SSA] CFGState [SSA] -&gt; CFGBuild [SSA]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting [SSA] CFGState [SSA]
</span><span class="">#statements</span></span><span class="hs-cpp">
  #statements .= stmts ++ [ssa]
</span><span>
</span><span id="line-348"></span><span class="hs-comment">{-----------------------------------------------------------
Functionalities to help adding phi nodes.

We do this in 4 steps:
1. Decide which symbols are required to be handled by phi nodes with inferPhiList.
   This relies on symbol modification information gathered in semantic analysis
   pass. Due to backward edges introduced by loops this information is
   not very convinient to get in the current module unless we add another pass.
2. Add dummy phi nodes at the start of control flow merging points.
3. For each symbol gathered in step 1, record which SSA var corresponds to it
   at the end each diverging control flow. The order of step 2 and 3 depends on
   the type of control flow we are dealing with.
4. Patch SSA var and its source basic block (from step 3) into dummy phi nodes
   added by step 2.
------------------------------------------------------------}</span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span class="annot"><a href="CFG.Build.html#findOuterScopes"><span class="hs-identifier hs-type">findOuterScopes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span id="findOuterScopes"><span class="annot"><span class="annottext">findOuterScopes :: CFGBuild (Set ScopeID)
</span><a href="CFG.Build.html#findOuterScopes"><span class="hs-identifier hs-var hs-var">findOuterScopes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-366"></span><span>  </span><span class="hs-comment">-- Set.fromList $ lookup scope sts</span><span>
</span><span id="line-367"></span><span>  </span><span id="local-6989586621679218821"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218821"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#astScope</span></span><span>
</span><span id="line-368"></span><span>  </span><span id="local-6989586621679218822"><span class="annot"><span class="annottext">Map ScopeID SymbolTable
</span><a href="#local-6989586621679218822"><span class="hs-identifier hs-var">sts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting
  (Map ScopeID SymbolTable) CFGContext (Map ScopeID SymbolTable)
-&gt; CFGBuild (Map ScopeID SymbolTable)
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SemanticInfo -&gt; Const (Map ScopeID SymbolTable) SemanticInfo)
-&gt; CFGContext -&gt; Const (Map ScopeID SymbolTable) CFGContext
</span><span class="">#semantic</span></span><span> </span><span class="annot"><span class="annottext">((SemanticInfo -&gt; Const (Map ScopeID SymbolTable) SemanticInfo)
 -&gt; CFGContext -&gt; Const (Map ScopeID SymbolTable) CFGContext)
-&gt; ((Map ScopeID SymbolTable
     -&gt; Const (Map ScopeID SymbolTable) (Map ScopeID SymbolTable))
    -&gt; SemanticInfo -&gt; Const (Map ScopeID SymbolTable) SemanticInfo)
-&gt; Getting
     (Map ScopeID SymbolTable) CFGContext (Map ScopeID SymbolTable)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map ScopeID SymbolTable
 -&gt; Const (Map ScopeID SymbolTable) (Map ScopeID SymbolTable))
-&gt; SemanticInfo -&gt; Const (Map ScopeID SymbolTable) SemanticInfo
</span><span class="">#symbolTables</span></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>  </span><span class="annot"><span class="annottext">Set ScopeID -&gt; CFGBuild (Set ScopeID)
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Set ScopeID -&gt; CFGBuild (Set ScopeID))
-&gt; Set ScopeID -&gt; CFGBuild (Set ScopeID)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ScopeID] -&gt; Set ScopeID
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([ScopeID] -&gt; Set ScopeID) -&gt; [ScopeID] -&gt; Set ScopeID
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; Map ScopeID SymbolTable -&gt; [ScopeID]
</span><a href="#local-6989586621679218824"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218821"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScopeID SymbolTable
</span><a href="#local-6989586621679218822"><span class="hs-identifier hs-var">sts</span></a></span><span>
</span><span id="line-370"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-371"></span><span>    </span><span class="annot"><a href="#local-6989586621679218824"><span class="hs-identifier hs-type">lookup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span> </span><span class="annot"><a href="Semantic.html#SymbolTable"><span class="hs-identifier hs-type">SE.SymbolTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-372"></span><span>    </span><span id="local-6989586621679218824"><span class="annot"><span class="annottext">lookup :: ScopeID -&gt; Map ScopeID SymbolTable -&gt; [ScopeID]
</span><a href="#local-6989586621679218824"><span class="hs-identifier hs-var hs-var">lookup</span></a></span></span><span> </span><span id="local-6989586621679218825"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218825"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span id="local-6989586621679218826"><span class="annot"><span class="annottext">Map ScopeID SymbolTable
</span><a href="#local-6989586621679218826"><span class="hs-identifier hs-var">sts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-373"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; Map ScopeID SymbolTable -&gt; Maybe SymbolTable
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218825"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScopeID SymbolTable
</span><a href="#local-6989586621679218826"><span class="hs-identifier hs-var">sts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-374"></span><span>        </span><span class="annot"><span class="annottext">Maybe SymbolTable
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-375"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679218827"><span class="annot"><span class="annottext">SymbolTable
</span><a href="#local-6989586621679218827"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Getting (Maybe SymbolTable) SymbolTable (Maybe SymbolTable)
-&gt; SymbolTable -&gt; Maybe SymbolTable
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting (Maybe SymbolTable) SymbolTable (Maybe SymbolTable)
</span><span class="">#parent</span></span><span> </span><span class="annot"><span class="annottext">SymbolTable
</span><a href="#local-6989586621679218827"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-376"></span><span>          </span><span class="annot"><span class="annottext">Maybe SymbolTable
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218825"><span class="hs-identifier hs-var">scope</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-377"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679218828"><span class="annot"><span class="annottext">SymbolTable
</span><a href="#local-6989586621679218828"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-378"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679218829"><span class="annot"><span class="annottext">parentSID :: ScopeID
</span><a href="#local-6989586621679218829"><span class="hs-identifier hs-var hs-var">parentSID</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID SymbolTable ScopeID -&gt; SymbolTable -&gt; ScopeID
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID SymbolTable ScopeID
</span><span class="">#scopeID</span></span><span> </span><span class="annot"><span class="annottext">SymbolTable
</span><a href="#local-6989586621679218828"><span class="hs-identifier hs-var">parent</span></a></span><span>
</span><span id="line-379"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218825"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; [ScopeID] -&gt; [ScopeID]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; Map ScopeID SymbolTable -&gt; [ScopeID]
</span><a href="#local-6989586621679218824"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218829"><span class="hs-identifier hs-var">parentSID</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScopeID SymbolTable
</span><a href="#local-6989586621679218826"><span class="hs-identifier hs-var">sts</span></a></span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span class="annot"><a href="CFG.Build.html#inferPhiList"><span class="hs-identifier hs-type">inferPhiList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-382"></span><span id="inferPhiList"><span class="annot"><span class="annottext">inferPhiList :: [ScopeID] -&gt; CFGBuild [(ScopeID, Name)]
</span><a href="CFG.Build.html#inferPhiList"><span class="hs-identifier hs-var hs-var">inferPhiList</span></a></span></span><span> </span><span id="local-6989586621679218831"><span class="annot"><span class="annottext">[ScopeID]
</span><a href="#local-6989586621679218831"><span class="hs-identifier hs-var">divergence</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-383"></span><span>  </span><span id="local-6989586621679218832"><span class="annot"><span class="annottext">Set ScopeID
</span><a href="#local-6989586621679218832"><span class="hs-identifier hs-var">outerScopes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild (Set ScopeID)
</span><a href="CFG.Build.html#findOuterScopes"><span class="hs-identifier hs-var">findOuterScopes</span></a></span><span>
</span><span id="line-384"></span><span>  </span><span id="local-6989586621679218833"><span class="annot"><span class="annottext">Map ScopeID (Set (ScopeID, Name))
</span><a href="#local-6989586621679218833"><span class="hs-identifier hs-var">varWrites</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting
  (Map ScopeID (Set (ScopeID, Name)))
  CFGContext
  (Map ScopeID (Set (ScopeID, Name)))
-&gt; CFGBuild (Map ScopeID (Set (ScopeID, Name)))
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">(Getting
   (Map ScopeID (Set (ScopeID, Name)))
   CFGContext
   (Map ScopeID (Set (ScopeID, Name)))
 -&gt; CFGBuild (Map ScopeID (Set (ScopeID, Name))))
-&gt; Getting
     (Map ScopeID (Set (ScopeID, Name)))
     CFGContext
     (Map ScopeID (Set (ScopeID, Name)))
-&gt; CFGBuild (Map ScopeID (Set (ScopeID, Name)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(SemanticInfo
 -&gt; Const (Map ScopeID (Set (ScopeID, Name))) SemanticInfo)
-&gt; CFGContext
-&gt; Const (Map ScopeID (Set (ScopeID, Name))) CFGContext
</span><span class="">#semantic</span></span><span> </span><span class="annot"><span class="annottext">((SemanticInfo
  -&gt; Const (Map ScopeID (Set (ScopeID, Name))) SemanticInfo)
 -&gt; CFGContext
 -&gt; Const (Map ScopeID (Set (ScopeID, Name))) CFGContext)
-&gt; ((Map ScopeID (Set (ScopeID, Name))
     -&gt; Const
          (Map ScopeID (Set (ScopeID, Name)))
          (Map ScopeID (Set (ScopeID, Name))))
    -&gt; SemanticInfo
    -&gt; Const (Map ScopeID (Set (ScopeID, Name))) SemanticInfo)
-&gt; Getting
     (Map ScopeID (Set (ScopeID, Name)))
     CFGContext
     (Map ScopeID (Set (ScopeID, Name)))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map ScopeID (Set (ScopeID, Name))
 -&gt; Const
      (Map ScopeID (Set (ScopeID, Name)))
      (Map ScopeID (Set (ScopeID, Name))))
-&gt; SemanticInfo
-&gt; Const (Map ScopeID (Set (ScopeID, Name))) SemanticInfo
</span><span class="">#symbolWrites</span></span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679218834"><span class="annot"><span class="annottext">varList :: [(ScopeID, Name)]
</span><a href="#local-6989586621679218834"><span class="hs-identifier hs-var hs-var">varList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-386"></span><span>        </span><span class="annot"><span class="annottext">((ScopeID, Name) -&gt; Bool) -&gt; [(ScopeID, Name)] -&gt; [(ScopeID, Name)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679218835"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218835"><span class="hs-identifier hs-var">sid</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; Set ScopeID -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218835"><span class="hs-identifier hs-var">sid</span></a></span><span> </span><span class="annot"><span class="annottext">Set ScopeID
</span><a href="#local-6989586621679218832"><span class="hs-identifier hs-var">outerScopes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(ScopeID, Name)] -&gt; [(ScopeID, Name)])
-&gt; [(ScopeID, Name)] -&gt; [(ScopeID, Name)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-387"></span><span>          </span><span class="annot"><span class="annottext">Set (ScopeID, Name) -&gt; [(ScopeID, Name)]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set (ScopeID, Name) -&gt; [(ScopeID, Name)])
-&gt; Set (ScopeID, Name) -&gt; [(ScopeID, Name)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-388"></span><span>            </span><span class="annot"><span class="annottext">[Set (ScopeID, Name)] -&gt; Set (ScopeID, Name)
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><span class="hs-identifier hs-var">Set.unions</span></span><span> </span><span class="annot"><span class="annottext">([Set (ScopeID, Name)] -&gt; Set (ScopeID, Name))
-&gt; [Set (ScopeID, Name)] -&gt; Set (ScopeID, Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-389"></span><span>              </span><span class="annot"><span class="annottext">(ScopeID -&gt; Maybe (Set (ScopeID, Name)))
-&gt; [ScopeID] -&gt; [Set (ScopeID, Name)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeID
-&gt; Map ScopeID (Set (ScopeID, Name)) -&gt; Maybe (Set (ScopeID, Name))
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-operator hs-var">`Map.lookup`</span></span><span> </span><span class="annot"><span class="annottext">Map ScopeID (Set (ScopeID, Name))
</span><a href="#local-6989586621679218833"><span class="hs-identifier hs-var">varWrites</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ScopeID]
</span><a href="#local-6989586621679218831"><span class="hs-identifier hs-var">divergence</span></a></span><span>
</span><span id="line-390"></span><span>  </span><span class="annot"><span class="annottext">[(ScopeID, Name)] -&gt; CFGBuild [(ScopeID, Name)]
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[(ScopeID, Name)]
</span><a href="#local-6989586621679218834"><span class="hs-identifier hs-var">varList</span></a></span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span class="annot"><a href="CFG.Build.html#addDummyPhiNode"><span class="hs-identifier hs-type">addDummyPhiNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span id="addDummyPhiNode"><span class="annot"><span class="annottext">addDummyPhiNode :: [(ScopeID, Name)] -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addDummyPhiNode"><span class="hs-identifier hs-var hs-var">addDummyPhiNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-394"></span><span>  </span><span class="annot"><span class="annottext">((ScopeID, Name) -&gt; CFGBuild ())
-&gt; [(ScopeID, Name)] -&gt; CFGBuild ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span>
</span><span id="line-395"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679218841"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218841"><span class="hs-identifier hs-var">sid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679218842"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218842"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-396"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679218843"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218843"><span class="hs-identifier hs-var">tpe</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679218844"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218844"><span class="hs-identifier hs-var">sl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; Name -&gt; CFGBuild (Type, Range)
</span><a href="#local-6989586621679218845"><span class="hs-identifier hs-var">getTypeAndSL</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218841"><span class="hs-identifier hs-var">sid</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218842"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-397"></span><span>        </span><span id="local-6989586621679218846"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218846"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218842"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218843"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218844"><span class="hs-identifier hs-var">sl</span></a></span><span>
</span><span id="line-398"></span><span>        </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [(Var, ScopeID)] -&gt; SSA
</span><a href="SSA.html#Phi"><span class="hs-identifier hs-var">Phi</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218846"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-399"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-401"></span><span>    </span><span class="annot"><a href="#local-6989586621679218845"><span class="hs-identifier hs-type">getTypeAndSL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Type"><span class="hs-identifier hs-type">AST.Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Util.SourceLoc.html#Range"><span class="hs-identifier hs-type">SL.Range</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>    </span><span id="local-6989586621679218845"><span class="annot"><span class="annottext">getTypeAndSL :: ScopeID -&gt; Name -&gt; CFGBuild (Type, Range)
</span><a href="#local-6989586621679218845"><span class="hs-identifier hs-var hs-var">getTypeAndSL</span></a></span></span><span> </span><span id="local-6989586621679218848"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218848"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span id="local-6989586621679218849"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218849"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-403"></span><span>      </span><span id="local-6989586621679218850"><span class="annot"><span class="annottext">Map ScopeID SymbolTable
</span><a href="#local-6989586621679218850"><span class="hs-identifier hs-var">sts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting
  (Map ScopeID SymbolTable) CFGContext (Map ScopeID SymbolTable)
-&gt; CFGBuild (Map ScopeID SymbolTable)
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">(Getting
   (Map ScopeID SymbolTable) CFGContext (Map ScopeID SymbolTable)
 -&gt; CFGBuild (Map ScopeID SymbolTable))
-&gt; Getting
     (Map ScopeID SymbolTable) CFGContext (Map ScopeID SymbolTable)
-&gt; CFGBuild (Map ScopeID SymbolTable)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(SemanticInfo -&gt; Const (Map ScopeID SymbolTable) SemanticInfo)
-&gt; CFGContext -&gt; Const (Map ScopeID SymbolTable) CFGContext
</span><span class="">#semantic</span></span><span> </span><span class="annot"><span class="annottext">((SemanticInfo -&gt; Const (Map ScopeID SymbolTable) SemanticInfo)
 -&gt; CFGContext -&gt; Const (Map ScopeID SymbolTable) CFGContext)
-&gt; ((Map ScopeID SymbolTable
     -&gt; Const (Map ScopeID SymbolTable) (Map ScopeID SymbolTable))
    -&gt; SemanticInfo -&gt; Const (Map ScopeID SymbolTable) SemanticInfo)
-&gt; Getting
     (Map ScopeID SymbolTable) CFGContext (Map ScopeID SymbolTable)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map ScopeID SymbolTable
 -&gt; Const (Map ScopeID SymbolTable) (Map ScopeID SymbolTable))
-&gt; SemanticInfo -&gt; Const (Map ScopeID SymbolTable) SemanticInfo
</span><span class="">#symbolTables</span></span><span>
</span><span id="line-404"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; Map ScopeID SymbolTable -&gt; Maybe SymbolTable
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218848"><span class="hs-identifier hs-var">sid</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScopeID SymbolTable
</span><a href="#local-6989586621679218850"><span class="hs-identifier hs-var">sts</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SymbolTable
-&gt; (SymbolTable -&gt; Maybe (Either Argument FieldDecl))
-&gt; Maybe (Either Argument FieldDecl)
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SymbolTable -&gt; Maybe (Either Argument FieldDecl)
</span><a href="Semantic.html#lookupLocalVariableFromST"><span class="hs-identifier hs-var">SE.lookupLocalVariableFromST</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218849"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-405"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Either Argument FieldDecl)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild (Type, Range)
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild (Type, Range))
-&gt; CompileError -&gt; CFGBuild (Type, Range)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Range
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; CompileError) -&gt; Name -&gt; CompileError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format Name (Name -&gt; ScopeID -&gt; Name) -&gt; Name -&gt; ScopeID -&gt; Name
forall a. Format Name a -&gt; a
</span><span class="hs-identifier hs-var">sformat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format (Name -&gt; ScopeID -&gt; Name) (Name -&gt; ScopeID -&gt; Name)
</span><span class="hs-string">&quot;Unable to find variable&quot;</span></span><span> </span><span class="annot"><span class="annottext">Format (Name -&gt; ScopeID -&gt; Name) (Name -&gt; ScopeID -&gt; Name)
-&gt; Format Name (Name -&gt; ScopeID -&gt; Name)
-&gt; Format Name (Name -&gt; ScopeID -&gt; Name)
forall r a r'. Format r a -&gt; Format r' r -&gt; Format r' a
</span><span class="hs-operator hs-var">%+</span></span><span> </span><span class="annot"><span class="annottext">Format (ScopeID -&gt; Name) (Name -&gt; ScopeID -&gt; Name)
forall r. Format r (Name -&gt; r)
</span><span class="hs-identifier hs-var">stext</span></span><span> </span><span class="annot"><span class="annottext">Format (ScopeID -&gt; Name) (Name -&gt; ScopeID -&gt; Name)
-&gt; Format Name (ScopeID -&gt; Name)
-&gt; Format Name (Name -&gt; ScopeID -&gt; Name)
forall r a r'. Format r a -&gt; Format r' r -&gt; Format r' a
</span><span class="hs-operator hs-var">%+</span></span><span> </span><span class="annot"><span class="annottext">Format (ScopeID -&gt; Name) (ScopeID -&gt; Name)
</span><span class="hs-string">&quot;in scope&quot;</span></span><span> </span><span class="annot"><span class="annottext">Format (ScopeID -&gt; Name) (ScopeID -&gt; Name)
-&gt; Format Name (ScopeID -&gt; Name) -&gt; Format Name (ScopeID -&gt; Name)
forall r a r'. Format r a -&gt; Format r' r -&gt; Format r' a
</span><span class="hs-operator hs-var">%+</span></span><span> </span><span class="annot"><span class="annottext">Format Name (ScopeID -&gt; Name)
forall a r. Integral a =&gt; Format r (a -&gt; r)
</span><span class="hs-identifier hs-var">int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218849"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218848"><span class="hs-identifier hs-var">sid</span></a></span><span>
</span><span id="line-406"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679218851"><span class="annot"><span class="annottext">Either Argument FieldDecl
</span><a href="#local-6989586621679218851"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-407"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679218852"><span class="annot"><span class="annottext">tpe :: Type
</span><a href="#local-6989586621679218852"><span class="hs-identifier hs-var hs-var">tpe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Argument -&gt; Type)
-&gt; (FieldDecl -&gt; Type) -&gt; Either Argument FieldDecl -&gt; Type
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting Type Argument Type -&gt; Argument -&gt; Type
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting Type Argument Type
</span><span class="">#tpe</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting Type FieldDecl Type -&gt; FieldDecl -&gt; Type
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting Type FieldDecl Type
</span><span class="">#tpe</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either Argument FieldDecl
</span><a href="#local-6989586621679218851"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-408"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679218854"><span class="annot"><span class="annottext">sl :: Range
</span><a href="#local-6989586621679218854"><span class="hs-identifier hs-var hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Argument -&gt; Range)
-&gt; (FieldDecl -&gt; Range) -&gt; Either Argument FieldDecl -&gt; Range
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting Range Argument Range -&gt; Argument -&gt; Range
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting Range Argument Range
</span><span class="">#loc</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting Range FieldDecl Range -&gt; FieldDecl -&gt; Range
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting Range FieldDecl Range
</span><span class="">#loc</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either Argument FieldDecl
</span><a href="#local-6989586621679218851"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-409"></span><span>          </span><span class="annot"><span class="annottext">(Type, Range) -&gt; CFGBuild (Type, Range)
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218852"><span class="hs-identifier hs-var">tpe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218854"><span class="hs-identifier hs-var">sl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span class="annot"><a href="CFG.Build.html#recordPhiVar"><span class="hs-identifier hs-type">recordPhiVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="SSA.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span id="recordPhiVar"><span class="annot"><span class="annottext">recordPhiVar :: [(ScopeID, Name)] -&gt; CFGBuild (Map (ScopeID, Name) Var)
</span><a href="CFG.Build.html#recordPhiVar"><span class="hs-identifier hs-var hs-var">recordPhiVar</span></a></span></span><span> </span><span id="local-6989586621679218856"><span class="annot"><span class="annottext">[(ScopeID, Name)]
</span><a href="#local-6989586621679218856"><span class="hs-identifier hs-var">symList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-413"></span><span>  </span><span id="local-6989586621679218857"><span class="annot"><span class="annottext">[((ScopeID, Name), Var)]
</span><a href="#local-6989586621679218857"><span class="hs-identifier hs-var">varList</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-414"></span><span>    </span><span class="annot"><span class="annottext">((ScopeID, Name) -&gt; CFGBuild ((ScopeID, Name), Var))
-&gt; [(ScopeID, Name)] -&gt; CFGBuild [((ScopeID, Name), Var)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span>
</span><span id="line-415"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679218859"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218859"><span class="hs-identifier hs-var">sid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679218860"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218860"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-416"></span><span>          </span><span id="local-6989586621679218861"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218861"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; ScopeID -&gt; CFGBuild Var
</span><a href="CFG.Build.html#lookupSymInScope%27"><span class="hs-identifier hs-var">lookupSymInScope'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218860"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218859"><span class="hs-identifier hs-var">sid</span></a></span><span>
</span><span id="line-417"></span><span>          </span><span class="annot"><span class="annottext">((ScopeID, Name), Var) -&gt; CFGBuild ((ScopeID, Name), Var)
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218859"><span class="hs-identifier hs-var">sid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218860"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218861"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>      </span><span class="annot"><span class="annottext">[(ScopeID, Name)]
</span><a href="#local-6989586621679218856"><span class="hs-identifier hs-var">symList</span></a></span><span>
</span><span id="line-420"></span><span>  </span><span class="annot"><span class="annottext">Map (ScopeID, Name) Var -&gt; CFGBuild (Map (ScopeID, Name) Var)
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Map (ScopeID, Name) Var -&gt; CFGBuild (Map (ScopeID, Name) Var))
-&gt; Map (ScopeID, Name) Var -&gt; CFGBuild (Map (ScopeID, Name) Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[((ScopeID, Name), Var)] -&gt; Map (ScopeID, Name) Var
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">[((ScopeID, Name), Var)]
</span><a href="#local-6989586621679218857"><span class="hs-identifier hs-var">varList</span></a></span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span class="annot"><a href="CFG.Build.html#patchPhiNode"><span class="hs-identifier hs-type">patchPhiNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="SSA.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#ScopeID"><span class="hs-identifier hs-type">ScopeID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="SSA.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span id="patchPhiNode"><span class="annot"><span class="annottext">patchPhiNode :: ScopeID
-&gt; ScopeID
-&gt; Map (ScopeID, Name) Var
-&gt; ScopeID
-&gt; Map (ScopeID, Name) Var
-&gt; CFGBuild ()
</span><a href="CFG.Build.html#patchPhiNode"><span class="hs-identifier hs-var hs-var">patchPhiNode</span></a></span></span><span> </span><span id="local-6989586621679218863"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218863"><span class="hs-identifier hs-var">bb</span></a></span></span><span> </span><span id="local-6989586621679218864"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218864"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621679218865"><span class="annot"><span class="annottext">Map (ScopeID, Name) Var
</span><a href="#local-6989586621679218865"><span class="hs-identifier hs-var">varMap1</span></a></span></span><span> </span><span id="local-6989586621679218866"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218866"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span id="local-6989586621679218867"><span class="annot"><span class="annottext">Map (ScopeID, Name) Var
</span><a href="#local-6989586621679218867"><span class="hs-identifier hs-var">varMap2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-424"></span><span>  </span><span id="local-6989586621679218868"><span class="annot"><span class="annottext">Graph ScopeID BasicBlock CFGEdge
</span><a href="#local-6989586621679218868"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild (Graph ScopeID BasicBlock CFGEdge)
</span><a href="CFG.Build.html#getGraph"><span class="hs-identifier hs-var">getGraph</span></a></span><span>
</span><span id="line-425"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; Graph ScopeID BasicBlock CFGEdge -&gt; Maybe BasicBlock
forall ni nd ed.
(Eq ni, Ord ni) =&gt;
ni -&gt; Graph ni nd ed -&gt; Maybe nd
</span><a href="Util.Graph.html#lookupNode"><span class="hs-identifier hs-var">G.lookupNode</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218863"><span class="hs-identifier hs-var">bb</span></a></span><span> </span><span class="annot"><span class="annottext">Graph ScopeID BasicBlock CFGEdge
</span><a href="#local-6989586621679218868"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-426"></span><span>    </span><span class="annot"><span class="annottext">Maybe BasicBlock
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild ()
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild ()) -&gt; CompileError -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Range
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; CompileError) -&gt; Name -&gt; CompileError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format Name (ScopeID -&gt; Name) -&gt; ScopeID -&gt; Name
forall a. Format Name a -&gt; a
</span><span class="hs-identifier hs-var">sformat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format (ScopeID -&gt; Name) (ScopeID -&gt; Name)
</span><span class="hs-string">&quot;Basic block&quot;</span></span><span> </span><span class="annot"><span class="annottext">Format (ScopeID -&gt; Name) (ScopeID -&gt; Name)
-&gt; Format Name (ScopeID -&gt; Name) -&gt; Format Name (ScopeID -&gt; Name)
forall r a r'. Format r a -&gt; Format r' r -&gt; Format r' a
</span><span class="hs-operator hs-var">%+</span></span><span> </span><span class="annot"><span class="annottext">Format Name (ScopeID -&gt; Name)
forall a r. Integral a =&gt; Format r (a -&gt; r)
</span><span class="hs-identifier hs-var">int</span></span><span> </span><span class="annot"><span class="annottext">Format Name (ScopeID -&gt; Name)
-&gt; Format Name Name -&gt; Format Name (ScopeID -&gt; Name)
forall r a r'. Format r a -&gt; Format r' r -&gt; Format r' a
</span><span class="hs-operator hs-var">%+</span></span><span> </span><span class="annot"><span class="annottext">Format Name Name
</span><span class="hs-string">&quot;not found.&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218863"><span class="hs-identifier hs-var">bb</span></a></span><span>
</span><span id="line-427"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679218869"><span class="annot"><span class="annottext">BasicBlock
</span><a href="#local-6989586621679218869"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-428"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679218870"><span class="annot"><span class="annottext">ssaList :: [SSA]
</span><a href="#local-6989586621679218870"><span class="hs-identifier hs-var hs-var">ssaList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BasicBlock
</span><a href="#local-6989586621679218869"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="annot"><span class="annottext">BasicBlock -&gt; Getting [SSA] BasicBlock [SSA] -&gt; [SSA]
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting [SSA] BasicBlock [SSA]
</span><span class="">#statements</span></span><span>
</span><span id="line-429"></span><span>      </span><span id="local-6989586621679218871"><span class="annot"><span class="annottext">[SSA]
</span><a href="#local-6989586621679218871"><span class="hs-identifier hs-var">ssaList'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild SSA) -&gt; [SSA] -&gt; CFGBuild [SSA]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild SSA
</span><a href="#local-6989586621679218872"><span class="hs-identifier hs-var">patch</span></a></span><span> </span><span class="annot"><span class="annottext">[SSA]
</span><a href="#local-6989586621679218870"><span class="hs-identifier hs-var">ssaList</span></a></span><span>
</span><span id="line-430"></span><span>      </span><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a. GraphBuilder ScopeID BasicBlock CFGEdge a -&gt; CFGBuild ()
</span><a href="CFG.Build.html#updateCFG"><span class="hs-identifier hs-var">updateCFG</span></a></span><span> </span><span class="annot"><span class="annottext">(GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ())
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
-&gt; (BasicBlock -&gt; BasicBlock)
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni nd ed.
(Eq ni, Ord ni) =&gt;
ni -&gt; (nd -&gt; nd) -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#adjustNode"><span class="hs-identifier hs-var">G.adjustNode</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218863"><span class="hs-identifier hs-var">bb</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ASetter BasicBlock BasicBlock [SSA] [SSA]
</span><span class="">#statements</span></span><span> </span><span class="annot"><span class="annottext">ASetter BasicBlock BasicBlock [SSA] [SSA]
-&gt; [SSA] -&gt; BasicBlock -&gt; BasicBlock
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">[SSA]
</span><a href="#local-6989586621679218871"><span class="hs-identifier hs-var">ssaList'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-432"></span><span>    </span><span class="annot"><a href="#local-6989586621679218872"><span class="hs-identifier hs-type">patch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="SSA.html#SSA"><span class="hs-identifier hs-type">SSA</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="SSA.html#SSA"><span class="hs-identifier hs-type">SSA</span></a></span><span>
</span><span id="line-433"></span><span>    </span><span id="local-6989586621679218872"><span class="annot"><span class="annottext">patch :: SSA -&gt; CFGBuild SSA
</span><a href="#local-6989586621679218872"><span class="hs-identifier hs-var hs-var">patch</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="SSA.html#Phi"><span class="hs-identifier hs-type">Phi</span></a></span><span> </span><span id="local-6989586621679218874"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218874"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-434"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679218875"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218875"><span class="hs-identifier hs-var">sid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679218876"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218876"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; CFGBuild (ScopeID, Name)
</span><a href="CFG.Build.html#lookupVar%27"><span class="hs-identifier hs-var">lookupVar'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218874"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Getting ScopeID Var ScopeID -&gt; ScopeID
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID Var ScopeID
</span><span class="">#id</span></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679218877"><span class="annot"><span class="annottext">v1 :: Maybe Var
</span><a href="#local-6989586621679218877"><span class="hs-identifier hs-var hs-var">v1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ScopeID, Name) -&gt; Map (ScopeID, Name) Var -&gt; Maybe Var
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218875"><span class="hs-identifier hs-var">sid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218876"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (ScopeID, Name) Var
</span><a href="#local-6989586621679218865"><span class="hs-identifier hs-var">varMap1</span></a></span><span>
</span><span id="line-436"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679218878"><span class="annot"><span class="annottext">v2 :: Maybe Var
</span><a href="#local-6989586621679218878"><span class="hs-identifier hs-var hs-var">v2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ScopeID, Name) -&gt; Map (ScopeID, Name) Var -&gt; Maybe Var
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218875"><span class="hs-identifier hs-var">sid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218876"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (ScopeID, Name) Var
</span><a href="#local-6989586621679218867"><span class="hs-identifier hs-var">varMap2</span></a></span><span>
</span><span id="line-437"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621679218877"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-438"></span><span>        </span><span class="annot"><span class="annottext">Maybe Var
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild SSA
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild SSA) -&gt; CompileError -&gt; CFGBuild SSA
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Range
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; CompileError) -&gt; Name -&gt; CompileError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format Name (Name -&gt; Name) -&gt; Name -&gt; Name
forall a. Format Name a -&gt; a
</span><span class="hs-identifier hs-var">sformat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format (Name -&gt; Name) (Name -&gt; Name)
</span><span class="hs-string">&quot;Unable to find symbol&quot;</span></span><span> </span><span class="annot"><span class="annottext">Format (Name -&gt; Name) (Name -&gt; Name)
-&gt; Format Name (Name -&gt; Name) -&gt; Format Name (Name -&gt; Name)
forall r a r'. Format r a -&gt; Format r' r -&gt; Format r' a
</span><span class="hs-operator hs-var">%+</span></span><span> </span><span class="annot"><span class="annottext">Format Name (Name -&gt; Name)
forall r. Format r (Name -&gt; r)
</span><span class="hs-identifier hs-var">stext</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218876"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-439"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679218879"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218879"><span class="hs-identifier hs-var">v1'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-440"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621679218878"><span class="hs-identifier hs-var">v2</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-441"></span><span>            </span><span class="annot"><span class="annottext">Maybe Var
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild SSA
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild SSA) -&gt; CompileError -&gt; CFGBuild SSA
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Range
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; CompileError) -&gt; Name -&gt; CompileError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Format Name (Name -&gt; Name) -&gt; Name -&gt; Name
forall a. Format Name a -&gt; a
</span><span class="hs-identifier hs-var">sformat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format (Name -&gt; Name) (Name -&gt; Name)
</span><span class="hs-string">&quot;Unable to find symbol&quot;</span></span><span> </span><span class="annot"><span class="annottext">Format (Name -&gt; Name) (Name -&gt; Name)
-&gt; Format Name (Name -&gt; Name) -&gt; Format Name (Name -&gt; Name)
forall r a r'. Format r a -&gt; Format r' r -&gt; Format r' a
</span><span class="hs-operator hs-var">%+</span></span><span> </span><span class="annot"><span class="annottext">Format Name (Name -&gt; Name)
forall r. Format r (Name -&gt; r)
</span><span class="hs-identifier hs-var">stext</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218876"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-442"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679218880"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218880"><span class="hs-identifier hs-var">v2'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild SSA
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild SSA) -&gt; SSA -&gt; CFGBuild SSA
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [(Var, ScopeID)] -&gt; SSA
</span><a href="SSA.html#Phi"><span class="hs-identifier hs-var">Phi</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218874"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218879"><span class="hs-identifier hs-var">v1'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218864"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218880"><span class="hs-identifier hs-var">v2'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218866"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-443"></span><span>    </span><span class="annot"><a href="#local-6989586621679218872"><span class="hs-identifier hs-var">patch</span></a></span><span> </span><span id="local-6989586621679218881"><span class="annot"><span class="annottext">SSA
</span><a href="#local-6989586621679218881"><span class="hs-identifier hs-var">ssa</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild SSA
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">SSA
</span><a href="#local-6989586621679218881"><span class="hs-identifier hs-var">ssa</span></a></span><span>
</span><span id="line-444"></span><span>
</span><span id="line-445"></span><span class="hs-comment">{----------------------------------------
Build cfg from ast fragments
-----------------------------------------}</span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span class="annot"><a href="CFG.Build.html#buildCFGs"><span class="hs-identifier hs-type">buildCFGs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="AST.html#ASTRoot"><span class="hs-identifier hs-type">AST.ASTRoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGContext"><span class="hs-identifier hs-type">CFGContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#CompileError"><span class="hs-identifier hs-type">CompileError</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="CFG.Types.html#SingleFileCFG"><span class="hs-identifier hs-type">SingleFileCFG</span></a></span><span>
</span><span id="line-450"></span><span id="buildCFGs"><span class="annot"><span class="annottext">buildCFGs :: ASTRoot -&gt; CFGContext -&gt; Either [CompileError] SingleFileCFG
</span><a href="CFG.Build.html#buildCFGs"><span class="hs-identifier hs-var hs-var">buildCFGs</span></a></span></span><span> </span><span id="local-6989586621679218883"><span class="annot"><span class="annottext">root :: ASTRoot
</span><a href="#local-6989586621679218883"><span class="hs-identifier hs-var">root</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="AST.html#ASTRoot"><span class="hs-identifier hs-type">AST.ASTRoot</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportDecl]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[FieldDecl]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679218885"><span class="annot"><span class="annottext">[MethodDecl]
</span><a href="#local-6989586621679218885"><span class="hs-identifier hs-var">methods</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679218886"><span class="annot"><span class="annottext">CFGContext
</span><a href="#local-6989586621679218886"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-451"></span><span>  </span><span class="annot"><span class="annottext">CFGBuild SingleFileCFG
-&gt; CFGState -&gt; Either [CompileError] SingleFileCFG
</span><a href="#local-6989586621679218887"><span class="hs-identifier hs-var">runMonads</span></a></span><span> </span><span class="annot"><span class="annottext">CFGBuild SingleFileCFG
</span><a href="#local-6989586621679218888"><span class="hs-identifier hs-var">buildAll</span></a></span><span> </span><span class="annot"><span class="annottext">CFGState
</span><a href="CFG.Build.html#initialState"><span class="hs-identifier hs-var">initialState</span></a></span><span>
</span><span id="line-452"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-453"></span><span>    </span><span id="local-6989586621679218887"><span class="annot"><span class="annottext">runMonads :: CFGBuild SingleFileCFG
-&gt; CFGState -&gt; Either [CompileError] SingleFileCFG
</span><a href="#local-6989586621679218887"><span class="hs-identifier hs-var hs-var">runMonads</span></a></span></span><span> </span><span id="local-6989586621679218889"><span class="annot"><span class="annottext">CFGBuild SingleFileCFG
</span><a href="#local-6989586621679218889"><span class="hs-identifier hs-var">build</span></a></span></span><span> </span><span id="local-6989586621679218890"><span class="annot"><span class="annottext">CFGState
</span><a href="#local-6989586621679218890"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-454"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679218891"><span class="annot"><span class="annottext">Either CompileError SingleFileCFG
</span><a href="#local-6989586621679218891"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CFGState
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State CFGState (Either CompileError SingleFileCFG)
-&gt; CFGState -&gt; (Either CompileError SingleFileCFG, CFGState)
forall s a. State s a -&gt; s -&gt; (a, s)
</span><span class="hs-identifier hs-var">runState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ReaderT
   CFGContext (State CFGState) (Either CompileError SingleFileCFG)
 -&gt; CFGContext
 -&gt; State CFGState (Either CompileError SingleFileCFG))
-&gt; CFGContext
-&gt; ReaderT
     CFGContext (State CFGState) (Either CompileError SingleFileCFG)
-&gt; State CFGState (Either CompileError SingleFileCFG)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ReaderT
  CFGContext (State CFGState) (Either CompileError SingleFileCFG)
-&gt; CFGContext -&gt; State CFGState (Either CompileError SingleFileCFG)
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">CFGContext
</span><a href="#local-6989586621679218886"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT
   CFGContext (State CFGState) (Either CompileError SingleFileCFG)
 -&gt; State CFGState (Either CompileError SingleFileCFG))
-&gt; ReaderT
     CFGContext (State CFGState) (Either CompileError SingleFileCFG)
-&gt; State CFGState (Either CompileError SingleFileCFG)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExceptT
  CompileError (ReaderT CFGContext (State CFGState)) SingleFileCFG
-&gt; ReaderT
     CFGContext (State CFGState) (Either CompileError SingleFileCFG)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   CompileError (ReaderT CFGContext (State CFGState)) SingleFileCFG
 -&gt; ReaderT
      CFGContext (State CFGState) (Either CompileError SingleFileCFG))
-&gt; ExceptT
     CompileError (ReaderT CFGContext (State CFGState)) SingleFileCFG
-&gt; ReaderT
     CFGContext (State CFGState) (Either CompileError SingleFileCFG)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CFGBuild SingleFileCFG
-&gt; ExceptT
     CompileError (ReaderT CFGContext (State CFGState)) SingleFileCFG
forall a.
CFGBuild a
-&gt; ExceptT CompileError (ReaderT CFGContext (State CFGState)) a
</span><a href="CFG.Build.html#%24sel%3ArunCFGBuild%3ACFGBuild"><span class="hs-identifier hs-var">runCFGBuild</span></a></span><span> </span><span class="annot"><span class="annottext">CFGBuild SingleFileCFG
</span><a href="#local-6989586621679218889"><span class="hs-identifier hs-var">build</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CFGState
</span><a href="#local-6989586621679218890"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-455"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either CompileError SingleFileCFG
</span><a href="#local-6989586621679218891"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-456"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679218896"><span class="annot"><span class="annottext">CompileError
</span><a href="#local-6989586621679218896"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[CompileError] -&gt; Either [CompileError] SingleFileCFG
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CompileError
</span><a href="#local-6989586621679218896"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-457"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679218897"><span class="annot"><span class="annottext">SingleFileCFG
</span><a href="#local-6989586621679218897"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SingleFileCFG -&gt; Either [CompileError] SingleFileCFG
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">SingleFileCFG
</span><a href="#local-6989586621679218897"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-458"></span><span>    </span><span id="local-6989586621679218888"><span class="annot"><span class="annottext">buildAll :: CFGBuild SingleFileCFG
</span><a href="#local-6989586621679218888"><span class="hs-identifier hs-var hs-var">buildAll</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-459"></span><span>      </span><span id="local-6989586621679218898"><span class="annot"><span class="annottext">BasicBlock
</span><a href="#local-6989586621679218898"><span class="hs-identifier hs-var">globalBB</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ASTRoot -&gt; CFGBuild BasicBlock
</span><a href="CFG.Build.html#populateGlobals"><span class="hs-identifier hs-var">populateGlobals</span></a></span><span> </span><span class="annot"><span class="annottext">ASTRoot
</span><a href="#local-6989586621679218883"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-460"></span><span>      </span><span id="local-6989586621679218900"><span class="annot"><span class="annottext">Map Name CFG
</span><a href="#local-6989586621679218900"><span class="hs-identifier hs-var">cfgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-461"></span><span>        </span><span class="annot"><span class="annottext">Map Name (CFGBuild CFG) -&gt; CFGBuild (Map Name CFG)
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
forall (m :: * -&gt; *) a. Monad m =&gt; Map Name (m a) -&gt; m (Map Name a)
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="annot"><span class="annottext">(Map Name (CFGBuild CFG) -&gt; CFGBuild (Map Name CFG))
-&gt; Map Name (CFGBuild CFG) -&gt; CFGBuild (Map Name CFG)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-462"></span><span>          </span><span class="annot"><span class="annottext">[(Name, CFGBuild CFG)] -&gt; Map Name (CFGBuild CFG)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span>
</span><span id="line-463"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[MethodDecl]
</span><a href="#local-6989586621679218885"><span class="hs-identifier hs-var">methods</span></a></span><span> </span><span class="annot"><span class="annottext">[MethodDecl]
-&gt; (MethodDecl -&gt; (Name, CFGBuild CFG)) -&gt; [(Name, CFGBuild CFG)]
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679218902"><span class="annot"><span class="annottext">MethodDecl
</span><a href="#local-6989586621679218902"><span class="hs-identifier hs-var">method</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MethodDecl
</span><a href="#local-6989586621679218902"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">MethodDecl -&gt; Getting Name MethodDecl Name -&gt; Name
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">(MethodSig -&gt; Const Name MethodSig)
-&gt; MethodDecl -&gt; Const Name MethodDecl
</span><span class="">#sig</span></span><span> </span><span class="annot"><span class="annottext">((MethodSig -&gt; Const Name MethodSig)
 -&gt; MethodDecl -&gt; Const Name MethodDecl)
-&gt; ((Name -&gt; Const Name Name) -&gt; MethodSig -&gt; Const Name MethodSig)
-&gt; Getting Name MethodDecl Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Const Name Name) -&gt; MethodSig -&gt; Const Name MethodSig
</span><span class="">#name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MethodDecl -&gt; CFGBuild CFG
</span><a href="CFG.Build.html#buildMethod"><span class="hs-identifier hs-var">buildMethod</span></a></span><span> </span><span class="annot"><span class="annottext">MethodDecl
</span><a href="#local-6989586621679218902"><span class="hs-identifier hs-var">method</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span>      </span><span class="annot"><span class="annottext">SingleFileCFG -&gt; CFGBuild SingleFileCFG
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(SingleFileCFG -&gt; CFGBuild SingleFileCFG)
-&gt; SingleFileCFG -&gt; CFGBuild SingleFileCFG
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BasicBlock -&gt; Map Name CFG -&gt; SingleFileCFG
</span><a href="CFG.Types.html#SingleFileCFG"><span class="hs-identifier hs-var">SingleFileCFG</span></a></span><span> </span><span class="annot"><span class="annottext">BasicBlock
</span><a href="#local-6989586621679218898"><span class="hs-identifier hs-var">globalBB</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name CFG
</span><a href="#local-6989586621679218900"><span class="hs-identifier hs-var">cfgs</span></a></span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span class="annot"><a href="CFG.Build.html#populateGlobals"><span class="hs-identifier hs-type">populateGlobals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="AST.html#ASTRoot"><span class="hs-identifier hs-type">AST.ASTRoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="CFG.Types.html#BasicBlock"><span class="hs-identifier hs-type">BasicBlock</span></a></span><span>
</span><span id="line-467"></span><span id="populateGlobals"><span class="annot"><span class="annottext">populateGlobals :: ASTRoot -&gt; CFGBuild BasicBlock
</span><a href="CFG.Build.html#populateGlobals"><span class="hs-identifier hs-var hs-var">populateGlobals</span></a></span></span><span> </span><span id="local-6989586621679218905"><span class="annot"><span class="annottext">root :: ASTRoot
</span><a href="#local-6989586621679218905"><span class="hs-identifier hs-var">root</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="AST.html#ASTRoot"><span class="hs-identifier hs-type">AST.ASTRoot</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportDecl]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679218906"><span class="annot"><span class="annottext">[FieldDecl]
</span><a href="#local-6989586621679218906"><span class="hs-identifier hs-var">globals</span></a></span></span><span> </span><span class="annot"><span class="annottext">[MethodDecl]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-468"></span><span>  </span><span id="local-6989586621679218907"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218907"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#astScope</span></span><span>
</span><span id="line-469"></span><span>  </span><span class="annot"><span class="annottext">ScopeID -&gt; CFGBuild ()
</span><a href="CFG.Build.html#setASTScope"><span class="hs-identifier hs-var">setASTScope</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><span class="hs-number">0</span></span><span>
</span><span id="line-470"></span><span>  </span><span id="local-6989586621679218908"><span class="annot"><span class="annottext">[SSA]
</span><a href="#local-6989586621679218908"><span class="hs-identifier hs-var">allocs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-471"></span><span>    </span><span class="annot"><span class="annottext">(FieldDecl -&gt; CFGBuild SSA) -&gt; [FieldDecl] -&gt; CFGBuild [SSA]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span>
</span><span id="line-472"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="AST.html#FieldDecl"><span class="hs-identifier hs-type">AST.FieldDecl</span></a></span><span> </span><span id="local-6989586621679218910"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218910"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679218911"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218911"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679218912"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218912"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-473"></span><span>          </span><span id="local-6989586621679218913"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218913"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newGlobal"><span class="hs-identifier hs-var">newGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218910"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218911"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218912"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-474"></span><span>          </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild SSA
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild SSA) -&gt; SSA -&gt; CFGBuild SSA
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Type -&gt; SSA
</span><a href="SSA.html#InitGlobal"><span class="hs-identifier hs-var">InitGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218913"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218911"><span class="hs-identifier hs-var">tpe</span></a></span><span>
</span><span id="line-475"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>      </span><span class="annot"><span class="annottext">[FieldDecl]
</span><a href="#local-6989586621679218906"><span class="hs-identifier hs-var">globals</span></a></span><span>
</span><span id="line-477"></span><span>  </span><span class="annot"><span class="annottext">ScopeID -&gt; CFGBuild ()
</span><a href="CFG.Build.html#setASTScope"><span class="hs-identifier hs-var">setASTScope</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218907"><span class="hs-identifier hs-var">sid</span></a></span><span>
</span><span id="line-478"></span><span>  </span><span class="annot"><span class="annottext">BasicBlock -&gt; CFGBuild BasicBlock
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(BasicBlock -&gt; CFGBuild BasicBlock)
-&gt; BasicBlock -&gt; CFGBuild BasicBlock
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; ScopeID -&gt; [SSA] -&gt; BasicBlock
</span><a href="CFG.Types.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="Util.Constants.html#globalScopeID"><span class="hs-identifier hs-var">globalScopeID</span></a></span><span> </span><span class="annot"><span class="annottext">[SSA]
</span><a href="#local-6989586621679218908"><span class="hs-identifier hs-var">allocs</span></a></span><span>
</span><span id="line-479"></span><span>
</span><span id="line-480"></span><span class="annot"><a href="CFG.Build.html#buildMethod"><span class="hs-identifier hs-type">buildMethod</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="AST.html#MethodDecl"><span class="hs-identifier hs-type">AST.MethodDecl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="CFG.Types.html#CFG"><span class="hs-identifier hs-type">CFG</span></a></span><span>
</span><span id="line-481"></span><span id="buildMethod"><span class="annot"><span class="annottext">buildMethod :: MethodDecl -&gt; CFGBuild CFG
</span><a href="CFG.Build.html#buildMethod"><span class="hs-identifier hs-var hs-var">buildMethod</span></a></span></span><span> </span><span id="local-6989586621679218915"><span class="annot"><span class="annottext">decl :: MethodDecl
</span><a href="#local-6989586621679218915"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="AST.html#MethodDecl"><span class="hs-identifier hs-type">AST.MethodDecl</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:sig:MethodDecl :: MethodDecl -&gt; MethodSig
</span><a href="AST.html#%24sel%3Asig%3AMethodDecl"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679218918"><span class="annot"><span class="annottext">MethodSig
</span><a href="#local-6989586621679218918"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:block:MethodDecl :: MethodDecl -&gt; Block
</span><a href="AST.html#%24sel%3Ablock%3AMethodDecl"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679218920"><span class="annot"><span class="annottext">block :: Block
</span><a href="#local-6989586621679218920"><span class="hs-identifier hs-var">block</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Block"><span class="hs-identifier hs-type">AST.Block</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldDecl]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679218922"><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679218922"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span id="local-6989586621679218923"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218923"><span class="hs-identifier hs-var">sid</span></a></span></span><span class="hs-special">)</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-482"></span><span>  </span><span class="annot"><span class="annottext">CFGBuild ()
</span><a href="CFG.Build.html#checkStmts"><span class="hs-identifier hs-var">checkStmts</span></a></span><span>
</span><span id="line-483"></span><span>  </span><span class="annot"><span class="annottext">CFG -&gt; CFGBuild ()
</span><a href="CFG.Build.html#setCFG"><span class="hs-identifier hs-var">setCFG</span></a></span><span> </span><span class="annot"><span class="annottext">(CFG -&gt; CFGBuild ()) -&gt; CFG -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Graph ScopeID BasicBlock CFGEdge
-&gt; ScopeID -&gt; ScopeID -&gt; [Var] -&gt; MethodSig -&gt; CFG
</span><a href="CFG.Types.html#CFG"><span class="hs-identifier hs-var">CFG</span></a></span><span> </span><span class="annot"><span class="annottext">Graph ScopeID BasicBlock CFGEdge
forall ni nd ed. Graph ni nd ed
</span><a href="Util.Graph.html#empty"><span class="hs-identifier hs-var">G.empty</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">MethodSig
</span><a href="#local-6989586621679218918"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-484"></span><span>  </span><span id="local-6989586621679218926"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218926"><span class="hs-identifier hs-var">entry</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#createEmptyBB"><span class="hs-identifier hs-var">createEmptyBB</span></a></span><span>
</span><span id="line-485"></span><span>  </span><span class="annot"><span class="annottext">ScopeID -&gt; CFGBuild ()
</span><a href="CFG.Build.html#setFunctionEntry"><span class="hs-identifier hs-var">setFunctionEntry</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218926"><span class="hs-identifier hs-var">entry</span></a></span><span>
</span><span id="line-486"></span><span>  </span><span id="local-6989586621679218927"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218927"><span class="hs-identifier hs-var">exit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#createEmptyBB"><span class="hs-identifier hs-var">createEmptyBB</span></a></span><span>
</span><span id="line-487"></span><span>  </span><span class="annot"><span class="annottext">ScopeID -&gt; CFGBuild ()
</span><a href="CFG.Build.html#setFunctionExit"><span class="hs-identifier hs-var">setFunctionExit</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218927"><span class="hs-identifier hs-var">exit</span></a></span><span>
</span><span id="line-488"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679218928"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218928"><span class="hs-identifier hs-var">blockH</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679218929"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218929"><span class="hs-identifier hs-var">blockT</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679218930"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621679218930"><span class="hs-identifier hs-var">vars</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Argument] -&gt; Block -&gt; CFGBuild (ScopeID, ScopeID, [Var])
</span><a href="CFG.Build.html#buildBlock"><span class="hs-identifier hs-var">buildBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MethodSig
</span><a href="#local-6989586621679218918"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="annot"><span class="annottext">MethodSig -&gt; Getting [Argument] MethodSig [Argument] -&gt; [Argument]
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting [Argument] MethodSig [Argument]
</span><span class="">#args</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679218920"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-489"></span><span>  </span><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a. GraphBuilder ScopeID BasicBlock CFGEdge a -&gt; CFGBuild ()
</span><a href="CFG.Build.html#updateCFG"><span class="hs-identifier hs-var">updateCFG</span></a></span><span> </span><span class="annot"><span class="annottext">(GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ())
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-490"></span><span>    </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218926"><span class="hs-identifier hs-var">entry</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218928"><span class="hs-identifier hs-var">blockH</span></a></span><span> </span><span class="annot"><span class="annottext">CFGEdge
</span><a href="CFG.Types.html#SeqEdge"><span class="hs-identifier hs-var">SeqEdge</span></a></span><span>
</span><span id="line-491"></span><span>    </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218929"><span class="hs-identifier hs-var">blockT</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218927"><span class="hs-identifier hs-var">exit</span></a></span><span> </span><span class="annot"><span class="annottext">CFGEdge
</span><a href="CFG.Types.html#SeqEdge"><span class="hs-identifier hs-var">SeqEdge</span></a></span><span>
</span><span id="line-492"></span><span>  </span><span class="annot"><span class="annottext">ScopeID -&gt; CFGBuild ()
</span><a href="CFG.Build.html#replaceExitBlock"><span class="hs-identifier hs-var">replaceExitBlock</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218927"><span class="hs-identifier hs-var">exit</span></a></span><span class="hs-cpp">
  #cfg . _Just . #arguments .= vars
</span><span>  </span><span class="annot"><span class="annottext">CFGBuild CFG
</span><a href="CFG.Build.html#getCFG"><span class="hs-identifier hs-var">getCFG</span></a></span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span class="hs-comment">-- Replace previously created exit block so id's are always monotonically increasing.</span><span>
</span><span id="line-497"></span><span class="annot"><a href="CFG.Build.html#replaceExitBlock"><span class="hs-identifier hs-type">replaceExitBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span id="replaceExitBlock"><span class="annot"><span class="annottext">replaceExitBlock :: ScopeID -&gt; CFGBuild ()
</span><a href="CFG.Build.html#replaceExitBlock"><span class="hs-identifier hs-var hs-var">replaceExitBlock</span></a></span></span><span> </span><span id="local-6989586621679218935"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218935"><span class="hs-identifier hs-var">prevExit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-499"></span><span>  </span><span id="local-6989586621679218936"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218936"><span class="hs-identifier hs-var">exit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#createEmptyBB"><span class="hs-identifier hs-var">createEmptyBB</span></a></span><span>
</span><span id="line-500"></span><span>  </span><span id="local-6989586621679218937"><span class="annot"><span class="annottext">Maybe CFG
</span><a href="#local-6989586621679218937"><span class="hs-identifier hs-var">g'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting (Maybe CFG) CFGState (Maybe CFG) -&gt; CFGBuild (Maybe CFG)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting (Maybe CFG) CFGState (Maybe CFG)
</span><span class="">#cfg</span></span><span>
</span><span id="line-501"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe CFG
</span><a href="#local-6989586621679218937"><span class="hs-identifier hs-var">g'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-502"></span><span>    </span><span class="annot"><span class="annottext">Maybe CFG
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; CFGBuild ()
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679218938"><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621679218938"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-504"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679218939"><span class="annot"><span class="annottext">edges :: [(ScopeID, ScopeID, CFGEdge)]
</span><a href="#local-6989586621679218939"><span class="hs-identifier hs-var hs-var">edges</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Graph ScopeID BasicBlock CFGEdge -&gt; [(ScopeID, ScopeID, CFGEdge)]
forall ni nd ed.
(Eq ni, Ord ni) =&gt;
Graph ni nd ed -&gt; [(ni, ni, ed)]
</span><a href="Util.Graph.html#edgeToList"><span class="hs-identifier hs-var">G.edgeToList</span></a></span><span> </span><span class="annot"><span class="annottext">(Graph ScopeID BasicBlock CFGEdge -&gt; [(ScopeID, ScopeID, CFGEdge)])
-&gt; Graph ScopeID BasicBlock CFGEdge
-&gt; [(ScopeID, ScopeID, CFGEdge)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621679218938"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">CFG
-&gt; Getting
     (Graph ScopeID BasicBlock CFGEdge)
     CFG
     (Graph ScopeID BasicBlock CFGEdge)
-&gt; Graph ScopeID BasicBlock CFGEdge
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (Graph ScopeID BasicBlock CFGEdge)
  CFG
  (Graph ScopeID BasicBlock CFGEdge)
</span><span class="">#graph</span></span><span>
</span><span id="line-505"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679218941"><span class="annot"><span class="annottext">nodes :: [(ScopeID, BasicBlock)]
</span><a href="#local-6989586621679218941"><span class="hs-identifier hs-var hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Graph ScopeID BasicBlock CFGEdge -&gt; [(ScopeID, BasicBlock)]
forall ni nd ed. (Eq ni, Ord ni) =&gt; Graph ni nd ed -&gt; [(ni, nd)]
</span><a href="Util.Graph.html#nodeToList"><span class="hs-identifier hs-var">G.nodeToList</span></a></span><span> </span><span class="annot"><span class="annottext">(Graph ScopeID BasicBlock CFGEdge -&gt; [(ScopeID, BasicBlock)])
-&gt; Graph ScopeID BasicBlock CFGEdge -&gt; [(ScopeID, BasicBlock)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CFG
</span><a href="#local-6989586621679218938"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">CFG
-&gt; Getting
     (Graph ScopeID BasicBlock CFGEdge)
     CFG
     (Graph ScopeID BasicBlock CFGEdge)
-&gt; Graph ScopeID BasicBlock CFGEdge
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (Graph ScopeID BasicBlock CFGEdge)
  CFG
  (Graph ScopeID BasicBlock CFGEdge)
</span><span class="">#graph</span></span><span>
</span><span id="line-506"></span><span>      </span><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a. GraphBuilder ScopeID BasicBlock CFGEdge a -&gt; CFGBuild ()
</span><a href="CFG.Build.html#updateCFG"><span class="hs-identifier hs-var">updateCFG</span></a></span><span> </span><span class="annot"><span class="annottext">(GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ())
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(ScopeID, ScopeID, CFGEdge)]
-&gt; ((ScopeID, ScopeID, CFGEdge)
    -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ())
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">[(ScopeID, ScopeID, CFGEdge)]
</span><a href="#local-6989586621679218939"><span class="hs-identifier hs-var">edges</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeID
-&gt; (ScopeID, ScopeID, CFGEdge)
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
</span><a href="#local-6989586621679218944"><span class="hs-identifier hs-var">updateExitEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218936"><span class="hs-identifier hs-var">exit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-508"></span><span>    </span><span id="local-6989586621679218944"><span class="annot"><span class="annottext">updateExitEdge :: ScopeID
-&gt; (ScopeID, ScopeID, CFGEdge)
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
</span><a href="#local-6989586621679218944"><span class="hs-identifier hs-var hs-var">updateExitEdge</span></a></span></span><span> </span><span id="local-6989586621679218945"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218945"><span class="hs-identifier hs-var">exit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679218946"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218946"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679218947"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218947"><span class="hs-identifier hs-var">dst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679218948"><span class="annot"><span class="annottext">CFGEdge
</span><a href="#local-6989586621679218948"><span class="hs-identifier hs-var">ed</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-509"></span><span>      </span><span class="annot"><span class="annottext">Bool
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218946"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; ScopeID -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218935"><span class="hs-identifier hs-var">prevExit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeID -&gt; ScopeID -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni nd ed.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#deleteEdge"><span class="hs-identifier hs-var">G.deleteEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218946"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218947"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge ()
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall a b.
GraphBuilder ScopeID BasicBlock CFGEdge a
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge b
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218945"><span class="hs-identifier hs-var">exit</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218947"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="annot"><span class="annottext">CFGEdge
</span><a href="#local-6989586621679218948"><span class="hs-identifier hs-var">ed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>      </span><span class="annot"><span class="annottext">Bool
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218947"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; ScopeID -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218935"><span class="hs-identifier hs-var">prevExit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-512"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeID -&gt; ScopeID -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni nd ed.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#deleteEdge"><span class="hs-identifier hs-var">G.deleteEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218946"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218947"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge ()
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall a b.
GraphBuilder ScopeID BasicBlock CFGEdge a
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge b
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218946"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218945"><span class="hs-identifier hs-var">exit</span></a></span><span> </span><span class="annot"><span class="annottext">CFGEdge
</span><a href="#local-6989586621679218948"><span class="hs-identifier hs-var">ed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span>
</span><span id="line-515"></span><span class="annot"><a href="CFG.Build.html#buildBlock"><span class="hs-identifier hs-type">buildBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="AST.html#Argument"><span class="hs-identifier hs-type">AST.Argument</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AST.html#Block"><span class="hs-identifier hs-type">AST.Block</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Types.html#BBID"><span class="hs-identifier hs-type">BBID</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="SSA.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span id="buildBlock"><span class="annot"><span class="annottext">buildBlock :: [Argument] -&gt; Block -&gt; CFGBuild (ScopeID, ScopeID, [Var])
</span><a href="CFG.Build.html#buildBlock"><span class="hs-identifier hs-var hs-var">buildBlock</span></a></span></span><span> </span><span id="local-6989586621679218950"><span class="annot"><span class="annottext">[Argument]
</span><a href="#local-6989586621679218950"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621679218951"><span class="annot"><span class="annottext">block :: Block
</span><a href="#local-6989586621679218951"><span class="hs-identifier hs-var">block</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="AST.html#Block"><span class="hs-identifier hs-type">AST.Block</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:stmts:Block :: Block -&gt; [Statement]
</span><a href="AST.html#%24sel%3Astmts%3ABlock"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679218953"><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679218953"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-517"></span><span>  </span><span class="annot"><span class="annottext">CFGBuild ()
</span><a href="CFG.Build.html#checkStmts"><span class="hs-identifier hs-var">checkStmts</span></a></span><span>
</span><span id="line-518"></span><span>  </span><span class="hs-comment">-- always create an empty BB at the start</span><span>
</span><span id="line-519"></span><span>  </span><span id="local-6989586621679218954"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218954"><span class="hs-identifier hs-var">head</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#createEmptyBB"><span class="hs-identifier hs-var">createEmptyBB</span></a></span><span>
</span><span id="line-520"></span><span>  </span><span class="hs-comment">-- record parent scope</span><span>
</span><span id="line-521"></span><span>  </span><span id="local-6989586621679218955"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218955"><span class="hs-identifier hs-var">parentScope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#astScope</span></span><span>
</span><span id="line-522"></span><span>  </span><span class="hs-comment">-- enter new block scope</span><span>
</span><span id="line-523"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679218956"><span class="annot"><span class="annottext">scopeID :: ScopeID
</span><a href="#local-6989586621679218956"><span class="hs-identifier hs-var hs-var">scopeID</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679218951"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">Block -&gt; Getting ScopeID Block ScopeID -&gt; ScopeID
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID Block ScopeID
</span><span class="">#blockID</span></span><span>
</span><span id="line-524"></span><span>  </span><span class="annot"><span class="annottext">ScopeID -&gt; CFGBuild ()
</span><a href="CFG.Build.html#setASTScope"><span class="hs-identifier hs-var">setASTScope</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218956"><span class="hs-identifier hs-var">scopeID</span></a></span><span>
</span><span id="line-525"></span><span>  </span><span class="hs-comment">-- create a new varmap for this scope</span><span class="hs-cpp">
  #sym2var %= Map.insert scopeID (SymVarMap Map.empty $ Just parentScope)
</span><span>  </span><span class="hs-comment">-- handle method arguments</span><span>
</span><span id="line-528"></span><span>  </span><span id="local-6989586621679218957"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621679218957"><span class="hs-identifier hs-var">arguments</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Argument -&gt; CFGBuild Var) -&gt; [Argument] -&gt; CFGBuild [Var]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Argument"><span class="hs-identifier hs-type">AST.Argument</span></a></span><span> </span><span id="local-6989586621679218959"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218959"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679218960"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218960"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679218961"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218961"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218959"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218960"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218961"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Argument]
</span><a href="#local-6989586621679218950"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-529"></span><span>  </span><span class="hs-comment">-- handle variable declarations</span><span>
</span><span id="line-530"></span><span>  </span><span class="annot"><span class="annottext">(FieldDecl -&gt; CFGBuild Var) -&gt; [FieldDecl] -&gt; CFGBuild ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="AST.html#FieldDecl"><span class="hs-identifier hs-type">AST.FieldDecl</span></a></span><span> </span><span id="local-6989586621679218962"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218962"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679218963"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218963"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679218964"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218964"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#allocaOnStack"><span class="hs-identifier hs-var">allocaOnStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679218962"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679218963"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679218964"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679218951"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">Block -&gt; Getting [FieldDecl] Block [FieldDecl] -&gt; [FieldDecl]
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting [FieldDecl] Block [FieldDecl]
</span><span class="">#vars</span></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>  </span><span class="hs-comment">-- handle statements</span><span>
</span><span id="line-532"></span><span>  </span><span id="local-6989586621679218965"><span class="annot"><span class="annottext">BBTransition
</span><a href="#local-6989586621679218965"><span class="hs-identifier hs-var">stmtT</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(BBTransition -&gt; Statement -&gt; CFGBuild BBTransition)
-&gt; BBTransition -&gt; [Statement] -&gt; CFGBuild BBTransition
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">BBTransition
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679218967"><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679218967"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Statement -&gt; CFGBuild BBTransition
</span><a href="CFG.Build.html#buildStatement"><span class="hs-identifier hs-var">buildStatement</span></a></span><span> </span><span class="annot"><span class="annottext">Statement
</span><a href="#local-6989586621679218967"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeID -&gt; BBTransition
</span><a href="CFG.Build.html#StayIn"><span class="hs-identifier hs-var">StayIn</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218954"><span class="hs-identifier hs-var">head</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Statement]
</span><a href="#local-6989586621679218953"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-533"></span><span>  </span><span class="hs-comment">-- connect last basic block with dangling statements if necessary</span><span>
</span><span id="line-534"></span><span>  </span><span id="local-6989586621679218969"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218969"><span class="hs-identifier hs-var">tail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BBTransition
</span><a href="#local-6989586621679218965"><span class="hs-identifier hs-var">stmtT</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-535"></span><span>    </span><span class="annot"><a href="CFG.Build.html#Deadend"><span class="hs-identifier hs-type">Deadend</span></a></span><span> </span><span id="local-6989586621679218970"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218970"><span class="hs-identifier hs-var">bbid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-536"></span><span>      </span><span class="annot"><span class="annottext">CFGBuild ()
</span><a href="CFG.Build.html#checkStmts"><span class="hs-identifier hs-var">checkStmts</span></a></span><span>
</span><span id="line-537"></span><span>      </span><span class="annot"><span class="annottext">ScopeID -&gt; CFGBuild ScopeID
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218970"><span class="hs-identifier hs-var">bbid</span></a></span><span>
</span><span id="line-538"></span><span>    </span><span class="annot"><a href="CFG.Build.html#StayIn"><span class="hs-identifier hs-type">StayIn</span></a></span><span> </span><span id="local-6989586621679218971"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218971"><span class="hs-identifier hs-var">bbid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-539"></span><span>      </span><span class="hs-comment">-- collect dangling statements, possibly left by some previous basic block.</span><span>
</span><span id="line-540"></span><span>      </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#finishCurrentBB"><span class="hs-identifier hs-var">finishCurrentBB</span></a></span><span>
</span><span id="line-541"></span><span>    </span><span class="annot"><a href="CFG.Build.html#TailAt"><span class="hs-identifier hs-type">TailAt</span></a></span><span> </span><span id="local-6989586621679218972"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218972"><span class="hs-identifier hs-var">bbid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-542"></span><span>      </span><span class="hs-comment">-- some basic blocks were created, we check for dangling statements</span><span>
</span><span id="line-543"></span><span>      </span><span class="annot"><span class="annottext">CFGBuild ()
</span><a href="CFG.Build.html#checkStmts"><span class="hs-identifier hs-var">checkStmts</span></a></span><span>
</span><span id="line-544"></span><span>      </span><span class="annot"><span class="annottext">ScopeID -&gt; CFGBuild ScopeID
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218972"><span class="hs-identifier hs-var">bbid</span></a></span><span>
</span><span id="line-545"></span><span>  </span><span class="hs-comment">-- recover parent scope</span><span>
</span><span id="line-546"></span><span>  </span><span class="annot"><span class="annottext">ScopeID -&gt; CFGBuild ()
</span><a href="CFG.Build.html#setASTScope"><span class="hs-identifier hs-var">setASTScope</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218955"><span class="hs-identifier hs-var">parentScope</span></a></span><span>
</span><span id="line-547"></span><span>  </span><span class="annot"><span class="annottext">(ScopeID, ScopeID, [Var]) -&gt; CFGBuild (ScopeID, ScopeID, [Var])
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218954"><span class="hs-identifier hs-var">head</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679218969"><span class="hs-identifier hs-var">tail</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621679218957"><span class="hs-identifier hs-var">arguments</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>
</span><span id="line-549"></span><span class="annot"><a href="CFG.Build.html#buildAssignOp"><span class="hs-identifier hs-type">buildAssignOp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="AST.html#Location"><span class="hs-identifier hs-type">AST.Location</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AST.html#AssignOp"><span class="hs-identifier hs-type">AST.AssignOp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="AST.html#Expr"><span class="hs-identifier hs-type">AST.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="SSA.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-550"></span><span id="buildAssignOp"><span class="annot"><span class="annottext">buildAssignOp :: Location -&gt; AssignOp -&gt; Maybe Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildAssignOp"><span class="hs-identifier hs-var hs-var">buildAssignOp</span></a></span></span><span> </span><span class="annot"><span class="annottext">Location
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AssignOp
</span><a href="AST.html#EqlAssign"><span class="hs-identifier hs-var">AST.EqlAssign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679218975"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679218975"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679218975"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-551"></span><span class="annot"><a href="CFG.Build.html#buildAssignOp"><span class="hs-identifier hs-var">buildAssignOp</span></a></span><span> </span><span id="local-6989586621679218977"><span class="annot"><span class="annottext">Location
</span><a href="#local-6989586621679218977"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span class="annot"><span class="annottext">AssignOp
</span><a href="AST.html#IncAssign"><span class="hs-identifier hs-var">AST.IncAssign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679218979"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679218979"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-552"></span><span>  </span><span id="local-6989586621679218980"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218980"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Location -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildReadFromLocation"><span class="hs-identifier hs-var">buildReadFromLocation</span></a></span><span> </span><span class="annot"><span class="annottext">Location
</span><a href="#local-6989586621679218977"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-553"></span><span>  </span><span id="local-6989586621679218982"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218982"><span class="hs-identifier hs-var">addition</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679218979"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-554"></span><span>  </span><span id="local-6989586621679218983"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218983"><span class="hs-identifier hs-var">dst'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218980"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Getting Type Var Type -&gt; Type
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Type Var Type
</span><span class="">#tpe</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Range
</span><a href="SSA.html#%24sel%3Aloc%3AVar"><span class="hs-identifier hs-var">SSA.loc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218980"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>  </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; ArithOp -&gt; VarOrImm -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Arith"><span class="hs-identifier hs-var">SSA.Arith</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218983"><span class="hs-identifier hs-var">dst'</span></a></span><span> </span><span class="annot"><span class="annottext">ArithOp
</span><a href="AST.html#Plus"><span class="hs-identifier hs-var">AST.Plus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218980"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218982"><span class="hs-identifier hs-var">addition</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218983"><span class="hs-identifier hs-var">dst'</span></a></span><span>
</span><span id="line-557"></span><span class="annot"><a href="CFG.Build.html#buildAssignOp"><span class="hs-identifier hs-var">buildAssignOp</span></a></span><span> </span><span id="local-6989586621679218988"><span class="annot"><span class="annottext">Location
</span><a href="#local-6989586621679218988"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span class="annot"><span class="annottext">AssignOp
</span><a href="AST.html#DecAssign"><span class="hs-identifier hs-var">AST.DecAssign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679218990"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679218990"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-558"></span><span>  </span><span id="local-6989586621679218991"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218991"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Location -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildReadFromLocation"><span class="hs-identifier hs-var">buildReadFromLocation</span></a></span><span> </span><span class="annot"><span class="annottext">Location
</span><a href="#local-6989586621679218988"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-559"></span><span>  </span><span id="local-6989586621679218992"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218992"><span class="hs-identifier hs-var">addition</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679218990"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-560"></span><span>  </span><span id="local-6989586621679218993"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218993"><span class="hs-identifier hs-var">dst'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218991"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Getting Type Var Type -&gt; Type
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Type Var Type
</span><span class="">#tpe</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Range
</span><a href="SSA.html#%24sel%3Aloc%3AVar"><span class="hs-identifier hs-var">SSA.loc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218991"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span>  </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; ArithOp -&gt; VarOrImm -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Arith"><span class="hs-identifier hs-var">SSA.Arith</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218993"><span class="hs-identifier hs-var">dst'</span></a></span><span> </span><span class="annot"><span class="annottext">ArithOp
</span><a href="AST.html#Minus"><span class="hs-identifier hs-var">AST.Minus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218991"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218992"><span class="hs-identifier hs-var">addition</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-562"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218993"><span class="hs-identifier hs-var">dst'</span></a></span><span>
</span><span id="line-563"></span><span class="annot"><a href="CFG.Build.html#buildAssignOp"><span class="hs-identifier hs-var">buildAssignOp</span></a></span><span> </span><span id="local-6989586621679218995"><span class="annot"><span class="annottext">Location
</span><a href="#local-6989586621679218995"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span class="annot"><span class="annottext">AssignOp
</span><a href="AST.html#PlusPlus"><span class="hs-identifier hs-var">AST.PlusPlus</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-564"></span><span>  </span><span id="local-6989586621679218997"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218997"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Location -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildReadFromLocation"><span class="hs-identifier hs-var">buildReadFromLocation</span></a></span><span> </span><span class="annot"><span class="annottext">Location
</span><a href="#local-6989586621679218995"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-565"></span><span>  </span><span id="local-6989586621679218998"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218998"><span class="hs-identifier hs-var">dst'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218997"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Getting Type Var Type -&gt; Type
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Type Var Type
</span><span class="">#tpe</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Range
</span><a href="SSA.html#%24sel%3Aloc%3AVar"><span class="hs-identifier hs-var">SSA.loc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218997"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span>  </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; ArithOp -&gt; VarOrImm -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Arith"><span class="hs-identifier hs-var">SSA.Arith</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218998"><span class="hs-identifier hs-var">dst'</span></a></span><span> </span><span class="annot"><span class="annottext">ArithOp
</span><a href="AST.html#Plus"><span class="hs-identifier hs-var">AST.Plus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218997"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; VarOrImm
</span><a href="SSA.html#IntImm"><span class="hs-identifier hs-var">IntImm</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-567"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679218998"><span class="hs-identifier hs-var">dst'</span></a></span><span>
</span><span id="line-568"></span><span class="annot"><a href="CFG.Build.html#buildAssignOp"><span class="hs-identifier hs-var">buildAssignOp</span></a></span><span> </span><span id="local-6989586621679219000"><span class="annot"><span class="annottext">Location
</span><a href="#local-6989586621679219000"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span class="annot"><span class="annottext">AssignOp
</span><a href="AST.html#MinusMinus"><span class="hs-identifier hs-var">AST.MinusMinus</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-569"></span><span>  </span><span id="local-6989586621679219002"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219002"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Location -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildReadFromLocation"><span class="hs-identifier hs-var">buildReadFromLocation</span></a></span><span> </span><span class="annot"><span class="annottext">Location
</span><a href="#local-6989586621679219000"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-570"></span><span>  </span><span id="local-6989586621679219003"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219003"><span class="hs-identifier hs-var">dst'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219002"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Getting Type Var Type -&gt; Type
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Type Var Type
</span><span class="">#tpe</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Range
</span><a href="SSA.html#%24sel%3Aloc%3AVar"><span class="hs-identifier hs-var">SSA.loc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219002"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>  </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; ArithOp -&gt; VarOrImm -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Arith"><span class="hs-identifier hs-var">SSA.Arith</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219003"><span class="hs-identifier hs-var">dst'</span></a></span><span> </span><span class="annot"><span class="annottext">ArithOp
</span><a href="AST.html#Minus"><span class="hs-identifier hs-var">AST.Minus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219002"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; VarOrImm
</span><a href="SSA.html#IntImm"><span class="hs-identifier hs-var">IntImm</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219003"><span class="hs-identifier hs-var">dst'</span></a></span><span>
</span><span id="line-573"></span><span class="annot"><a href="CFG.Build.html#buildAssignOp"><span class="hs-identifier hs-var">buildAssignOp</span></a></span><span> </span><span class="annot"><span class="annottext">Location
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AssignOp
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild Var
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild Var) -&gt; CompileError -&gt; CFGBuild Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Range
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;Malformed assignment.&quot;</span></span><span>
</span><span id="line-574"></span><span>
</span><span id="line-575"></span><span class="annot"><a href="CFG.Build.html#buildStatement"><span class="hs-identifier hs-type">buildStatement</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="AST.html#Statement"><span class="hs-identifier hs-type">AST.Statement</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="CFG.Build.html#BBTransition"><span class="hs-identifier hs-type">BBTransition</span></a></span><span>
</span><span id="line-576"></span><span id="buildStatement"><span class="annot"><span class="annottext">buildStatement :: Statement -&gt; CFGBuild BBTransition
</span><a href="CFG.Build.html#buildStatement"><span class="hs-identifier hs-var hs-var">buildStatement</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Statement"><span class="hs-identifier hs-type">AST.Statement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#AssignStmt"><span class="hs-identifier hs-type">AST.AssignStmt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Assignment"><span class="hs-identifier hs-type">AST.Assignment</span></a></span><span> </span><span id="local-6989586621679219007"><span class="annot"><span class="annottext">Location
</span><a href="#local-6989586621679219007"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621679219008"><span class="annot"><span class="annottext">AssignOp
</span><a href="#local-6989586621679219008"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679219009"><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621679219009"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-577"></span><span>  </span><span id="local-6989586621679219010"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219010"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Location -&gt; AssignOp -&gt; Maybe Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildAssignOp"><span class="hs-identifier hs-var">buildAssignOp</span></a></span><span> </span><span class="annot"><span class="annottext">Location
</span><a href="#local-6989586621679219007"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="annot"><span class="annottext">AssignOp
</span><a href="#local-6989586621679219008"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621679219009"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-578"></span><span>  </span><span class="annot"><span class="annottext">Location -&gt; VarOrImm -&gt; CFGBuild ()
</span><a href="CFG.Build.html#buildWriteToLocation"><span class="hs-identifier hs-var">buildWriteToLocation</span></a></span><span> </span><span class="annot"><span class="annottext">Location
</span><a href="#local-6989586621679219007"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219010"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span>  </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#currentBBID</span></span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
-&gt; (ScopeID -&gt; BBTransition) -&gt; CFGBuild BBTransition
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; BBTransition
</span><a href="CFG.Build.html#StayIn"><span class="hs-identifier hs-var">StayIn</span></a></span><span>
</span><span id="line-580"></span><span class="annot"><a href="CFG.Build.html#buildStatement"><span class="hs-identifier hs-var">buildStatement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Statement"><span class="hs-identifier hs-type">AST.Statement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#MethodCallStmt"><span class="hs-identifier hs-type">AST.MethodCallStmt</span></a></span><span> </span><span id="local-6989586621679219013"><span class="annot"><span class="annottext">MethodCall
</span><a href="#local-6989586621679219013"><span class="hs-identifier hs-var">call</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-581"></span><span>  </span><span class="annot"><span class="annottext">MethodCall -&gt; Type -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildMethodCall"><span class="hs-identifier hs-var">buildMethodCall</span></a></span><span> </span><span class="annot"><span class="annottext">MethodCall
</span><a href="#local-6989586621679219013"><span class="hs-identifier hs-var">call</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="AST.html#Void"><span class="hs-identifier hs-var">AST.Void</span></a></span><span>
</span><span id="line-582"></span><span>  </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#currentBBID</span></span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
-&gt; (ScopeID -&gt; BBTransition) -&gt; CFGBuild BBTransition
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; BBTransition
</span><a href="CFG.Build.html#StayIn"><span class="hs-identifier hs-var">StayIn</span></a></span><span>
</span><span id="line-583"></span><span class="annot"><a href="CFG.Build.html#buildStatement"><span class="hs-identifier hs-var">buildStatement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Statement"><span class="hs-identifier hs-type">AST.Statement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#IfStmt"><span class="hs-identifier hs-type">AST.IfStmt</span></a></span><span> </span><span id="local-6989586621679219017"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219017"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621679219018"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679219018"><span class="hs-identifier hs-var">ifBlock</span></a></span></span><span> </span><span id="local-6989586621679219019"><span class="annot"><span class="annottext">Maybe Block
</span><a href="#local-6989586621679219019"><span class="hs-identifier hs-var">maybeElseBlock</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679219020"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219020"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-584"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679219021"><span class="annot"><span class="annottext">phiBlocks :: [ScopeID]
</span><a href="#local-6989586621679219021"><span class="hs-identifier hs-var hs-var">phiBlocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Block
</span><a href="#local-6989586621679219019"><span class="hs-identifier hs-var">maybeElseBlock</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-585"></span><span>        </span><span class="annot"><span class="annottext">Maybe Block
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679219018"><span class="hs-identifier hs-var">ifBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Block -&gt; Getting ScopeID Block ScopeID -&gt; ScopeID
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID Block ScopeID
</span><span class="">#blockID</span></span><span class="hs-special">]</span><span>
</span><span id="line-586"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679219022"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679219022"><span class="hs-identifier hs-var">elseBlock</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679219018"><span class="hs-identifier hs-var">ifBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Block -&gt; Getting ScopeID Block ScopeID -&gt; ScopeID
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID Block ScopeID
</span><span class="">#blockID</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679219022"><span class="hs-identifier hs-var">elseBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Block -&gt; Getting ScopeID Block ScopeID -&gt; ScopeID
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID Block ScopeID
</span><span class="">#blockID</span></span><span class="hs-special">]</span><span>
</span><span id="line-587"></span><span>  </span><span class="hs-comment">-- Finish previous basic block. Also append pred calculation to it.</span><span>
</span><span id="line-588"></span><span>  </span><span id="local-6989586621679219023"><span class="annot"><span class="annottext">[(ScopeID, Name)]
</span><a href="#local-6989586621679219023"><span class="hs-identifier hs-var">phiList</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ScopeID] -&gt; CFGBuild [(ScopeID, Name)]
</span><a href="CFG.Build.html#inferPhiList"><span class="hs-identifier hs-var">inferPhiList</span></a></span><span> </span><span class="annot"><span class="annottext">[ScopeID]
</span><a href="#local-6989586621679219021"><span class="hs-identifier hs-var">phiBlocks</span></a></span><span>
</span><span id="line-589"></span><span>  </span><span id="local-6989586621679219024"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219024"><span class="hs-identifier hs-var">predVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219017"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-590"></span><span>  </span><span id="local-6989586621679219025"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219025"><span class="hs-identifier hs-var">prevBB</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#finishCurrentBB"><span class="hs-identifier hs-var">finishCurrentBB</span></a></span><span>
</span><span id="line-591"></span><span>  </span><span id="local-6989586621679219026"><span class="annot"><span class="annottext">Map (ScopeID, Name) Var
</span><a href="#local-6989586621679219026"><span class="hs-identifier hs-var">prevBBPhiList</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(ScopeID, Name)] -&gt; CFGBuild (Map (ScopeID, Name) Var)
</span><a href="CFG.Build.html#recordPhiVar"><span class="hs-identifier hs-var">recordPhiVar</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScopeID, Name)]
</span><a href="#local-6989586621679219023"><span class="hs-identifier hs-var">phiList</span></a></span><span>
</span><span id="line-592"></span><span>  </span><span class="hs-comment">-- Build if body</span><span>
</span><span id="line-593"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679219027"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219027"><span class="hs-identifier hs-var">ifHead</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679219028"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219028"><span class="hs-identifier hs-var">ifTail</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Argument] -&gt; Block -&gt; CFGBuild (ScopeID, ScopeID, [Var])
</span><a href="CFG.Build.html#buildBlock"><span class="hs-identifier hs-var">buildBlock</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679219018"><span class="hs-identifier hs-var">ifBlock</span></a></span><span>
</span><span id="line-594"></span><span>  </span><span id="local-6989586621679219029"><span class="annot"><span class="annottext">Map (ScopeID, Name) Var
</span><a href="#local-6989586621679219029"><span class="hs-identifier hs-var">ifBBPhiList</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(ScopeID, Name)] -&gt; CFGBuild (Map (ScopeID, Name) Var)
</span><a href="CFG.Build.html#recordPhiVar"><span class="hs-identifier hs-var">recordPhiVar</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScopeID, Name)]
</span><a href="#local-6989586621679219023"><span class="hs-identifier hs-var">phiList</span></a></span><span>
</span><span id="line-595"></span><span>  </span><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a. GraphBuilder ScopeID BasicBlock CFGEdge a -&gt; CFGBuild ()
</span><a href="CFG.Build.html#updateCFG"><span class="hs-identifier hs-var">updateCFG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219025"><span class="hs-identifier hs-var">prevBB</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219027"><span class="hs-identifier hs-var">ifHead</span></a></span><span> </span><span class="annot"><span class="annottext">(CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ())
-&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; CFGEdge
</span><a href="CFG.Types.html#CondEdge"><span class="hs-identifier hs-var">CondEdge</span></a></span><span> </span><span class="annot"><span class="annottext">(Condition -&gt; CFGEdge) -&gt; Condition -&gt; CFGEdge
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarOrImm -&gt; Condition
</span><a href="CFG.Types.html#Pred"><span class="hs-identifier hs-var">Pred</span></a></span><span> </span><span class="annot"><span class="annottext">(VarOrImm -&gt; Condition) -&gt; VarOrImm -&gt; Condition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219024"><span class="hs-identifier hs-var">predVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-596"></span><span>  </span><span class="hs-comment">-- Build else body if it exist.</span><span>
</span><span id="line-597"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Block
</span><a href="#local-6989586621679219019"><span class="hs-identifier hs-var">maybeElseBlock</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-598"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679219032"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679219032"><span class="hs-identifier hs-var">elseBlock</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-599"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679219033"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219033"><span class="hs-identifier hs-var">elseHead</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679219034"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219034"><span class="hs-identifier hs-var">elseTail</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Argument] -&gt; Block -&gt; CFGBuild (ScopeID, ScopeID, [Var])
</span><a href="CFG.Build.html#buildBlock"><span class="hs-identifier hs-var">buildBlock</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679219032"><span class="hs-identifier hs-var">elseBlock</span></a></span><span>
</span><span id="line-600"></span><span>      </span><span id="local-6989586621679219035"><span class="annot"><span class="annottext">Map (ScopeID, Name) Var
</span><a href="#local-6989586621679219035"><span class="hs-identifier hs-var">elseBBPhiList</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(ScopeID, Name)] -&gt; CFGBuild (Map (ScopeID, Name) Var)
</span><a href="CFG.Build.html#recordPhiVar"><span class="hs-identifier hs-var">recordPhiVar</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScopeID, Name)]
</span><a href="#local-6989586621679219023"><span class="hs-identifier hs-var">phiList</span></a></span><span>
</span><span id="line-601"></span><span>      </span><span class="annot"><span class="annottext">[(ScopeID, Name)] -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addDummyPhiNode"><span class="hs-identifier hs-var">addDummyPhiNode</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScopeID, Name)]
</span><a href="#local-6989586621679219023"><span class="hs-identifier hs-var">phiList</span></a></span><span>
</span><span id="line-602"></span><span>      </span><span id="local-6989586621679219036"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219036"><span class="hs-identifier hs-var">tail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#finishCurrentBB"><span class="hs-identifier hs-var">finishCurrentBB</span></a></span><span>
</span><span id="line-603"></span><span>      </span><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a. GraphBuilder ScopeID BasicBlock CFGEdge a -&gt; CFGBuild ()
</span><a href="CFG.Build.html#updateCFG"><span class="hs-identifier hs-var">updateCFG</span></a></span><span> </span><span class="annot"><span class="annottext">(GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ())
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-604"></span><span>        </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219025"><span class="hs-identifier hs-var">prevBB</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219033"><span class="hs-identifier hs-var">elseHead</span></a></span><span> </span><span class="annot"><span class="annottext">(CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ())
-&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; CFGEdge
</span><a href="CFG.Types.html#CondEdge"><span class="hs-identifier hs-var">CondEdge</span></a></span><span> </span><span class="annot"><span class="annottext">(Condition -&gt; CFGEdge) -&gt; Condition -&gt; CFGEdge
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarOrImm -&gt; Condition
</span><a href="CFG.Types.html#Complement"><span class="hs-identifier hs-var">Complement</span></a></span><span> </span><span class="annot"><span class="annottext">(VarOrImm -&gt; Condition) -&gt; VarOrImm -&gt; Condition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219024"><span class="hs-identifier hs-var">predVar</span></a></span><span>
</span><span id="line-605"></span><span>        </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219028"><span class="hs-identifier hs-var">ifTail</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219036"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">CFGEdge
</span><a href="CFG.Types.html#SeqEdge"><span class="hs-identifier hs-var">SeqEdge</span></a></span><span>
</span><span id="line-606"></span><span>        </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219034"><span class="hs-identifier hs-var">elseTail</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219036"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">CFGEdge
</span><a href="CFG.Types.html#SeqEdge"><span class="hs-identifier hs-var">SeqEdge</span></a></span><span>
</span><span id="line-607"></span><span>      </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID
-&gt; Map (ScopeID, Name) Var
-&gt; ScopeID
-&gt; Map (ScopeID, Name) Var
-&gt; CFGBuild ()
</span><a href="CFG.Build.html#patchPhiNode"><span class="hs-identifier hs-var">patchPhiNode</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219036"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219028"><span class="hs-identifier hs-var">ifTail</span></a></span><span> </span><span class="annot"><span class="annottext">Map (ScopeID, Name) Var
</span><a href="#local-6989586621679219029"><span class="hs-identifier hs-var">ifBBPhiList</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219034"><span class="hs-identifier hs-var">elseTail</span></a></span><span> </span><span class="annot"><span class="annottext">Map (ScopeID, Name) Var
</span><a href="#local-6989586621679219035"><span class="hs-identifier hs-var">elseBBPhiList</span></a></span><span>
</span><span id="line-608"></span><span>      </span><span class="annot"><span class="annottext">BBTransition -&gt; CFGBuild BBTransition
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(BBTransition -&gt; CFGBuild BBTransition)
-&gt; BBTransition -&gt; CFGBuild BBTransition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; BBTransition
</span><a href="CFG.Build.html#TailAt"><span class="hs-identifier hs-var">TailAt</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219036"><span class="hs-identifier hs-var">tail</span></a></span><span>
</span><span id="line-609"></span><span>    </span><span class="annot"><span class="annottext">Maybe Block
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-610"></span><span>      </span><span class="annot"><span class="annottext">[(ScopeID, Name)] -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addDummyPhiNode"><span class="hs-identifier hs-var">addDummyPhiNode</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScopeID, Name)]
</span><a href="#local-6989586621679219023"><span class="hs-identifier hs-var">phiList</span></a></span><span>
</span><span id="line-611"></span><span>      </span><span id="local-6989586621679219038"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219038"><span class="hs-identifier hs-var">tail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#finishCurrentBB"><span class="hs-identifier hs-var">finishCurrentBB</span></a></span><span>
</span><span id="line-612"></span><span>      </span><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a. GraphBuilder ScopeID BasicBlock CFGEdge a -&gt; CFGBuild ()
</span><a href="CFG.Build.html#updateCFG"><span class="hs-identifier hs-var">updateCFG</span></a></span><span> </span><span class="annot"><span class="annottext">(GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ())
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-613"></span><span>        </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219025"><span class="hs-identifier hs-var">prevBB</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219038"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">(CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ())
-&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; CFGEdge
</span><a href="CFG.Types.html#CondEdge"><span class="hs-identifier hs-var">CondEdge</span></a></span><span> </span><span class="annot"><span class="annottext">(Condition -&gt; CFGEdge) -&gt; Condition -&gt; CFGEdge
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarOrImm -&gt; Condition
</span><a href="CFG.Types.html#Complement"><span class="hs-identifier hs-var">Complement</span></a></span><span> </span><span class="annot"><span class="annottext">(VarOrImm -&gt; Condition) -&gt; VarOrImm -&gt; Condition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219024"><span class="hs-identifier hs-var">predVar</span></a></span><span>
</span><span id="line-614"></span><span>        </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219028"><span class="hs-identifier hs-var">ifTail</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219038"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">CFGEdge
</span><a href="CFG.Types.html#SeqEdge"><span class="hs-identifier hs-var">SeqEdge</span></a></span><span>
</span><span id="line-615"></span><span>      </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID
-&gt; Map (ScopeID, Name) Var
-&gt; ScopeID
-&gt; Map (ScopeID, Name) Var
-&gt; CFGBuild ()
</span><a href="CFG.Build.html#patchPhiNode"><span class="hs-identifier hs-var">patchPhiNode</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219038"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219025"><span class="hs-identifier hs-var">prevBB</span></a></span><span> </span><span class="annot"><span class="annottext">Map (ScopeID, Name) Var
</span><a href="#local-6989586621679219026"><span class="hs-identifier hs-var">prevBBPhiList</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219028"><span class="hs-identifier hs-var">ifTail</span></a></span><span> </span><span class="annot"><span class="annottext">Map (ScopeID, Name) Var
</span><a href="#local-6989586621679219029"><span class="hs-identifier hs-var">ifBBPhiList</span></a></span><span>
</span><span id="line-616"></span><span>      </span><span class="annot"><span class="annottext">BBTransition -&gt; CFGBuild BBTransition
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(BBTransition -&gt; CFGBuild BBTransition)
-&gt; BBTransition -&gt; CFGBuild BBTransition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; BBTransition
</span><a href="CFG.Build.html#TailAt"><span class="hs-identifier hs-var">TailAt</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219038"><span class="hs-identifier hs-var">tail</span></a></span><span>
</span><span id="line-617"></span><span class="annot"><a href="CFG.Build.html#buildStatement"><span class="hs-identifier hs-var">buildStatement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Statement"><span class="hs-identifier hs-type">AST.Statement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#ForStmt"><span class="hs-identifier hs-type">AST.ForStmt</span></a></span><span> </span><span id="local-6989586621679219040"><span class="annot"><span class="annottext">Maybe Assignment
</span><a href="#local-6989586621679219040"><span class="hs-identifier hs-var">init</span></a></span></span><span> </span><span id="local-6989586621679219041"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219041"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span id="local-6989586621679219042"><span class="annot"><span class="annottext">Maybe Assignment
</span><a href="#local-6989586621679219042"><span class="hs-identifier hs-var">update</span></a></span></span><span> </span><span id="local-6989586621679219043"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679219043"><span class="hs-identifier hs-var">block</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679219044"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219044"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-618"></span><span>  </span><span id="local-6989586621679219045"><span class="annot"><span class="annottext">[(ScopeID, Name)]
</span><a href="#local-6989586621679219045"><span class="hs-identifier hs-var">phiList</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ScopeID] -&gt; CFGBuild [(ScopeID, Name)]
</span><a href="CFG.Build.html#inferPhiList"><span class="hs-identifier hs-var">inferPhiList</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679219043"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">Block -&gt; Getting ScopeID Block ScopeID -&gt; ScopeID
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID Block ScopeID
</span><span class="">#blockID</span></span><span class="hs-special">]</span><span>
</span><span id="line-619"></span><span>  </span><span class="hs-comment">-- append init to previous block</span><span>
</span><span id="line-620"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Assignment
</span><a href="#local-6989586621679219040"><span class="hs-identifier hs-var">init</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-621"></span><span>    </span><span class="annot"><span class="annottext">Maybe Assignment
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; CFGBuild ()
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679219046"><span class="annot"><span class="annottext">Assignment
</span><a href="#local-6989586621679219046"><span class="hs-identifier hs-var">init</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CFGBuild BBTransition -&gt; CFGBuild ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(CFGBuild BBTransition -&gt; CFGBuild ())
-&gt; CFGBuild BBTransition -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Statement -&gt; CFGBuild BBTransition
</span><a href="CFG.Build.html#buildStatement"><span class="hs-identifier hs-var">buildStatement</span></a></span><span> </span><span class="annot"><span class="annottext">(Statement -&gt; CFGBuild BBTransition)
-&gt; Statement -&gt; CFGBuild BBTransition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Statement_ -&gt; Range -&gt; Statement
</span><a href="AST.html#Statement"><span class="hs-identifier hs-var">AST.Statement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Assignment -&gt; Statement_
</span><a href="AST.html#AssignStmt"><span class="hs-identifier hs-var">AST.AssignStmt</span></a></span><span> </span><span class="annot"><span class="annottext">Assignment
</span><a href="#local-6989586621679219046"><span class="hs-identifier hs-var">init</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Assignment
</span><a href="#local-6989586621679219046"><span class="hs-identifier hs-var">init</span></a></span><span> </span><span class="annot"><span class="annottext">Assignment -&gt; Getting Range Assignment Range -&gt; Range
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Range Assignment Range
</span><span class="">#loc</span></span><span class="hs-special">)</span><span>
</span><span id="line-623"></span><span>  </span><span id="local-6989586621679219048"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219048"><span class="hs-identifier hs-var">prevBB</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#finishCurrentBB"><span class="hs-identifier hs-var">finishCurrentBB</span></a></span><span>
</span><span id="line-624"></span><span>  </span><span id="local-6989586621679219049"><span class="annot"><span class="annottext">Map (ScopeID, Name) Var
</span><a href="#local-6989586621679219049"><span class="hs-identifier hs-var">prevBBPhiList</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(ScopeID, Name)] -&gt; CFGBuild (Map (ScopeID, Name) Var)
</span><a href="CFG.Build.html#recordPhiVar"><span class="hs-identifier hs-var">recordPhiVar</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScopeID, Name)]
</span><a href="#local-6989586621679219045"><span class="hs-identifier hs-var">phiList</span></a></span><span>
</span><span id="line-625"></span><span>  </span><span class="hs-comment">-- build the pred, also add dummy phi nodes at the start</span><span>
</span><span id="line-626"></span><span>  </span><span id="local-6989586621679219050"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219050"><span class="hs-identifier hs-var">predHead</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#currentBBID</span></span><span>
</span><span id="line-627"></span><span>  </span><span class="annot"><span class="annottext">[(ScopeID, Name)] -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addDummyPhiNode"><span class="hs-identifier hs-var">addDummyPhiNode</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScopeID, Name)]
</span><a href="#local-6989586621679219045"><span class="hs-identifier hs-var">phiList</span></a></span><span>
</span><span id="line-628"></span><span>  </span><span id="local-6989586621679219051"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219051"><span class="hs-identifier hs-var">predVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219041"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-629"></span><span>  </span><span id="local-6989586621679219052"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219052"><span class="hs-identifier hs-var">predTail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#finishCurrentBB"><span class="hs-identifier hs-var">finishCurrentBB</span></a></span><span>
</span><span id="line-630"></span><span>  </span><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a. GraphBuilder ScopeID BasicBlock CFGEdge a -&gt; CFGBuild ()
</span><a href="CFG.Build.html#updateCFG"><span class="hs-identifier hs-var">updateCFG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219048"><span class="hs-identifier hs-var">prevBB</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219050"><span class="hs-identifier hs-var">predHead</span></a></span><span> </span><span class="annot"><span class="annottext">CFGEdge
</span><a href="CFG.Types.html#SeqEdge"><span class="hs-identifier hs-var">SeqEdge</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-631"></span><span>  </span><span class="hs-comment">-- create a dummy update block for continue to jump to</span><span>
</span><span id="line-632"></span><span>  </span><span id="local-6989586621679219053"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219053"><span class="hs-identifier hs-var">dummyUpdateBB</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#createEmptyBB"><span class="hs-identifier hs-var">createEmptyBB</span></a></span><span>
</span><span id="line-633"></span><span>  </span><span class="hs-comment">-- create a dummy tail block fro break to jump to</span><span>
</span><span id="line-634"></span><span>  </span><span id="local-6989586621679219054"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219054"><span class="hs-identifier hs-var">tail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#createEmptyBB"><span class="hs-identifier hs-var">createEmptyBB</span></a></span><span>
</span><span id="line-635"></span><span>  </span><span class="hs-comment">-- build for body and block connections</span><span>
</span><span id="line-636"></span><span>  </span><span id="local-6989586621679219055"><span class="annot"><span class="annottext">Map (ScopeID, Name) Var
</span><a href="#local-6989586621679219055"><span class="hs-identifier hs-var">updateBBPhiList</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-637"></span><span>    </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID
-&gt; CFGBuild (Map (ScopeID, Name) Var)
-&gt; CFGBuild (Map (ScopeID, Name) Var)
forall a. ScopeID -&gt; ScopeID -&gt; CFGBuild a -&gt; CFGBuild a
</span><a href="CFG.Build.html#withControlBlock"><span class="hs-identifier hs-var">withControlBlock</span></a></span><span>
</span><span id="line-638"></span><span>      </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219053"><span class="hs-identifier hs-var">dummyUpdateBB</span></a></span><span>
</span><span id="line-639"></span><span>      </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219054"><span class="hs-identifier hs-var">tail</span></a></span><span>
</span><span id="line-640"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-641"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679219056"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219056"><span class="hs-identifier hs-var">blockHead</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679219057"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219057"><span class="hs-identifier hs-var">blockTail</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Argument] -&gt; Block -&gt; CFGBuild (ScopeID, ScopeID, [Var])
</span><a href="CFG.Build.html#buildBlock"><span class="hs-identifier hs-var">buildBlock</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621679219043"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-642"></span><span>          </span><span class="hs-comment">-- create the actual update block(s)</span><span>
</span><span id="line-643"></span><span>          </span><span id="local-6989586621679219058"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219058"><span class="hs-identifier hs-var">updateHead</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#currentBBID</span></span><span>
</span><span id="line-644"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Assignment
</span><a href="#local-6989586621679219042"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-645"></span><span>            </span><span class="annot"><span class="annottext">Maybe Assignment
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; CFGBuild ()
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679219059"><span class="annot"><span class="annottext">Assignment
</span><a href="#local-6989586621679219059"><span class="hs-identifier hs-var">update</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CFGBuild BBTransition -&gt; CFGBuild ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(CFGBuild BBTransition -&gt; CFGBuild ())
-&gt; CFGBuild BBTransition -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Statement -&gt; CFGBuild BBTransition
</span><a href="CFG.Build.html#buildStatement"><span class="hs-identifier hs-var">buildStatement</span></a></span><span> </span><span class="annot"><span class="annottext">(Statement -&gt; CFGBuild BBTransition)
-&gt; Statement -&gt; CFGBuild BBTransition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Statement_ -&gt; Range -&gt; Statement
</span><a href="AST.html#Statement"><span class="hs-identifier hs-var">AST.Statement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Assignment -&gt; Statement_
</span><a href="AST.html#AssignStmt"><span class="hs-identifier hs-var">AST.AssignStmt</span></a></span><span> </span><span class="annot"><span class="annottext">Assignment
</span><a href="#local-6989586621679219059"><span class="hs-identifier hs-var">update</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Assignment
</span><a href="#local-6989586621679219059"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="annot"><span class="annottext">Assignment -&gt; Getting Range Assignment Range -&gt; Range
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Range Assignment Range
</span><span class="">#loc</span></span><span class="hs-special">)</span><span>
</span><span id="line-647"></span><span>          </span><span id="local-6989586621679219060"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219060"><span class="hs-identifier hs-var">updateTail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#finishCurrentBB"><span class="hs-identifier hs-var">finishCurrentBB</span></a></span><span>
</span><span id="line-648"></span><span>          </span><span id="local-6989586621679219061"><span class="annot"><span class="annottext">Map (ScopeID, Name) Var
</span><a href="#local-6989586621679219061"><span class="hs-identifier hs-var">updateBBPhiList</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(ScopeID, Name)] -&gt; CFGBuild (Map (ScopeID, Name) Var)
</span><a href="CFG.Build.html#recordPhiVar"><span class="hs-identifier hs-var">recordPhiVar</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScopeID, Name)]
</span><a href="#local-6989586621679219045"><span class="hs-identifier hs-var">phiList</span></a></span><span>
</span><span id="line-649"></span><span>          </span><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a. GraphBuilder ScopeID BasicBlock CFGEdge a -&gt; CFGBuild ()
</span><a href="CFG.Build.html#updateCFG"><span class="hs-identifier hs-var">updateCFG</span></a></span><span> </span><span class="annot"><span class="annottext">(GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ())
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-650"></span><span>            </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219052"><span class="hs-identifier hs-var">predTail</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219056"><span class="hs-identifier hs-var">blockHead</span></a></span><span> </span><span class="annot"><span class="annottext">(CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ())
-&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; CFGEdge
</span><a href="CFG.Types.html#CondEdge"><span class="hs-identifier hs-var">CondEdge</span></a></span><span> </span><span class="annot"><span class="annottext">(Condition -&gt; CFGEdge) -&gt; Condition -&gt; CFGEdge
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarOrImm -&gt; Condition
</span><a href="CFG.Types.html#Pred"><span class="hs-identifier hs-var">Pred</span></a></span><span> </span><span class="annot"><span class="annottext">(VarOrImm -&gt; Condition) -&gt; VarOrImm -&gt; Condition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219051"><span class="hs-identifier hs-var">predVar</span></a></span><span>
</span><span id="line-651"></span><span>            </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219052"><span class="hs-identifier hs-var">predTail</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219054"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">(CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ())
-&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; CFGEdge
</span><a href="CFG.Types.html#CondEdge"><span class="hs-identifier hs-var">CondEdge</span></a></span><span> </span><span class="annot"><span class="annottext">(Condition -&gt; CFGEdge) -&gt; Condition -&gt; CFGEdge
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarOrImm -&gt; Condition
</span><a href="CFG.Types.html#Complement"><span class="hs-identifier hs-var">Complement</span></a></span><span> </span><span class="annot"><span class="annottext">(VarOrImm -&gt; Condition) -&gt; VarOrImm -&gt; Condition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219051"><span class="hs-identifier hs-var">predVar</span></a></span><span>
</span><span id="line-652"></span><span>            </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219057"><span class="hs-identifier hs-var">blockTail</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219053"><span class="hs-identifier hs-var">dummyUpdateBB</span></a></span><span> </span><span class="annot"><span class="annottext">CFGEdge
</span><a href="CFG.Types.html#SeqEdge"><span class="hs-identifier hs-var">SeqEdge</span></a></span><span>
</span><span id="line-653"></span><span>            </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219053"><span class="hs-identifier hs-var">dummyUpdateBB</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219058"><span class="hs-identifier hs-var">updateHead</span></a></span><span> </span><span class="annot"><span class="annottext">CFGEdge
</span><a href="CFG.Types.html#SeqEdge"><span class="hs-identifier hs-var">SeqEdge</span></a></span><span>
</span><span id="line-654"></span><span>            </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219060"><span class="hs-identifier hs-var">updateTail</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219050"><span class="hs-identifier hs-var">predHead</span></a></span><span> </span><span class="annot"><span class="annottext">CFGEdge
</span><a href="CFG.Types.html#SeqEdge"><span class="hs-identifier hs-var">SeqEdge</span></a></span><span>
</span><span id="line-655"></span><span>          </span><span class="annot"><span class="annottext">Map (ScopeID, Name) Var -&gt; CFGBuild (Map (ScopeID, Name) Var)
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Map (ScopeID, Name) Var
</span><a href="#local-6989586621679219061"><span class="hs-identifier hs-var">updateBBPhiList</span></a></span><span>
</span><span id="line-656"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-657"></span><span>  </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID
-&gt; Map (ScopeID, Name) Var
-&gt; ScopeID
-&gt; Map (ScopeID, Name) Var
-&gt; CFGBuild ()
</span><a href="CFG.Build.html#patchPhiNode"><span class="hs-identifier hs-var">patchPhiNode</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219050"><span class="hs-identifier hs-var">predHead</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219048"><span class="hs-identifier hs-var">prevBB</span></a></span><span> </span><span class="annot"><span class="annottext">Map (ScopeID, Name) Var
</span><a href="#local-6989586621679219049"><span class="hs-identifier hs-var">prevBBPhiList</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219053"><span class="hs-identifier hs-var">dummyUpdateBB</span></a></span><span> </span><span class="annot"><span class="annottext">Map (ScopeID, Name) Var
</span><a href="#local-6989586621679219055"><span class="hs-identifier hs-var">updateBBPhiList</span></a></span><span>
</span><span id="line-658"></span><span>  </span><span class="annot"><span class="annottext">BBTransition -&gt; CFGBuild BBTransition
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(BBTransition -&gt; CFGBuild BBTransition)
-&gt; BBTransition -&gt; CFGBuild BBTransition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; BBTransition
</span><a href="CFG.Build.html#TailAt"><span class="hs-identifier hs-var">TailAt</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219054"><span class="hs-identifier hs-var">tail</span></a></span><span>
</span><span id="line-659"></span><span class="annot"><a href="CFG.Build.html#buildStatement"><span class="hs-identifier hs-var">buildStatement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Statement"><span class="hs-identifier hs-type">AST.Statement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#ReturnStmt"><span class="hs-identifier hs-type">AST.ReturnStmt</span></a></span><span> </span><span id="local-6989586621679219063"><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621679219063"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679219064"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219064"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-660"></span><span>  </span><span id="local-6989586621679219065"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219065"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621679219063"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-661"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679219066"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219066"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219066"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-662"></span><span>    </span><span class="annot"><span class="annottext">Maybe Expr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="AST.html#Void"><span class="hs-identifier hs-var">AST.Void</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219064"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-663"></span><span>  </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; SSA
</span><a href="SSA.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219065"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-664"></span><span>  </span><span class="hs-comment">-- Go directly to function exit</span><span>
</span><span id="line-665"></span><span>  </span><span id="local-6989586621679219068"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219068"><span class="hs-identifier hs-var">bbid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#finishCurrentBB"><span class="hs-identifier hs-var">finishCurrentBB</span></a></span><span>
</span><span id="line-666"></span><span>  </span><span id="local-6989586621679219069"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219069"><span class="hs-identifier hs-var">funcTail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#getFunctionExit"><span class="hs-identifier hs-var">getFunctionExit</span></a></span><span>
</span><span id="line-667"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219069"><span class="hs-identifier hs-var">funcTail</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-668"></span><span>    </span><span class="annot"><span class="annottext">ScopeID
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild ()
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild ()) -&gt; CompileError -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; Maybe Range
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219064"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;Return not in a function context.&quot;</span></span><span>
</span><span id="line-669"></span><span>    </span><span id="local-6989586621679219070"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219070"><span class="hs-identifier hs-var">tail</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a. GraphBuilder ScopeID BasicBlock CFGEdge a -&gt; CFGBuild ()
</span><a href="CFG.Build.html#updateCFG"><span class="hs-identifier hs-var">updateCFG</span></a></span><span> </span><span class="annot"><span class="annottext">(GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ())
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219068"><span class="hs-identifier hs-var">bbid</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219070"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">CFGEdge
</span><a href="CFG.Types.html#SeqEdge"><span class="hs-identifier hs-var">SeqEdge</span></a></span><span>
</span><span id="line-670"></span><span>  </span><span class="hs-comment">-- Create an unreachable bb in case there are still statements after</span><span>
</span><span id="line-671"></span><span>  </span><span class="hs-comment">-- this point.</span><span>
</span><span id="line-672"></span><span>  </span><span class="hs-comment">-- We could optimize unreachable blocks away in later passes.</span><span>
</span><span id="line-673"></span><span>  </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#createEmptyBB"><span class="hs-identifier hs-var">createEmptyBB</span></a></span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
-&gt; (ScopeID -&gt; BBTransition) -&gt; CFGBuild BBTransition
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; BBTransition
</span><a href="CFG.Build.html#Deadend"><span class="hs-identifier hs-var">Deadend</span></a></span><span>
</span><span id="line-674"></span><span class="annot"><a href="CFG.Build.html#buildStatement"><span class="hs-identifier hs-var">buildStatement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Statement"><span class="hs-identifier hs-type">AST.Statement</span></a></span><span> </span><span class="annot"><span class="annottext">Statement_
</span><a href="AST.html#ContinueStmt"><span class="hs-identifier hs-var">AST.ContinueStmt</span></a></span><span> </span><span id="local-6989586621679219072"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219072"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-675"></span><span>  </span><span id="local-6989586621679219073"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219073"><span class="hs-identifier hs-var">bbid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#finishCurrentBB"><span class="hs-identifier hs-var">finishCurrentBB</span></a></span><span>
</span><span id="line-676"></span><span>  </span><span id="local-6989586621679219074"><span class="annot"><span class="annottext">Maybe ScopeID
</span><a href="#local-6989586621679219074"><span class="hs-identifier hs-var">controlH'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild (Maybe ScopeID)
</span><a href="CFG.Build.html#getControlEntry"><span class="hs-identifier hs-var">getControlEntry</span></a></span><span>
</span><span id="line-677"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ScopeID
</span><a href="#local-6989586621679219074"><span class="hs-identifier hs-var">controlH'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-678"></span><span>    </span><span class="annot"><span class="annottext">Maybe ScopeID
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild ()
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild ()) -&gt; CompileError -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; Maybe Range
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219072"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;Continue not in a loop context.&quot;</span></span><span>
</span><span id="line-679"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679219075"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219075"><span class="hs-identifier hs-var">controlH</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a. GraphBuilder ScopeID BasicBlock CFGEdge a -&gt; CFGBuild ()
</span><a href="CFG.Build.html#updateCFG"><span class="hs-identifier hs-var">updateCFG</span></a></span><span> </span><span class="annot"><span class="annottext">(GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ())
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219073"><span class="hs-identifier hs-var">bbid</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219075"><span class="hs-identifier hs-var">controlH</span></a></span><span> </span><span class="annot"><span class="annottext">CFGEdge
</span><a href="CFG.Types.html#SeqEdge"><span class="hs-identifier hs-var">SeqEdge</span></a></span><span>
</span><span id="line-680"></span><span>  </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#createEmptyBB"><span class="hs-identifier hs-var">createEmptyBB</span></a></span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
-&gt; (ScopeID -&gt; BBTransition) -&gt; CFGBuild BBTransition
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; BBTransition
</span><a href="CFG.Build.html#Deadend"><span class="hs-identifier hs-var">Deadend</span></a></span><span>
</span><span id="line-681"></span><span class="annot"><a href="CFG.Build.html#buildStatement"><span class="hs-identifier hs-var">buildStatement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Statement"><span class="hs-identifier hs-type">AST.Statement</span></a></span><span> </span><span class="annot"><span class="annottext">Statement_
</span><a href="AST.html#BreakStmt"><span class="hs-identifier hs-var">AST.BreakStmt</span></a></span><span> </span><span id="local-6989586621679219077"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219077"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-682"></span><span>  </span><span id="local-6989586621679219078"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219078"><span class="hs-identifier hs-var">bbid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#finishCurrentBB"><span class="hs-identifier hs-var">finishCurrentBB</span></a></span><span>
</span><span id="line-683"></span><span>  </span><span id="local-6989586621679219079"><span class="annot"><span class="annottext">Maybe ScopeID
</span><a href="#local-6989586621679219079"><span class="hs-identifier hs-var">controlT'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild (Maybe ScopeID)
</span><a href="CFG.Build.html#getControlExit"><span class="hs-identifier hs-var">getControlExit</span></a></span><span>
</span><span id="line-684"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ScopeID
</span><a href="#local-6989586621679219079"><span class="hs-identifier hs-var">controlT'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-685"></span><span>    </span><span class="annot"><span class="annottext">Maybe ScopeID
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild ()
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild ()) -&gt; CompileError -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; Maybe Range
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219077"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;Break not in a loop context.&quot;</span></span><span>
</span><span id="line-686"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679219080"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219080"><span class="hs-identifier hs-var">controlT</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a. GraphBuilder ScopeID BasicBlock CFGEdge a -&gt; CFGBuild ()
</span><a href="CFG.Build.html#updateCFG"><span class="hs-identifier hs-var">updateCFG</span></a></span><span> </span><span class="annot"><span class="annottext">(GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ())
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219078"><span class="hs-identifier hs-var">bbid</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219080"><span class="hs-identifier hs-var">controlT</span></a></span><span> </span><span class="annot"><span class="annottext">CFGEdge
</span><a href="CFG.Types.html#SeqEdge"><span class="hs-identifier hs-var">SeqEdge</span></a></span><span>
</span><span id="line-687"></span><span>  </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#createEmptyBB"><span class="hs-identifier hs-var">createEmptyBB</span></a></span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
-&gt; (ScopeID -&gt; BBTransition) -&gt; CFGBuild BBTransition
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; BBTransition
</span><a href="CFG.Build.html#Deadend"><span class="hs-identifier hs-var">Deadend</span></a></span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span class="annot"><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-type">buildExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="AST.html#Expr"><span class="hs-identifier hs-type">AST.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="SSA.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-690"></span><span id="buildExpr"><span class="annot"><span class="annottext">buildExpr :: Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var hs-var">buildExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Expr"><span class="hs-identifier hs-type">AST.Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#LocationExpr"><span class="hs-identifier hs-type">AST.LocationExpr</span></a></span><span> </span><span id="local-6989586621679219083"><span class="annot"><span class="annottext">Location
</span><a href="#local-6989586621679219083"><span class="hs-identifier hs-var">location</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679219084"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219084"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Location -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildReadFromLocation"><span class="hs-identifier hs-var">buildReadFromLocation</span></a></span><span> </span><span class="annot"><span class="annottext">Location
</span><a href="#local-6989586621679219083"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-691"></span><span class="annot"><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Expr"><span class="hs-identifier hs-type">AST.Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#MethodCallExpr"><span class="hs-identifier hs-type">AST.MethodCallExpr</span></a></span><span> </span><span id="local-6989586621679219086"><span class="annot"><span class="annottext">MethodCall
</span><a href="#local-6989586621679219086"><span class="hs-identifier hs-var">call</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679219087"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219087"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MethodCall -&gt; Type -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildMethodCall"><span class="hs-identifier hs-var">buildMethodCall</span></a></span><span> </span><span class="annot"><span class="annottext">MethodCall
</span><a href="#local-6989586621679219086"><span class="hs-identifier hs-var">call</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219087"><span class="hs-identifier hs-var">tpe</span></a></span><span>
</span><span id="line-692"></span><span class="annot"><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Expr"><span class="hs-identifier hs-type">AST.Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#ExternCallExpr"><span class="hs-identifier hs-type">AST.ExternCallExpr</span></a></span><span> </span><span id="local-6989586621679219089"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679219089"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679219090"><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679219090"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679219091"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219091"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679219092"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219092"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-693"></span><span>  </span><span class="annot"><span class="annottext">MethodCall -&gt; Type -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildMethodCall"><span class="hs-identifier hs-var">buildMethodCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Expr] -&gt; Range -&gt; MethodCall
</span><a href="AST.html#MethodCall"><span class="hs-identifier hs-var">AST.MethodCall</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679219089"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679219090"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219092"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219091"><span class="hs-identifier hs-var">tpe</span></a></span><span>
</span><span id="line-694"></span><span class="annot"><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Expr"><span class="hs-identifier hs-type">AST.Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#IntLiteralExpr"><span class="hs-identifier hs-type">AST.IntLiteralExpr</span></a></span><span> </span><span id="local-6989586621679219095"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679219095"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679219096"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219096"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679219097"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219097"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-695"></span><span>  </span><span id="local-6989586621679219098"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219098"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219096"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219097"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-696"></span><span>  </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Assignment"><span class="hs-identifier hs-var">Assignment</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219098"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; VarOrImm
</span><a href="SSA.html#IntImm"><span class="hs-identifier hs-var">IntImm</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679219095"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-697"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219098"><span class="hs-identifier hs-var">dst</span></a></span><span>
</span><span id="line-698"></span><span class="annot"><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Expr"><span class="hs-identifier hs-type">AST.Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#BoolLiteralExpr"><span class="hs-identifier hs-type">AST.BoolLiteralExpr</span></a></span><span> </span><span id="local-6989586621679219101"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679219101"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679219102"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219102"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679219103"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219103"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-699"></span><span>  </span><span id="local-6989586621679219104"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219104"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219102"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219103"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-700"></span><span>  </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Assignment"><span class="hs-identifier hs-var">Assignment</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219104"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; VarOrImm
</span><a href="SSA.html#BoolImm"><span class="hs-identifier hs-var">BoolImm</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679219101"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219104"><span class="hs-identifier hs-var">dst</span></a></span><span>
</span><span id="line-702"></span><span class="annot"><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Expr"><span class="hs-identifier hs-type">AST.Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#CharLiteralExpr"><span class="hs-identifier hs-type">AST.CharLiteralExpr</span></a></span><span> </span><span id="local-6989586621679219107"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679219107"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679219108"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219108"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679219109"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219109"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-703"></span><span>  </span><span id="local-6989586621679219110"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219110"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219108"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219109"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-704"></span><span>  </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Assignment"><span class="hs-identifier hs-var">Assignment</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219110"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; VarOrImm
</span><a href="SSA.html#CharImm"><span class="hs-identifier hs-var">CharImm</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679219107"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-705"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219110"><span class="hs-identifier hs-var">dst</span></a></span><span>
</span><span id="line-706"></span><span class="annot"><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Expr"><span class="hs-identifier hs-type">AST.Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#StringLiteralExpr"><span class="hs-identifier hs-type">AST.StringLiteralExpr</span></a></span><span> </span><span id="local-6989586621679219113"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679219113"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679219114"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219114"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-707"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679219115"><span class="annot"><span class="annottext">len :: Int64
</span><a href="#local-6989586621679219115"><span class="hs-identifier hs-var hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScopeID -&gt; Int64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ScopeID
</span><span class="hs-identifier hs-var">Text.length</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679219113"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Int64 -&gt; Int64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">1</span></span><span>
</span><span id="line-708"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679219118"><span class="annot"><span class="annottext">tpe :: Type
</span><a href="#local-6989586621679219118"><span class="hs-identifier hs-var hs-var">tpe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Int64 -&gt; Type
</span><a href="AST.html#ArrayType"><span class="hs-identifier hs-var">AST.ArrayType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="AST.html#CharType"><span class="hs-identifier hs-var">AST.CharType</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679219115"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-709"></span><span>  </span><span id="local-6989586621679219120"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219120"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; Locality -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newVar"><span class="hs-identifier hs-var">newVar</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219118"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219114"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Locality
</span><a href="SSA.html#Local"><span class="hs-identifier hs-var">Local</span></a></span><span>
</span><span id="line-710"></span><span>  </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Name -&gt; Type -&gt; SSA
</span><a href="SSA.html#AllocaStr"><span class="hs-identifier hs-var">AllocaStr</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219120"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Name
</span><span class="hs-identifier hs-var">Text.append</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679219113"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;\0&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219118"><span class="hs-identifier hs-var">tpe</span></a></span><span>
</span><span id="line-711"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219120"><span class="hs-identifier hs-var">ptr</span></a></span><span>
</span><span id="line-712"></span><span class="annot"><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Expr"><span class="hs-identifier hs-type">AST.Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#ArithOpExpr"><span class="hs-identifier hs-type">AST.ArithOpExpr</span></a></span><span> </span><span id="local-6989586621679219124"><span class="annot"><span class="annottext">ArithOp
</span><a href="#local-6989586621679219124"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679219125"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219125"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621679219126"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219126"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679219127"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219127"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679219128"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219128"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-713"></span><span>  </span><span id="local-6989586621679219129"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219129"><span class="hs-identifier hs-var">lhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219125"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-714"></span><span>  </span><span id="local-6989586621679219130"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219130"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219126"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-715"></span><span>  </span><span id="local-6989586621679219131"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219131"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219127"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219128"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-716"></span><span>  </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; ArithOp -&gt; VarOrImm -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Arith"><span class="hs-identifier hs-var">Arith</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219131"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="annot"><span class="annottext">ArithOp
</span><a href="#local-6989586621679219124"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219129"><span class="hs-identifier hs-var">lhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219130"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-717"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219131"><span class="hs-identifier hs-var">dst</span></a></span><span>
</span><span id="line-718"></span><span class="annot"><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Expr"><span class="hs-identifier hs-type">AST.Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#RelOpExpr"><span class="hs-identifier hs-type">AST.RelOpExpr</span></a></span><span> </span><span id="local-6989586621679219133"><span class="annot"><span class="annottext">RelOp
</span><a href="#local-6989586621679219133"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679219134"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219134"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621679219135"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219135"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679219136"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219136"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679219137"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219137"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-719"></span><span>  </span><span id="local-6989586621679219138"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219138"><span class="hs-identifier hs-var">lhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219134"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-720"></span><span>  </span><span id="local-6989586621679219139"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219139"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219135"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-721"></span><span>  </span><span id="local-6989586621679219140"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219140"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219136"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219137"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-722"></span><span>  </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; RelOp -&gt; VarOrImm -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Rel"><span class="hs-identifier hs-var">Rel</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219140"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="annot"><span class="annottext">RelOp
</span><a href="#local-6989586621679219133"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219138"><span class="hs-identifier hs-var">lhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219139"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-723"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219140"><span class="hs-identifier hs-var">dst</span></a></span><span>
</span><span id="line-724"></span><span class="annot"><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Expr"><span class="hs-identifier hs-type">AST.Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#CondOpExpr"><span class="hs-identifier hs-type">AST.CondOpExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CondOp
</span><a href="AST.html#And"><span class="hs-identifier hs-var">AST.And</span></a></span><span> </span><span id="local-6989586621679219144"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219144"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621679219145"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219145"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679219146"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219146"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679219147"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219147"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-725"></span><span>  </span><span id="local-6989586621679219148"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219148"><span class="hs-identifier hs-var">lhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219144"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-726"></span><span>  </span><span id="local-6989586621679219149"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219149"><span class="hs-identifier hs-var">lhsTail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#finishCurrentBB"><span class="hs-identifier hs-var">finishCurrentBB</span></a></span><span>
</span><span id="line-727"></span><span>  </span><span id="local-6989586621679219150"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219150"><span class="hs-identifier hs-var">rhsHead</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#currentBBID</span></span><span>
</span><span id="line-728"></span><span>  </span><span id="local-6989586621679219151"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219151"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219145"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-729"></span><span>  </span><span id="local-6989586621679219152"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219152"><span class="hs-identifier hs-var">rhsTail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#finishCurrentBB"><span class="hs-identifier hs-var">finishCurrentBB</span></a></span><span>
</span><span id="line-730"></span><span>  </span><span id="local-6989586621679219153"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219153"><span class="hs-identifier hs-var">tail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#currentBBID</span></span><span>
</span><span id="line-731"></span><span>  </span><span id="local-6989586621679219154"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219154"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219146"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219147"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-732"></span><span>  </span><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a. GraphBuilder ScopeID BasicBlock CFGEdge a -&gt; CFGBuild ()
</span><a href="CFG.Build.html#updateCFG"><span class="hs-identifier hs-var">updateCFG</span></a></span><span> </span><span class="annot"><span class="annottext">(GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ())
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-733"></span><span>    </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219149"><span class="hs-identifier hs-var">lhsTail</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219150"><span class="hs-identifier hs-var">rhsHead</span></a></span><span> </span><span class="annot"><span class="annottext">(CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ())
-&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; CFGEdge
</span><a href="CFG.Types.html#CondEdge"><span class="hs-identifier hs-var">CondEdge</span></a></span><span> </span><span class="annot"><span class="annottext">(Condition -&gt; CFGEdge) -&gt; Condition -&gt; CFGEdge
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarOrImm -&gt; Condition
</span><a href="CFG.Types.html#Pred"><span class="hs-identifier hs-var">Pred</span></a></span><span> </span><span class="annot"><span class="annottext">(VarOrImm -&gt; Condition) -&gt; VarOrImm -&gt; Condition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219148"><span class="hs-identifier hs-var">lhs'</span></a></span><span>
</span><span id="line-734"></span><span>    </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219149"><span class="hs-identifier hs-var">lhsTail</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219153"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">(CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ())
-&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; CFGEdge
</span><a href="CFG.Types.html#CondEdge"><span class="hs-identifier hs-var">CondEdge</span></a></span><span> </span><span class="annot"><span class="annottext">(Condition -&gt; CFGEdge) -&gt; Condition -&gt; CFGEdge
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarOrImm -&gt; Condition
</span><a href="CFG.Types.html#Complement"><span class="hs-identifier hs-var">Complement</span></a></span><span> </span><span class="annot"><span class="annottext">(VarOrImm -&gt; Condition) -&gt; VarOrImm -&gt; Condition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219148"><span class="hs-identifier hs-var">lhs'</span></a></span><span>
</span><span id="line-735"></span><span>    </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219152"><span class="hs-identifier hs-var">rhsTail</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219153"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">CFGEdge
</span><a href="CFG.Types.html#SeqEdge"><span class="hs-identifier hs-var">SeqEdge</span></a></span><span>
</span><span id="line-736"></span><span>  </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [(Var, ScopeID)] -&gt; SSA
</span><a href="SSA.html#Phi"><span class="hs-identifier hs-var">Phi</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219154"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219148"><span class="hs-identifier hs-var">lhs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219149"><span class="hs-identifier hs-var">lhsTail</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219151"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219152"><span class="hs-identifier hs-var">rhsTail</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-737"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219154"><span class="hs-identifier hs-var">dst</span></a></span><span>
</span><span id="line-738"></span><span class="annot"><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Expr"><span class="hs-identifier hs-type">AST.Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#CondOpExpr"><span class="hs-identifier hs-type">AST.CondOpExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CondOp
</span><a href="AST.html#Or"><span class="hs-identifier hs-var">AST.Or</span></a></span><span> </span><span id="local-6989586621679219156"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219156"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621679219157"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219157"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679219158"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219158"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679219159"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219159"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-739"></span><span>  </span><span id="local-6989586621679219160"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219160"><span class="hs-identifier hs-var">lhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219156"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-740"></span><span>  </span><span id="local-6989586621679219161"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219161"><span class="hs-identifier hs-var">lhsTail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#finishCurrentBB"><span class="hs-identifier hs-var">finishCurrentBB</span></a></span><span>
</span><span id="line-741"></span><span>  </span><span id="local-6989586621679219162"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219162"><span class="hs-identifier hs-var">rhsHead</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#currentBBID</span></span><span>
</span><span id="line-742"></span><span>  </span><span id="local-6989586621679219163"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219163"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219157"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-743"></span><span>  </span><span id="local-6989586621679219164"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219164"><span class="hs-identifier hs-var">rhsTail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#finishCurrentBB"><span class="hs-identifier hs-var">finishCurrentBB</span></a></span><span>
</span><span id="line-744"></span><span>  </span><span id="local-6989586621679219165"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219165"><span class="hs-identifier hs-var">bbid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#currentBBID</span></span><span>
</span><span id="line-745"></span><span>  </span><span id="local-6989586621679219166"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219166"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219158"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219159"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-746"></span><span>  </span><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a. GraphBuilder ScopeID BasicBlock CFGEdge a -&gt; CFGBuild ()
</span><a href="CFG.Build.html#updateCFG"><span class="hs-identifier hs-var">updateCFG</span></a></span><span> </span><span class="annot"><span class="annottext">(GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ())
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-747"></span><span>    </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219161"><span class="hs-identifier hs-var">lhsTail</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219165"><span class="hs-identifier hs-var">bbid</span></a></span><span> </span><span class="annot"><span class="annottext">(CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ())
-&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; CFGEdge
</span><a href="CFG.Types.html#CondEdge"><span class="hs-identifier hs-var">CondEdge</span></a></span><span> </span><span class="annot"><span class="annottext">(Condition -&gt; CFGEdge) -&gt; Condition -&gt; CFGEdge
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarOrImm -&gt; Condition
</span><a href="CFG.Types.html#Pred"><span class="hs-identifier hs-var">Pred</span></a></span><span> </span><span class="annot"><span class="annottext">(VarOrImm -&gt; Condition) -&gt; VarOrImm -&gt; Condition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219160"><span class="hs-identifier hs-var">lhs'</span></a></span><span>
</span><span id="line-748"></span><span>    </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219161"><span class="hs-identifier hs-var">lhsTail</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219162"><span class="hs-identifier hs-var">rhsHead</span></a></span><span> </span><span class="annot"><span class="annottext">(CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ())
-&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; CFGEdge
</span><a href="CFG.Types.html#CondEdge"><span class="hs-identifier hs-var">CondEdge</span></a></span><span> </span><span class="annot"><span class="annottext">(Condition -&gt; CFGEdge) -&gt; Condition -&gt; CFGEdge
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarOrImm -&gt; Condition
</span><a href="CFG.Types.html#Complement"><span class="hs-identifier hs-var">Complement</span></a></span><span> </span><span class="annot"><span class="annottext">(VarOrImm -&gt; Condition) -&gt; VarOrImm -&gt; Condition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219160"><span class="hs-identifier hs-var">lhs'</span></a></span><span>
</span><span id="line-749"></span><span>    </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219162"><span class="hs-identifier hs-var">rhsHead</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219165"><span class="hs-identifier hs-var">bbid</span></a></span><span> </span><span class="annot"><span class="annottext">CFGEdge
</span><a href="CFG.Types.html#SeqEdge"><span class="hs-identifier hs-var">SeqEdge</span></a></span><span>
</span><span id="line-750"></span><span>  </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [(Var, ScopeID)] -&gt; SSA
</span><a href="SSA.html#Phi"><span class="hs-identifier hs-var">Phi</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219166"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219160"><span class="hs-identifier hs-var">lhs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219161"><span class="hs-identifier hs-var">lhsTail</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219163"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219164"><span class="hs-identifier hs-var">rhsTail</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-751"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219166"><span class="hs-identifier hs-var">dst</span></a></span><span>
</span><span id="line-752"></span><span class="annot"><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Expr"><span class="hs-identifier hs-type">AST.Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#EqOpExpr"><span class="hs-identifier hs-type">AST.EqOpExpr</span></a></span><span> </span><span id="local-6989586621679219168"><span class="annot"><span class="annottext">EqOp
</span><a href="#local-6989586621679219168"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679219169"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219169"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621679219170"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219170"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679219171"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219171"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679219172"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219172"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-753"></span><span>  </span><span id="local-6989586621679219173"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219173"><span class="hs-identifier hs-var">lhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219169"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-754"></span><span>  </span><span id="local-6989586621679219174"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219174"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219170"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-755"></span><span>  </span><span id="local-6989586621679219175"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219175"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219171"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219172"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-756"></span><span>  </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; EqOp -&gt; VarOrImm -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Eq"><span class="hs-identifier hs-var">Eq</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219175"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="annot"><span class="annottext">EqOp
</span><a href="#local-6989586621679219168"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219173"><span class="hs-identifier hs-var">lhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219174"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-757"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219175"><span class="hs-identifier hs-var">dst</span></a></span><span>
</span><span id="line-758"></span><span class="annot"><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Expr"><span class="hs-identifier hs-type">AST.Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#NegOpExpr"><span class="hs-identifier hs-type">AST.NegOpExpr</span></a></span><span> </span><span id="local-6989586621679219178"><span class="annot"><span class="annottext">NegOp
</span><a href="#local-6989586621679219178"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679219179"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219179"><span class="hs-identifier hs-var">opr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679219180"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219180"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679219181"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219181"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-759"></span><span>  </span><span id="local-6989586621679219182"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219182"><span class="hs-identifier hs-var">opr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219179"><span class="hs-identifier hs-var">opr</span></a></span><span>
</span><span id="line-760"></span><span>  </span><span id="local-6989586621679219183"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219183"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219180"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219181"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-761"></span><span>  </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; NegOp -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Neg"><span class="hs-identifier hs-var">Neg</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219183"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="annot"><span class="annottext">NegOp
</span><a href="#local-6989586621679219178"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219182"><span class="hs-identifier hs-var">opr'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-762"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219183"><span class="hs-identifier hs-var">dst</span></a></span><span>
</span><span id="line-763"></span><span class="annot"><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Expr"><span class="hs-identifier hs-type">AST.Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#NotOpExpr"><span class="hs-identifier hs-type">AST.NotOpExpr</span></a></span><span> </span><span id="local-6989586621679219186"><span class="annot"><span class="annottext">NotOp
</span><a href="#local-6989586621679219186"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679219187"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219187"><span class="hs-identifier hs-var">opr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679219188"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219188"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679219189"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219189"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-764"></span><span>  </span><span id="local-6989586621679219190"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219190"><span class="hs-identifier hs-var">opr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219187"><span class="hs-identifier hs-var">opr</span></a></span><span>
</span><span id="line-765"></span><span>  </span><span id="local-6989586621679219191"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219191"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219188"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219189"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-766"></span><span>  </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; NotOp -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Not"><span class="hs-identifier hs-var">Not</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219191"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="annot"><span class="annottext">NotOp
</span><a href="#local-6989586621679219186"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219190"><span class="hs-identifier hs-var">opr'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-767"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219191"><span class="hs-identifier hs-var">dst</span></a></span><span>
</span><span id="line-768"></span><span class="annot"><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Expr"><span class="hs-identifier hs-type">AST.Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#ChoiceOpExpr"><span class="hs-identifier hs-type">AST.ChoiceOpExpr</span></a></span><span> </span><span id="local-6989586621679219194"><span class="annot"><span class="annottext">ChoiceOp
</span><a href="#local-6989586621679219194"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679219195"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219195"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621679219196"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219196"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621679219197"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219197"><span class="hs-identifier hs-var">e3</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679219198"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219198"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679219199"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219199"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-769"></span><span>  </span><span id="local-6989586621679219200"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219200"><span class="hs-identifier hs-var">pred'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219195"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-770"></span><span>  </span><span id="local-6989586621679219201"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219201"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#finishCurrentBB"><span class="hs-identifier hs-var">finishCurrentBB</span></a></span><span>
</span><span id="line-771"></span><span>  </span><span id="local-6989586621679219202"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219202"><span class="hs-identifier hs-var">exprT'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219196"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-772"></span><span>  </span><span id="local-6989586621679219203"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219203"><span class="hs-identifier hs-var">bbTHead</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#currentBBID</span></span><span>
</span><span id="line-773"></span><span>  </span><span id="local-6989586621679219204"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219204"><span class="hs-identifier hs-var">bbTTail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#finishCurrentBB"><span class="hs-identifier hs-var">finishCurrentBB</span></a></span><span>
</span><span id="line-774"></span><span>  </span><span id="local-6989586621679219205"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219205"><span class="hs-identifier hs-var">bbFHead</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#currentBBID</span></span><span>
</span><span id="line-775"></span><span>  </span><span id="local-6989586621679219206"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219206"><span class="hs-identifier hs-var">exprF'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219197"><span class="hs-identifier hs-var">e3</span></a></span><span>
</span><span id="line-776"></span><span>  </span><span id="local-6989586621679219207"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219207"><span class="hs-identifier hs-var">bbFTail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CFGBuild ScopeID
</span><a href="CFG.Build.html#finishCurrentBB"><span class="hs-identifier hs-var">finishCurrentBB</span></a></span><span>
</span><span id="line-777"></span><span>  </span><span id="local-6989586621679219208"><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219208"><span class="hs-identifier hs-var">tail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID -&gt; CFGBuild ScopeID
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting ScopeID CFGState ScopeID
</span><span class="">#currentBBID</span></span><span>
</span><span id="line-778"></span><span>  </span><span id="local-6989586621679219209"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219209"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219198"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219199"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-779"></span><span>  </span><span class="annot"><span class="annottext">GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a. GraphBuilder ScopeID BasicBlock CFGEdge a -&gt; CFGBuild ()
</span><a href="CFG.Build.html#updateCFG"><span class="hs-identifier hs-var">updateCFG</span></a></span><span> </span><span class="annot"><span class="annottext">(GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ())
-&gt; GraphBuilder ScopeID BasicBlock CFGEdge () -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-780"></span><span>    </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219201"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219203"><span class="hs-identifier hs-var">bbTHead</span></a></span><span> </span><span class="annot"><span class="annottext">(CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ())
-&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; CFGEdge
</span><a href="CFG.Types.html#CondEdge"><span class="hs-identifier hs-var">CondEdge</span></a></span><span> </span><span class="annot"><span class="annottext">(Condition -&gt; CFGEdge) -&gt; Condition -&gt; CFGEdge
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarOrImm -&gt; Condition
</span><a href="CFG.Types.html#Pred"><span class="hs-identifier hs-var">Pred</span></a></span><span> </span><span class="annot"><span class="annottext">(VarOrImm -&gt; Condition) -&gt; VarOrImm -&gt; Condition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219200"><span class="hs-identifier hs-var">pred'</span></a></span><span>
</span><span id="line-781"></span><span>    </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219201"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219205"><span class="hs-identifier hs-var">bbFHead</span></a></span><span> </span><span class="annot"><span class="annottext">(CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ())
-&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; CFGEdge
</span><a href="CFG.Types.html#CondEdge"><span class="hs-identifier hs-var">CondEdge</span></a></span><span> </span><span class="annot"><span class="annottext">(Condition -&gt; CFGEdge) -&gt; Condition -&gt; CFGEdge
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarOrImm -&gt; Condition
</span><a href="CFG.Types.html#Complement"><span class="hs-identifier hs-var">Complement</span></a></span><span> </span><span class="annot"><span class="annottext">(VarOrImm -&gt; Condition) -&gt; VarOrImm -&gt; Condition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219200"><span class="hs-identifier hs-var">pred'</span></a></span><span>
</span><span id="line-782"></span><span>    </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219204"><span class="hs-identifier hs-var">bbTTail</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219208"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">CFGEdge
</span><a href="CFG.Types.html#SeqEdge"><span class="hs-identifier hs-var">SeqEdge</span></a></span><span>
</span><span id="line-783"></span><span>    </span><span class="annot"><span class="annottext">ScopeID
-&gt; ScopeID -&gt; CFGEdge -&gt; GraphBuilder ScopeID BasicBlock CFGEdge ()
forall ni ed nd.
(Eq ni, Ord ni) =&gt;
ni -&gt; ni -&gt; ed -&gt; GraphBuilder ni nd ed ()
</span><a href="Util.Graph.html#addEdge"><span class="hs-identifier hs-var">G.addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219207"><span class="hs-identifier hs-var">bbFTail</span></a></span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219208"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">CFGEdge
</span><a href="CFG.Types.html#SeqEdge"><span class="hs-identifier hs-var">SeqEdge</span></a></span><span>
</span><span id="line-784"></span><span>  </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; [(Var, ScopeID)] -&gt; SSA
</span><a href="SSA.html#Phi"><span class="hs-identifier hs-var">Phi</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219209"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219202"><span class="hs-identifier hs-var">exprT'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219204"><span class="hs-identifier hs-var">bbTTail</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219206"><span class="hs-identifier hs-var">exprF'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScopeID
</span><a href="#local-6989586621679219207"><span class="hs-identifier hs-var">bbFTail</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-785"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219209"><span class="hs-identifier hs-var">dst</span></a></span><span>
</span><span id="line-786"></span><span class="annot"><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Expr"><span class="hs-identifier hs-type">AST.Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#LengthExpr"><span class="hs-identifier hs-type">AST.LengthExpr</span></a></span><span> </span><span id="local-6989586621679219211"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679219211"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679219212"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219212"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679219213"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219213"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-787"></span><span>  </span><span id="local-6989586621679219214"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219214"><span class="hs-identifier hs-var">array</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; CFGBuild Var
</span><a href="CFG.Build.html#lookupSym%27"><span class="hs-identifier hs-var">lookupSym'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679219211"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-788"></span><span>  </span><span id="local-6989586621679219215"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219215"><span class="hs-identifier hs-var">arrType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Maybe (Either Argument FieldDecl)
</span><a href="SSA.html#%24sel%3AastDecl%3AVar"><span class="hs-identifier hs-var">astDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219214"><span class="hs-identifier hs-var">array</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-789"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Either Argument FieldDecl)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild Type
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild Type) -&gt; CompileError -&gt; CFGBuild Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; Maybe Range
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219213"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;Unable to find array def&quot;</span></span><span>
</span><span id="line-790"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Argument"><span class="hs-identifier hs-type">AST.Argument</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679219217"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219217"><span class="hs-identifier hs-var">arrTpe</span></a></span></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CFGBuild Type
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219217"><span class="hs-identifier hs-var">arrTpe</span></a></span><span>
</span><span id="line-791"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#FieldDecl"><span class="hs-identifier hs-type">AST.FieldDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679219218"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219218"><span class="hs-identifier hs-var">arrTpe</span></a></span></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CFGBuild Type
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219218"><span class="hs-identifier hs-var">arrTpe</span></a></span><span>
</span><span id="line-792"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219215"><span class="hs-identifier hs-var">arrType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-793"></span><span>    </span><span class="annot"><a href="AST.html#ArrayType"><span class="hs-identifier hs-type">AST.ArrayType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679219219"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679219219"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-794"></span><span>      </span><span id="local-6989586621679219220"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219220"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219212"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219213"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-795"></span><span>      </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Assignment"><span class="hs-identifier hs-var">Assignment</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219220"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; VarOrImm
</span><a href="SSA.html#IntImm"><span class="hs-identifier hs-var">IntImm</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679219219"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-796"></span><span>      </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219220"><span class="hs-identifier hs-var">dst</span></a></span><span>
</span><span id="line-797"></span><span>    </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-798"></span><span>      </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild Var
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild Var) -&gt; CompileError -&gt; CFGBuild Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-799"></span><span>        </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; Maybe Range
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219213"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format Name (Name -&gt; Name) -&gt; Name -&gt; Name
forall a. Format Name a -&gt; a
</span><span class="hs-identifier hs-var">sformat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Format (Name -&gt; Name) (Name -&gt; Name)
</span><span class="hs-string">&quot;Variable is not an array: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Format (Name -&gt; Name) (Name -&gt; Name)
-&gt; Format Name (Name -&gt; Name) -&gt; Format Name (Name -&gt; Name)
forall r a r'. Format r a -&gt; Format r' r -&gt; Format r' a
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Format Name (Name -&gt; Name)
forall r. Format r (Name -&gt; r)
</span><span class="hs-identifier hs-var">stext</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679219211"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-800"></span><span>
</span><span id="line-801"></span><span class="annot"><a href="CFG.Build.html#buildReadFromLocation"><span class="hs-identifier hs-type">buildReadFromLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="AST.html#Location"><span class="hs-identifier hs-type">AST.Location</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="SSA.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-802"></span><span id="buildReadFromLocation"><span class="annot"><span class="annottext">buildReadFromLocation :: Location -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildReadFromLocation"><span class="hs-identifier hs-var hs-var">buildReadFromLocation</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Location"><span class="hs-identifier hs-type">AST.Location</span></a></span><span> </span><span id="local-6989586621679219222"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679219222"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679219223"><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621679219223"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span id="local-6989586621679219224"><span class="annot"><span class="annottext">Either Argument FieldDecl
</span><a href="#local-6989586621679219224"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span id="local-6989586621679219225"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219225"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679219226"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219226"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-803"></span><span>  </span><span id="local-6989586621679219227"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219227"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; CFGBuild Var
</span><a href="CFG.Build.html#lookupSym%27"><span class="hs-identifier hs-var">lookupSym'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679219222"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-804"></span><span>  </span><span class="hs-comment">-- NOTE: var^. #tpe might be different from tpe in AST.Location as we</span><span>
</span><span id="line-805"></span><span>  </span><span class="hs-comment">-- have altered type of global into pointers.</span><span>
</span><span id="line-806"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219227"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Getting Type Var Type -&gt; Type
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Type Var Type
</span><span class="">#tpe</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-807"></span><span>    </span><span class="annot"><a href="AST.html#ArrayType"><span class="hs-identifier hs-type">AST.ArrayType</span></a></span><span> </span><span id="local-6989586621679219228"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219228"><span class="hs-identifier hs-var">eleType</span></a></span></span><span> </span><span id="local-6989586621679219229"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679219229"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-808"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621679219223"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-809"></span><span>        </span><span class="annot"><span class="annottext">Maybe Expr
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild Var
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild Var) -&gt; CompileError -&gt; CFGBuild Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; Maybe Range
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219226"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;Accessing array as a scalar.&quot;</span></span><span>
</span><span id="line-810"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679219230"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219230"><span class="hs-identifier hs-var">idxExpr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-811"></span><span>          </span><span id="local-6989586621679219231"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219231"><span class="hs-identifier hs-var">idxVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219230"><span class="hs-identifier hs-var">idxExpr</span></a></span><span>
</span><span id="line-812"></span><span>          </span><span id="local-6989586621679219232"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219232"><span class="hs-identifier hs-var">arrayPtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; CFGBuild Var
</span><a href="CFG.Build.html#lookupSym%27"><span class="hs-identifier hs-var">lookupSym'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679219222"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-813"></span><span>          </span><span id="local-6989586621679219233"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679219233"><span class="hs-identifier hs-var">eleSize</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Int64
</span><a href="AST.html#dataSize"><span class="hs-identifier hs-var">AST.dataSize</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219228"><span class="hs-identifier hs-var">eleType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-814"></span><span>            </span><span class="annot"><span class="annottext">Maybe Int64
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild Int64
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild Int64) -&gt; CompileError -&gt; CFGBuild Int64
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; Maybe Range
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219226"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;Array with void type element.&quot;</span></span><span>
</span><span id="line-815"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679219235"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679219235"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; CFGBuild Int64
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679219235"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-816"></span><span>          </span><span id="local-6989586621679219236"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219236"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="AST.html#IntType"><span class="hs-identifier hs-var">AST.IntType</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219226"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-817"></span><span>          </span><span id="local-6989586621679219238"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219238"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="AST.html#IntType"><span class="hs-identifier hs-var">AST.IntType</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219226"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-818"></span><span>          </span><span id="local-6989586621679219239"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219239"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219228"><span class="hs-identifier hs-var">eleType</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219226"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-819"></span><span>          </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; ArithOp -&gt; VarOrImm -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Arith"><span class="hs-identifier hs-var">Arith</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219236"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">ArithOp
</span><a href="AST.html#Multiply"><span class="hs-identifier hs-var">AST.Multiply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219231"><span class="hs-identifier hs-var">idxVar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; VarOrImm
</span><a href="SSA.html#IntImm"><span class="hs-identifier hs-var">IntImm</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679219233"><span class="hs-identifier hs-var">eleSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-820"></span><span>          </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; ArithOp -&gt; VarOrImm -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Arith"><span class="hs-identifier hs-var">Arith</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219238"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">ArithOp
</span><a href="AST.html#Plus"><span class="hs-identifier hs-var">AST.Plus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219232"><span class="hs-identifier hs-var">arrayPtr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219236"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-821"></span><span>          </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Load"><span class="hs-identifier hs-var">Load</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219239"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219238"><span class="hs-identifier hs-var">ptr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-822"></span><span>          </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219239"><span class="hs-identifier hs-var">dst</span></a></span><span>
</span><span id="line-823"></span><span>    </span><span class="annot"><a href="AST.html#Ptr"><span class="hs-identifier hs-type">AST.Ptr</span></a></span><span> </span><span id="local-6989586621679219242"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219242"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-824"></span><span>      </span><span id="local-6989586621679219243"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219243"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219242"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219226"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-825"></span><span>      </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Load"><span class="hs-identifier hs-var">Load</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219243"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219227"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-826"></span><span>      </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219243"><span class="hs-identifier hs-var">dst</span></a></span><span>
</span><span id="line-827"></span><span>    </span><span id="local-6989586621679219244"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219244"><span class="hs-identifier hs-var">_scalarType</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219227"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-828"></span><span>
</span><span id="line-829"></span><span class="annot"><a href="CFG.Build.html#buildWriteToLocation"><span class="hs-identifier hs-type">buildWriteToLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="AST.html#Location"><span class="hs-identifier hs-type">AST.Location</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="SSA.html#VarOrImm"><span class="hs-identifier hs-type">VarOrImm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-830"></span><span id="buildWriteToLocation"><span class="annot"><span class="annottext">buildWriteToLocation :: Location -&gt; VarOrImm -&gt; CFGBuild ()
</span><a href="CFG.Build.html#buildWriteToLocation"><span class="hs-identifier hs-var hs-var">buildWriteToLocation</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#Location"><span class="hs-identifier hs-type">AST.Location</span></a></span><span> </span><span id="local-6989586621679219245"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679219245"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679219246"><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621679219246"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span id="local-6989586621679219247"><span class="annot"><span class="annottext">Either Argument FieldDecl
</span><a href="#local-6989586621679219247"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span id="local-6989586621679219248"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219248"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span id="local-6989586621679219249"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219249"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679219250"><span class="annot"><span class="annottext">VarOrImm
</span><a href="#local-6989586621679219250"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-831"></span><span>  </span><span id="local-6989586621679219251"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219251"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; CFGBuild Var
</span><a href="CFG.Build.html#lookupSym%27"><span class="hs-identifier hs-var">lookupSym'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679219245"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-832"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219251"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Getting Type Var Type -&gt; Type
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Type Var Type
</span><span class="">#tpe</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-833"></span><span>    </span><span class="annot"><a href="AST.html#ArrayType"><span class="hs-identifier hs-type">AST.ArrayType</span></a></span><span> </span><span id="local-6989586621679219252"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219252"><span class="hs-identifier hs-var">eleType</span></a></span></span><span> </span><span id="local-6989586621679219253"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679219253"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-834"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621679219246"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-835"></span><span>        </span><span class="annot"><span class="annottext">Maybe Expr
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild ()
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild ()) -&gt; CompileError -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; Maybe Range
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219249"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;Accessing array as a scalar.&quot;</span></span><span>
</span><span id="line-836"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679219254"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219254"><span class="hs-identifier hs-var">idxExpr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-837"></span><span>          </span><span id="local-6989586621679219255"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219255"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679219254"><span class="hs-identifier hs-var">idxExpr</span></a></span><span>
</span><span id="line-838"></span><span>          </span><span id="local-6989586621679219256"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219256"><span class="hs-identifier hs-var">arrayPtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; CFGBuild Var
</span><a href="CFG.Build.html#lookupSym%27"><span class="hs-identifier hs-var">lookupSym'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679219245"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-839"></span><span>          </span><span id="local-6989586621679219257"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679219257"><span class="hs-identifier hs-var">eleSize</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Int64
</span><a href="AST.html#dataSize"><span class="hs-identifier hs-var">AST.dataSize</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219252"><span class="hs-identifier hs-var">eleType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-840"></span><span>            </span><span class="annot"><span class="annottext">Maybe Int64
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompileError -&gt; CFGBuild Int64
forall a. CompileError -&gt; CFGBuild a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(CompileError -&gt; CFGBuild Int64) -&gt; CompileError -&gt; CFGBuild Int64
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Range -&gt; Name -&gt; CompileError
</span><a href="Types.html#CompileError"><span class="hs-identifier hs-var">CompileError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; Maybe Range
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219249"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;Array with void type element.&quot;</span></span><span>
</span><span id="line-841"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679219258"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679219258"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; CFGBuild Int64
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679219258"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-842"></span><span>          </span><span id="local-6989586621679219259"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219259"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="AST.html#IntType"><span class="hs-identifier hs-var">AST.IntType</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219249"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-843"></span><span>          </span><span id="local-6989586621679219260"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219260"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="AST.html#IntType"><span class="hs-identifier hs-var">AST.IntType</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219249"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-844"></span><span>          </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; ArithOp -&gt; VarOrImm -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Arith"><span class="hs-identifier hs-var">Arith</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219259"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">ArithOp
</span><a href="AST.html#Multiply"><span class="hs-identifier hs-var">AST.Multiply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219255"><span class="hs-identifier hs-var">idx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; VarOrImm
</span><a href="SSA.html#IntImm"><span class="hs-identifier hs-var">IntImm</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679219257"><span class="hs-identifier hs-var">eleSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-845"></span><span>          </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; ArithOp -&gt; VarOrImm -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Arith"><span class="hs-identifier hs-var">Arith</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219260"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">ArithOp
</span><a href="AST.html#Plus"><span class="hs-identifier hs-var">AST.Plus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219256"><span class="hs-identifier hs-var">arrayPtr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219259"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-846"></span><span>          </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarOrImm -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Store"><span class="hs-identifier hs-var">Store</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219260"><span class="hs-identifier hs-var">ptr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VarOrImm
</span><a href="#local-6989586621679219250"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-847"></span><span>    </span><span class="annot"><a href="AST.html#Ptr"><span class="hs-identifier hs-type">AST.Ptr</span></a></span><span> </span><span id="local-6989586621679219262"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219262"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-848"></span><span>      </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarOrImm -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Store"><span class="hs-identifier hs-var">Store</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; VarOrImm
</span><a href="SSA.html#Variable"><span class="hs-identifier hs-var">Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219251"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VarOrImm
</span><a href="#local-6989586621679219250"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-849"></span><span>    </span><span id="local-6989586621679219263"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219263"><span class="hs-identifier hs-var">_scalarType</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-850"></span><span>      </span><span id="local-6989586621679219264"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219264"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679219245"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219248"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219249"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-851"></span><span>      </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarOrImm -&gt; SSA
</span><a href="SSA.html#Assignment"><span class="hs-identifier hs-var">Assignment</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219264"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="annot"><span class="annottext">VarOrImm
</span><a href="#local-6989586621679219250"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-852"></span><span>
</span><span id="line-853"></span><span class="annot"><a href="CFG.Build.html#buildMethodCall"><span class="hs-identifier hs-type">buildMethodCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="AST.html#MethodCall"><span class="hs-identifier hs-type">AST.MethodCall</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="AST.html#Type"><span class="hs-identifier hs-type">AST.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="CFG.Build.html#CFGBuild"><span class="hs-identifier hs-type">CFGBuild</span></a></span><span> </span><span class="annot"><a href="SSA.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-854"></span><span id="buildMethodCall"><span class="annot"><span class="annottext">buildMethodCall :: MethodCall -&gt; Type -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildMethodCall"><span class="hs-identifier hs-var hs-var">buildMethodCall</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="AST.html#MethodCall"><span class="hs-identifier hs-type">AST.MethodCall</span></a></span><span> </span><span id="local-6989586621679219265"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679219265"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679219266"><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679219266"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621679219267"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219267"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679219268"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219268"><span class="hs-identifier hs-var">tpe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-855"></span><span>  </span><span id="local-6989586621679219269"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621679219269"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; CFGBuild Var) -&gt; [Expr] -&gt; CFGBuild [Var]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; CFGBuild Var
</span><a href="CFG.Build.html#buildExpr"><span class="hs-identifier hs-var">buildExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679219266"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-856"></span><span>  </span><span id="local-6989586621679219270"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219270"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Type -&gt; Range -&gt; CFGBuild Var
</span><a href="CFG.Build.html#newLocal"><span class="hs-identifier hs-var">newLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679219268"><span class="hs-identifier hs-var">tpe</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621679219267"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-857"></span><span>  </span><span class="annot"><span class="annottext">SSA -&gt; CFGBuild ()
</span><a href="CFG.Build.html#addSSA"><span class="hs-identifier hs-var">addSSA</span></a></span><span> </span><span class="annot"><span class="annottext">(SSA -&gt; CFGBuild ()) -&gt; SSA -&gt; CFGBuild ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Name -&gt; [Var] -&gt; SSA
</span><a href="SSA.html#MethodCall"><span class="hs-identifier hs-var">MethodCall</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219270"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679219265"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621679219269"><span class="hs-identifier hs-var">vars</span></a></span><span>
</span><span id="line-858"></span><span>  </span><span class="annot"><span class="annottext">Var -&gt; CFGBuild Var
forall a. a -&gt; CFGBuild a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621679219270"><span class="hs-identifier hs-var">dst</span></a></span><span>
</span><span id="line-859"></span></pre></body></html>